<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë§ˆì¼/í¬ì¸íŠ¸ ë°œê¶Œ í”Œë˜ë„ˆ - ì—¬ê³µë²•</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --c-primary: #0052CC;
      --c-primary-light: #E6F0FF;
      --c-primary-dark: #003A8C;
      --c-accent: #FF6B35;
      --c-success: #0B8A3E;
      --c-success-bg: #E6F8ED;
      --c-success-border: #8AD4A6;
      --c-warning: #D97706;
      --c-warning-bg: #FFF8EB;
      --c-warning-border: #FCD579;
      --c-danger: #C92A2A;
      --c-danger-bg: #FFF1F0;
      --c-gray-50: #F9FAFB;
      --c-gray-100: #F3F4F6;
      --c-gray-200: #E5E7EB;
      --c-gray-300: #D1D5DB;
      --c-gray-400: #9CA3AF;
      --c-gray-500: #6B7280;
      --c-gray-600: #4B5563;
      --c-gray-700: #374151;
      --c-gray-800: #1F2937;
      --c-gray-900: #111827;
      --font-sans: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-mono: 'JetBrains Mono', 'Menlo', monospace;
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
      --shadow-lg: 0 8px 30px rgba(0,0,0,0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--font-sans); background: var(--c-gray-50); color: var(--c-gray-800); -webkit-font-smoothing: antialiased; }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; }
    input[type="number"] { -moz-appearance: textfield; }
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--c-gray-300); border-radius: 10px; }

    /* Animations */
    @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
    @keyframes planeMove { 0% { transform: translateX(-8px) rotate(-2deg); } 50% { transform: translateX(8px) rotate(2deg); } 100% { transform: translateX(-8px) rotate(-2deg); } }
    @keyframes toastIn { from { opacity:0; transform:translateY(20px) scale(0.95); } to { opacity:1; transform:translateY(0) scale(1); } }
    @keyframes toastOut { from { opacity:1; transform:translateY(0) scale(1); } to { opacity:0; transform:translateY(20px) scale(0.95); } }
    .fade-up { animation: fadeUp 0.4s ease-out both; }
    .fade-up-1 { animation-delay: 0.05s; }
    .fade-up-2 { animation-delay: 0.1s; }
    .fade-up-3 { animation-delay: 0.15s; }
    .fade-up-4 { animation-delay: 0.2s; }
    .loading-plane { animation: planeMove 1.5s ease-in-out infinite; display: inline-block; }

    /* Layout */
    .container { max-width: 920px; margin: 0 auto; padding: 32px 20px 60px; }
    .card { background: #fff; border: 1px solid var(--c-gray-200); border-radius: var(--radius-lg); padding: 32px; box-shadow: var(--shadow-sm); }
    .card-inner { max-width: 680px; margin: 0 auto; }

    /* Form elements */
    .label { display: block; margin-bottom: 8px; font-size: 0.88rem; font-weight: 600; color: var(--c-gray-600); letter-spacing: -0.01em; }
    .label-optional { font-weight: 400; color: var(--c-gray-400); margin-left: 6px; }
    .input { width: 100%; padding: 12px 16px; font-size: 0.95rem; border: 1.5px solid var(--c-gray-200); border-radius: var(--radius-md); outline: none; color: var(--c-gray-800); font-family: var(--font-sans); background: #fff; transition: border-color 0.2s, box-shadow 0.2s; }
    .input:focus { border-color: var(--c-primary); box-shadow: 0 0 0 3px rgba(0,82,204,0.1); }
    .input::placeholder { color: var(--c-gray-400); }
    .select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236B7280' stroke-width='1.5' fill='none'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; padding-right: 36px; }

    /* Buttons */
    .btn { padding: 12px 24px; font-size: 0.95rem; font-weight: 600; border: none; border-radius: var(--radius-md); cursor: pointer; font-family: var(--font-sans); transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 6px; }
    .btn:active { transform: scale(0.97); }
    .btn-primary { background: var(--c-primary); color: #fff; }
    .btn-primary:hover { background: var(--c-primary-dark); }
    .btn-primary:disabled { background: var(--c-gray-200); color: var(--c-gray-400); cursor: not-allowed; transform: none; }
    .btn-outline { background: #fff; color: var(--c-gray-600); border: 1.5px solid var(--c-gray-200); }
    .btn-outline:hover { border-color: var(--c-gray-400); background: var(--c-gray-50); }
    .btn-accent { background: var(--c-accent); color: #fff; }
    .btn-accent:hover { background: #e55a25; }
    .btn-sm { padding: 6px 14px; font-size: 0.82rem; }
    .btn-book { background: var(--c-primary); color: #fff; border: none; padding: 6px 14px; font-size: 0.76rem; font-weight: 600; border-radius: var(--radius-sm); cursor: pointer; width: 100%; transition: all 0.15s; }
    .btn-book:hover { background: var(--c-primary-dark); transform: scale(1.03); box-shadow: 0 2px 8px rgba(37,99,235,0.3); }
    .btn-book:active { transform: scale(0.97); }
    .ticket-item { transition: all 0.2s; }
    .ticket-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
    .btn-full { width: 100%; padding: 14px; }
    .btn-link { padding: 0; background: none; border: none; color: var(--c-primary); font-size: 0.82rem; font-weight: 500; cursor: pointer; text-decoration: underline; font-family: var(--font-sans); }
    .btn-link:hover { color: var(--c-primary-dark); }

    /* Trip type buttons */
    .trip-btn { flex: 1; padding: 10px 8px; font-size: 0.86rem; font-weight: 500; border: 1.5px solid var(--c-gray-200); border-radius: var(--radius-md); background: #fff; color: var(--c-gray-500); cursor: pointer; font-family: var(--font-sans); transition: all 0.2s; }
    .trip-btn.active { border-color: var(--c-primary); background: var(--c-primary-light); color: var(--c-primary); font-weight: 600; }

    /* Chips */
    .chip { display: inline-flex; align-items: center; gap: 5px; padding: 5px 12px; border-radius: 20px; font-size: 0.82rem; font-weight: 500; }
    .chip-blue { background: var(--c-primary-light); color: var(--c-primary); border: 1px solid #B3D4FF; }
    .chip-remove { cursor: pointer; font-weight: 700; opacity: 0.6; transition: opacity 0.2s; }
    .chip-remove:hover { opacity: 1; }

    /* Stepper */
    .stepper { display: flex; justify-content: center; gap: 0; margin-bottom: 36px; position: relative; }
    .step-item { display: flex; align-items: center; gap: 8px; position: relative; z-index: 1; cursor: pointer; padding: 4px 8px; border-radius: 8px; transition: background 0.2s; }
    .step-item:hover { background: rgba(0,82,204,0.04); }
    .step-item.disabled { cursor: default; opacity: 0.35; }
    .step-item.disabled:hover { background: transparent; }
    .step-num { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; transition: all 0.3s; }
    .step-num.active { background: var(--c-primary); color: #fff; }
    .step-num.done { background: var(--c-success); color: #fff; }
    .step-num.pending { background: var(--c-gray-200); color: var(--c-gray-400); }
    .step-label { font-size: 0.84rem; color: var(--c-gray-500); font-weight: 500; }
    .step-connector { width: 48px; height: 2px; background: var(--c-gray-200); margin: 0 8px; align-self: center; border-radius: 1px; }
    .step-connector.done { background: var(--c-success); }

    /* Result card */
    .result-card { background: #fff; border: 1.5px solid var(--c-gray-200); border-radius: var(--radius-lg); padding: 24px; margin-bottom: 14px; transition: border-color 0.2s, box-shadow 0.2s; }
    .result-card.affordable { border-color: var(--c-success-border); box-shadow: 0 2px 12px rgba(11,138,62,0.06); }
    .result-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px; gap: 12px; flex-wrap: wrap; }
    .result-icon { width: 42px; height: 42px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .result-icon-text { color: #fff; font-weight: 700; font-size: 0.65rem; font-family: var(--font-mono); }
    .cabin-grid { display: grid; gap: 8px; }
    .cabin-cell { padding: 14px 10px; border-radius: var(--radius-md); text-align: center; border: 1px solid; }
    .cabin-cell.can-afford { background: var(--c-success-bg); border-color: var(--c-success-border); }
    .cabin-cell.cannot-afford { background: var(--c-gray-50); border-color: var(--c-gray-200); }
    .cabin-cell.maybe { background: var(--c-warning-bg); border-color: var(--c-warning-border); }
    .cabin-cell.maybe-possible { background: #F0FDF4; border-color: #86EFAC; }
    .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; color: #fff; }

    /* Dropdown */
    .dropdown { position: absolute; top: 100%; left: 0; right: 0; margin-top: 4px; background: #fff; border: 1.5px solid var(--c-gray-200); border-radius: var(--radius-md); max-height: 290px; overflow-y: auto; z-index: 100; box-shadow: var(--shadow-lg); }
    .dropdown-item { padding: 10px 16px; cursor: pointer; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid var(--c-gray-100); transition: background 0.15s; }
    .dropdown-item:last-child { border-bottom: none; }
    .dropdown-item:hover, .dropdown-item.highlighted { background: var(--c-primary-light); }
    .dropdown-header { padding: 8px 16px 6px; font-size: 0.72rem; color: var(--c-gray-400); font-weight: 700; letter-spacing: 0.06em; border-bottom: 1px solid var(--c-gray-100); background: var(--c-gray-50); text-transform: uppercase; }

    /* Fuel surcharge info */
    .fuel-badge { font-size: 0.72rem; padding: 2px 7px; border-radius: 4px; font-weight: 600; margin-left: 6px; }
    .fuel-low { background: #E6F8ED; color: #0B8A3E; }
    .fuel-mid { background: #FFF8EB; color: #D97706; }
    .fuel-high { background: #FFF1F0; color: #C92A2A; }

    /* Notice box */
    .notice { padding: 14px 18px; border-radius: var(--radius-md); font-size: 0.82rem; line-height: 1.7; }
    .notice-warn { background: var(--c-warning-bg); border: 1px solid var(--c-warning-border); color: #92400E; }
    .notice-info { background: var(--c-primary-light); border: 1px solid #B3D4FF; color: var(--c-primary-dark); }
    .notice-danger { background: var(--c-danger-bg); border: 1px solid #FCA5A5; color: var(--c-danger); }

    /* Toast notification */
    .toast-container { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 9999; pointer-events: none; }
    .toast { padding: 12px 20px; border-radius: var(--radius-md); font-size: 0.86rem; font-weight: 500; color: #fff; box-shadow: var(--shadow-lg); animation: toastIn 0.3s ease-out; white-space: nowrap; }
    .toast.hiding { animation: toastOut 0.3s ease-in forwards; }
    .toast-success { background: var(--c-success); }
    .toast-info { background: var(--c-primary); }
    .toast-warn { background: var(--c-warning); }

    /* Sort controls */
    .sort-bar { display: flex; gap: 6px; margin-bottom: 16px; flex-wrap: wrap; align-items: center; }
    .sort-btn { padding: 5px 12px; font-size: 0.78rem; font-weight: 500; border: 1px solid var(--c-gray-200); border-radius: 20px; background: #fff; color: var(--c-gray-500); cursor: pointer; font-family: var(--font-sans); transition: all 0.2s; }
    .sort-btn.active { background: var(--c-primary); color: #fff; border-color: var(--c-primary); }
    .sort-btn:hover:not(.active) { background: var(--c-gray-50); border-color: var(--c-gray-300); }

    /* Zone warning */
    .zone-warn { display: flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: var(--radius-md); background: #FFF8EB; border: 1px solid var(--c-warning-border); font-size: 0.82rem; color: #92400E; margin-top: -8px; margin-bottom: 16px; }

    /* Airport selected state */
    .airport-selected { display: flex; align-items: center; gap: 10px; padding: 10px 16px; border: 1.5px solid var(--c-primary); border-radius: var(--radius-md); background: var(--c-primary-light); }
    .airport-code { font-weight: 700; color: var(--c-primary); font-family: var(--font-mono); font-size: 0.95rem; }
    .airport-clear { cursor: pointer; color: var(--c-gray-400); font-weight: 700; font-size: 1.1rem; padding: 0 4px; line-height: 1; transition: color 0.2s; }
    .airport-clear:hover { color: var(--c-danger); }

    /* Points list item */
    .points-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 18px; border: 1px solid var(--c-gray-200); border-radius: var(--radius-md); margin-bottom: 8px; background: #fff; }
    .points-item-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 0.65rem; font-family: var(--font-mono); }



    /* Passengers stepper */
    .pax-stepper { display: flex; max-width: 200px; }
    .pax-btn { width: 46px; height: 46px; font-size: 1.1rem; padding: 0; }
    .pax-btn-left { border-radius: var(--radius-md) 0 0 var(--radius-md); border-right: none; }
    .pax-btn-right { border-radius: 0 var(--radius-md) var(--radius-md) 0; border-left: none; }
    .pax-display { flex: 1; height: 46px; border: 1.5px solid var(--c-gray-200); display: flex; align-items: center; justify-content: center; font-size: 0.95rem; font-weight: 600; font-family: var(--font-mono); }

    /* Responsive */
    @media (max-width: 640px) {
      .container { padding: 16px 12px 40px; }
      .card { padding: 20px 16px; }
      .cabin-grid { grid-template-columns: 1fr 1fr !important; }
      .cabin-grid-2 { grid-template-columns: 1fr 1fr !important; }
      .cabin-grid-1 { grid-template-columns: 1fr !important; }
      .stepper { gap: 0; }
      .step-connector { width: 24px; margin: 0 4px; }
      .step-label { font-size: 0.76rem; }
      .header-title { font-size: 1.5rem !important; }
      .trip-btn { font-size: 0.78rem; padding: 9px 4px; }
      .result-header { flex-direction: column !important; }
      .btn-row { flex-direction: column; }
      .btn-row .btn { width: 100%; }
      .add-row { flex-direction: column; }
      .add-row > * { min-width: 0 !important; }
    }

    /* Data loading overlay */
    .data-loading-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: var(--c-gray-50); z-index: 10000;
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px;
    }
    .data-loading-spinner {
      width: 48px; height: 48px; border: 4px solid var(--c-gray-200);
      border-top-color: var(--c-primary); border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-8px)} 40%,80%{transform:translateX(8px)} }
    .settings-toggle {
      position: fixed; bottom: 20px; right: 20px; z-index: 999;
      width: 44px; height: 44px; border-radius: 50%; border: 1.5px solid var(--c-gray-200);
      background: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center;
      box-shadow: var(--shadow-md); transition: all 0.2s; font-size: 1.2rem;
    }
    .settings-toggle:hover { background: var(--c-gray-50); border-color: var(--c-primary); transform: scale(1.1); }
    .settings-panel {
      position: fixed; bottom: 76px; right: 20px; z-index: 998;
      width: 380px; max-width: calc(100vw - 40px); background: #fff;
      border: 1.5px solid var(--c-gray-200); border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg); padding: 24px; animation: fadeUp 0.2s ease-out;
    }
    .data-status { display: flex; align-items: center; gap: 8px; padding: 10px 14px;
      border-radius: var(--radius-md); font-size: 0.82rem; margin-bottom: 12px; }
    .data-status.online { background: var(--c-success-bg); border: 1px solid var(--c-success-border); color: var(--c-success); }
    .data-status.offline { background: var(--c-warning-bg); border: 1px solid var(--c-warning-border); color: var(--c-warning); }
    .data-status.error { background: var(--c-danger-bg); border: 1px solid #FCA5A5; color: var(--c-danger); }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">

const { useState, useRef, useEffect, useMemo, useCallback } = React;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‹ Google Sheets ë°±ì—”ë“œ ì—°ë™ ì‹œìŠ¤í…œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GS_CONFIG_KEY = 'milePlanner_gsUrl';
const GS_CACHE_KEY = 'milePlanner_gsCache';
const GS_CACHE_TS_KEY = 'milePlanner_gsCacheTs';
const GS_CACHE_TTL = 1000 * 60 * 30; // 30ë¶„ ìºì‹œ

function getGsUrl() {
  try { return localStorage.getItem(GS_CONFIG_KEY) || ''; } catch(e) { return ''; }
}
function setGsUrl(url) {
  try { localStorage.setItem(GS_CONFIG_KEY, url); } catch(e) {}
}

// ìºì‹œì—ì„œ ë°ì´í„° ë¡œë“œ
function getCachedData() {
  try {
    const ts = parseInt(localStorage.getItem(GS_CACHE_TS_KEY) || '0');
    if (Date.now() - ts > GS_CACHE_TTL) return null;
    const raw = localStorage.getItem(GS_CACHE_KEY);
    return raw ? JSON.parse(raw) : null;
  } catch(e) { return null; }
}
function setCachedData(data) {
  try {
    localStorage.setItem(GS_CACHE_KEY, JSON.stringify(data));
    localStorage.setItem(GS_CACHE_TS_KEY, String(Date.now()));
  } catch(e) {}
}

// Google Sheetsì—ì„œ ë°ì´í„° fetch
async function fetchFromGoogleSheets(url) {
  if (!url) return null;
  const res = await fetch(url);
  if (!res.ok) throw new Error('HTTP ' + res.status);
  const data = await res.json();
  if (data.error) throw new Error(data.error);
  return data;
}

// Google Sheets ë°ì´í„°ë¥¼ ë‚´ë¶€ í˜•ì‹ì— ë§ê²Œ ì ìš©
function applyGoogleSheetsData(data) {
  if (!data) return;
  
  // í”„ë¡œê·¸ë¨ ë®ì–´ì“°ê¸°
  if (data.programs && data.programs.length > 0) {
    PROGRAMS.length = 0;
    data.programs.forEach(p => PROGRAMS.push(p));
    // ì¸ë±ìŠ¤ ë¦¬ë¹Œë“œ
    Object.keys(PROGRAM_MAP).forEach(k => delete PROGRAM_MAP[k]);
    PROGRAMS.forEach(p => { PROGRAM_MAP[p.name] = p; PROGRAM_MAP[p.code] = p; });
  }
  
  // ë§ˆì¼ ì°¨íŠ¸ ë®ì–´ì“°ê¸°
  if (data.charts && Object.keys(data.charts).length > 0) {
    Object.keys(CHARTS).forEach(k => delete CHARTS[k]);
    Object.assign(CHARTS, data.charts);
  }
  
  // ì¹´ë“œ ì´ì „ ë®ì–´ì“°ê¸°
  if (data.cardTransfers && Object.keys(data.cardTransfers).length > 0) {
    Object.keys(CARD_TRANSFERS).forEach(k => delete CARD_TRANSFERS[k]);
    Object.assign(CARD_TRANSFERS, data.cardTransfers);
  }
  
  // ìœ ë¥˜í• ì¦ ë®ì–´ì“°ê¸°
  if (data.fuelSurcharge && Object.keys(data.fuelSurcharge).length > 0) {
    Object.keys(FUEL_SURCHARGE).forEach(k => delete FUEL_SURCHARGE[k]);
    Object.assign(FUEL_SURCHARGE, data.fuelSurcharge);
  }
  
  // í•­ê³µì‚¬ ë§í¬ ë®ì–´ì“°ê¸°
  if (data.airlineLinks && Object.keys(data.airlineLinks).length > 0) {
    Object.keys(AIRLINE_LINKS).forEach(k => delete AIRLINE_LINKS[k]);
    Object.assign(AIRLINE_LINKS, data.airlineLinks);
  }
  
  // ì¡´ ì´ë¦„ ë®ì–´ì“°ê¸°
  if (data.zoneNames && Object.keys(data.zoneNames).length > 0) {
    Object.keys(ZONE_NAMES).forEach(k => delete ZONE_NAMES[k]);
    Object.assign(ZONE_NAMES, data.zoneNames);
  }
  
  // ê³µí•­ì¡´ ë®ì–´ì“°ê¸° (ì‹œíŠ¸ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´)
  if (data.airportZones && Object.keys(data.airportZones).length > 0) {
    Object.keys(AIRPORT_ZONE).forEach(k => delete AIRPORT_ZONE[k]);
    Object.assign(AIRPORT_ZONE, data.airportZones);
  }
  
  // ê³µí•­ ë°ì´í„° ë®ì–´ì“°ê¸° (ì‹œíŠ¸ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´)
  if (data.airports && data.airports.length > 0) {
    AIRPORTS.length = 0;
    data.airports.forEach(a => AIRPORTS.push(a));
    Object.keys(AIRPORT_MAP).forEach(k => delete AIRPORT_MAP[k]);
    AIRPORTS.forEach(a => { AIRPORT_MAP[a.code] = a; });
  }
  
  // â”€â”€ v2.0 ì‹ ê·œ ë°ì´í„° â”€â”€
  if (data.alliances && Object.keys(data.alliances).length > 0) {
    Object.keys(ALLIANCES).forEach(k => delete ALLIANCES[k]);
    Object.assign(ALLIANCES, data.alliances);
  }
  if (data.stopovers && Object.keys(data.stopovers).length > 0) {
    Object.keys(STOPOVERS).forEach(k => delete STOPOVERS[k]);
    Object.assign(STOPOVERS, data.stopovers);
  }
  if (data.sweetSpots && data.sweetSpots.length > 0) {
    SWEET_SPOTS.length = 0;
    data.sweetSpots.forEach(s => SWEET_SPOTS.push(s));
  }
  if (data.bookingFees && Object.keys(data.bookingFees).length > 0) {
    Object.keys(BOOKING_FEES).forEach(k => delete BOOKING_FEES[k]);
    Object.assign(BOOKING_FEES, data.bookingFees);
  }
  if (data.bonusEvents && data.bonusEvents.length > 0) {
    BONUS_EVENTS.length = 0;
    data.bonusEvents.forEach(e => BONUS_EVENTS.push(e));
  }
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€ ê³µí•­ ë°ì´í„° (ê¸°ë³¸ ë‚´ì¥ â€” êµ¬ê¸€ì‹œíŠ¸ ì—†ì„ ë•Œ í´ë°±) â”€â”€â”€â”€
let AIRPORTS = [
  // í•œêµ­
  {code:'ICN',name:'ì¸ì²œêµ­ì œê³µí•­',city:'ì„œìš¸/ì¸ì²œ'},{code:'GMP',name:'ê¹€í¬êµ­ì œê³µí•­',city:'ì„œìš¸/ê¹€í¬'},
  {code:'PUS',name:'ê¹€í•´êµ­ì œê³µí•­',city:'ë¶€ì‚°'},{code:'CJU',name:'ì œì£¼êµ­ì œê³µí•­',city:'ì œì£¼'},
  {code:'TAE',name:'ëŒ€êµ¬êµ­ì œê³µí•­',city:'ëŒ€êµ¬'},{code:'CJJ',name:'ì²­ì£¼êµ­ì œê³µí•­',city:'ì²­ì£¼'},
  {code:'MWX',name:'ë¬´ì•ˆêµ­ì œê³µí•­',city:'ë¬´ì•ˆ'},{code:'KWJ',name:'ê´‘ì£¼ê³µí•­',city:'ê´‘ì£¼'},
  {code:'RSU',name:'ì—¬ìˆ˜ê³µí•­',city:'ì—¬ìˆ˜'},{code:'USN',name:'ìš¸ì‚°ê³µí•­',city:'ìš¸ì‚°'},
  // ì¼ë³¸
  {code:'NRT',name:'ë‚˜ë¦¬íƒ€êµ­ì œê³µí•­',city:'ë„ì¿„/ë‚˜ë¦¬íƒ€'},{code:'HND',name:'í•˜ë„¤ë‹¤ê³µí•­',city:'ë„ì¿„/í•˜ë„¤ë‹¤'},
  {code:'KIX',name:'ê°„ì‚¬ì´êµ­ì œê³µí•­',city:'ì˜¤ì‚¬ì¹´'},{code:'ITM',name:'ì´íƒ€ë¯¸ê³µí•­',city:'ì˜¤ì‚¬ì¹´/ì´íƒ€ë¯¸'},
  {code:'NGO',name:'ì£¼ë¶€ì„¼íŠ¸ë ˆì•„',city:'ë‚˜ê³ ì•¼'},{code:'FUK',name:'í›„ì¿ ì˜¤ì¹´ê³µí•­',city:'í›„ì¿ ì˜¤ì¹´'},
  {code:'CTS',name:'ì‹ ì¹˜í† ì„¸ê³µí•­',city:'ì‚¿í¬ë¡œ'},{code:'OKA',name:'ë‚˜í•˜ê³µí•­',city:'ì˜¤í‚¤ë‚˜ì™€'},
  {code:'HIJ',name:'íˆë¡œì‹œë§ˆê³µí•­',city:'íˆë¡œì‹œë§ˆ'},{code:'KOJ',name:'ê°€ê³ ì‹œë§ˆê³µí•­',city:'ê°€ê³ ì‹œë§ˆ'},
  {code:'KMJ',name:'êµ¬ë§ˆëª¨í† ê³µí•­',city:'êµ¬ë§ˆëª¨í† '},{code:'SDJ',name:'ì„¼ë‹¤ì´ê³µí•­',city:'ì„¼ë‹¤ì´'},
  {code:'AOJ',name:'ì•„ì˜¤ëª¨ë¦¬ê³µí•­',city:'ì•„ì˜¤ëª¨ë¦¬'},{code:'KMQ',name:'ê³ ë§ˆì“°ê³µí•­',city:'ê°€ë‚˜ìì™€'},
  {code:'UKB',name:'ê³ ë² ê³µí•­',city:'ê³ ë² '},{code:'TAK',name:'ë‹¤ì¹´ë§ˆì“°ê³µí•­',city:'ë‹¤ì¹´ë§ˆì“°'},
  {code:'MYJ',name:'ë§ˆì“°ì•¼ë§ˆê³µí•­',city:'ë§ˆì“°ì•¼ë§ˆ'},{code:'OIT',name:'ì˜¤ì´íƒ€ê³µí•­',city:'ì˜¤ì´íƒ€'},
  {code:'NGS',name:'ë‚˜ê°€ì‚¬í‚¤ê³µí•­',city:'ë‚˜ê°€ì‚¬í‚¤'},{code:'ISG',name:'ì´ì‹œê°€í‚¤ê³µí•­',city:'ì´ì‹œê°€í‚¤'},
  {code:'MMY',name:'ë¯¸ì•¼ì½”ê³µí•­',city:'ë¯¸ì•¼ì½”'},
  // ì¤‘êµ­/í™ì½©/ë§ˆì¹´ì˜¤/ëŒ€ë§Œ
  {code:'PEK',name:'ë² ì´ì§• ìºí”¼íƒˆ',city:'ë² ì´ì§•'},{code:'PKX',name:'ë² ì´ì§• ë‹¤ì‹±',city:'ë² ì´ì§•/ë‹¤ì‹±'},
  {code:'PVG',name:'í‘¸ë™êµ­ì œê³µí•­',city:'ìƒí•˜ì´'},{code:'SHA',name:'í™ì°¨ì˜¤ê³µí•­',city:'ìƒí•˜ì´/í™ì°¨ì˜¤'},
  {code:'CAN',name:'ë°”ì´ìœˆêµ­ì œê³µí•­',city:'ê´‘ì €ìš°'},{code:'HKG',name:'ì²µëì½•ê³µí•­',city:'í™ì½©'},
  {code:'TPE',name:'íƒ€ì˜¤ìœ„ì•ˆêµ­ì œê³µí•­',city:'íƒ€ì´ë² ì´'},{code:'TSA',name:'ì‘¹ì‚°ê³µí•­',city:'íƒ€ì´ë² ì´/ì‘¹ì‚°'},
  {code:'MFM',name:'ë§ˆì¹´ì˜¤êµ­ì œê³µí•­',city:'ë§ˆì¹´ì˜¤'},{code:'CTU',name:'ì†½ë¥˜êµ­ì œê³µí•­',city:'ì²­ë‘'},
  {code:'KMG',name:'ì°½ìˆ˜ì´êµ­ì œê³µí•­',city:'ì¿¤ë°'},{code:'XIY',name:'ì…´ì–‘êµ­ì œê³µí•­',city:'ì‹œì•ˆ'},
  {code:'WUH',name:'í†ˆí—ˆêµ­ì œê³µí•­',city:'ìš°í•œ'},{code:'CSX',name:'í™©í™”êµ­ì œê³µí•­',city:'ì°½ì‚¬'},
  {code:'NKG',name:'ë£¨ì»¤ìš°êµ­ì œê³µí•­',city:'ë‚œì§•'},{code:'HAK',name:'ë©”ì´ë€êµ­ì œê³µí•­',city:'í•˜ì´ì»¤ìš°'},
  {code:'SZX',name:'ë°”ì˜¤ì•ˆêµ­ì œê³µí•­',city:'ì„ ì „'},{code:'XMN',name:'ê°€ì˜¤ì¹˜êµ­ì œê³µí•­',city:'ìƒ¤ë¨¼'},
  {code:'CKG',name:'ì¥ë² ì´êµ­ì œê³µí•­',city:'ì¶©ì¹­'},{code:'HGH',name:'ìƒ¤ì˜¤ì‚°êµ­ì œê³µí•­',city:'í•­ì €ìš°'},
  {code:'TSN',name:'ë¹ˆí•˜ì´êµ­ì œê³µí•­',city:'í†ˆì§„'},{code:'DLC',name:'ì €ìš°ìˆ˜ì´ì¯”ê³µí•­',city:'ë‹¤ë¡„'},
  {code:'SHE',name:'íƒ€ì˜¤ì…´êµ­ì œê³µí•­',city:'ì„ ì–‘'},{code:'HRB',name:'íƒ€ì´í•‘êµ­ì œê³µí•­',city:'í•˜ì–¼ë¹ˆ'},
  {code:'KHH',name:'ê°€ì˜¤ìˆ‘êµ­ì œê³µí•­',city:'ê°€ì˜¤ìŠ'},
  // ë™ë‚¨ì•„ì‹œì•„
  {code:'SIN',name:'ì°½ì´ê³µí•­',city:'ì‹±ê°€í¬ë¥´'},
  {code:'BKK',name:'ìˆ˜ì™„ë‚˜í’ˆê³µí•­',city:'ë°©ì½•'},{code:'DMK',name:'ëˆë¯€ì•™ê³µí•­',city:'ë°©ì½•/ëˆë¯€ì•™'},
  {code:'HKT',name:'í‘¸ì¼“êµ­ì œê³µí•­',city:'í‘¸ì¼“'},{code:'CNX',name:'ì¹˜ì•™ë§ˆì´ê³µí•­',city:'ì¹˜ì•™ë§ˆì´'},
  {code:'KBV',name:'ë„ë¼ë¹„ê³µí•­',city:'ë„ë¼ë¹„'},{code:'USM',name:'ì½”ì‚¬ë¬´ì´ê³µí•­',city:'ì½”ì‚¬ë¬´ì´'},
  {code:'KUL',name:'ì¿ ì•Œë¼ë£¸í‘¸ë¥´êµ­ì œê³µí•­',city:'ì¿ ì•Œë¼ë£¸í‘¸ë¥´'},{code:'PEN',name:'í˜ë‚­ê³µí•­',city:'í˜ë‚­'},
  {code:'BKI',name:'ì½”íƒ€í‚¤ë‚˜ë°œë£¨ê³µí•­',city:'ì½”íƒ€í‚¤ë‚˜ë°œë£¨'},{code:'KCH',name:'ì¿ ì¹­ê³µí•­',city:'ì¿ ì¹­'},
  {code:'SGN',name:'íƒ„ì†ë‚«ê³µí•­',city:'í˜¸ì¹˜ë¯¼'},{code:'HAN',name:'ë…¸ì´ë°”ì´ê³µí•­',city:'í•˜ë…¸ì´'},
  {code:'DAD',name:'ë‹¤ë‚­êµ­ì œê³µí•­',city:'ë‹¤ë‚­'},{code:'CXR',name:'ìº„ë€êµ­ì œê³µí•­',city:'ëƒì§±'},
  {code:'PQC',name:'í‘¸ê¾¸ì˜¥êµ­ì œê³µí•­',city:'í‘¸ê¾¸ì˜¥'},
  {code:'MNL',name:'ë‹ˆë…¸ì´ì•„í‚¤ë…¸ê³µí•­',city:'ë§ˆë‹ë¼'},{code:'CEB',name:'ë§‰íƒ„ì„¸ë¶€ê³µí•­',city:'ì„¸ë¶€'},
  {code:'DPS',name:'ì‘ìš°ë¼ë¼ì´ê³µí•­',city:'ë°œë¦¬'},{code:'CGK',name:'ìˆ˜ì¹´ë¥´ë…¸í•˜íƒ€ê³µí•­',city:'ìì¹´ë¥´íƒ€'},
  {code:'SUB',name:'ì£¼ì•ˆë‹¤êµ­ì œê³µí•­',city:'ìˆ˜ë¼ë°”ì•¼'},{code:'UPG',name:'í•˜ì‚¬ëˆ„ë”˜ê³µí•­',city:'ë§ˆì¹´ì‚¬ë¥´'},
  {code:'LOP',name:'ë¡¬ë³µêµ­ì œê³µí•­',city:'ë¡¬ë³µ'},{code:'MDC',name:'ìƒ˜ë¼íˆ´ë‘ì´ê³µí•­',city:'ë§ˆë‚˜ë„'},
  {code:'RGN',name:'ì–‘ê³¤êµ­ì œê³µí•­',city:'ì–‘ê³¤'},{code:'PNH',name:'í¬ì²¸í†µê³µí•­',city:'í”„ë†ˆíœ'},
  {code:'REP',name:'ì”¨ì— ë¦½ê³µí•­',city:'ì”¨ì— ë¦½'},{code:'VTE',name:'ì™€íƒ€ì´êµ­ì œê³µí•­',city:'ë¹„ì—”í‹°ì•ˆ'},
  {code:'BND',name:'ë°˜ë‹¤ë¥´ì•„ë°”ìŠ¤ê³µí•­',city:'ë°˜ë‹¤ë¥´ì•„ë°”ìŠ¤'},
  // ì¤‘ë™/ë‚¨ì•„ì‹œì•„/ì¤‘ì•™ì•„ì‹œì•„
  {code:'DXB',name:'ë‘ë°”ì´êµ­ì œê³µí•­',city:'ë‘ë°”ì´'},{code:'AUH',name:'ì•„ë¶€ë‹¤ë¹„ê³µí•­',city:'ì•„ë¶€ë‹¤ë¹„'},
  {code:'DOH',name:'í•˜ë§ˆë“œêµ­ì œê³µí•­',city:'ë„í•˜'},{code:'KWI',name:'ì¿ ì›¨ì´íŠ¸êµ­ì œê³µí•­',city:'ì¿ ì›¨ì´íŠ¸'},
  {code:'BAH',name:'ë°”ë ˆì¸êµ­ì œê³µí•­',city:'ë§ˆë‚˜ë§ˆ'},{code:'MCT',name:'ë¬´ìŠ¤ì¹´íŠ¸êµ­ì œê³µí•­',city:'ë¬´ìŠ¤ì¹´íŠ¸'},
  {code:'RUH',name:'í‚¹í• ë¦¬ë“œêµ­ì œê³µí•­',city:'ë¦¬ì•¼ë“œ'},{code:'JED',name:'í‚¹ì••ë‘˜ì•„ì§€ì¦ˆê³µí•­',city:'ì œë‹¤'},
  {code:'AMM',name:'í€¸ì•Œë¦¬ì•„ê³µí•­',city:'ì•”ë§Œ'},{code:'BEY',name:'ë² ì´ë£¨íŠ¸ê³µí•­',city:'ë² ì´ë£¨íŠ¸'},
  {code:'TLV',name:'ë²¤êµ¬ë¦¬ì˜¨ê³µí•­',city:'í…”ì•„ë¹„ë¸Œ'},{code:'CAI',name:'ì¹´ì´ë¡œêµ­ì œê³µí•­',city:'ì¹´ì´ë¡œ'},
  {code:'DEL',name:'ì¸ë””ë¼ê°„ë””ê³µí•­',city:'ë‰´ë¸ë¦¬'},{code:'BOM',name:'ì°¨íŠ¸ë¼íŒŒí‹°ì‹œë°”ì§€ê³µí•­',city:'ë­„ë°”ì´'},
  {code:'BLR',name:'ì¼í˜ê³ ìš°ë‹¤ê³µí•­',city:'ë°©ê°ˆë¡œë¥´'},{code:'MAA',name:'ì²¸ë‚˜ì´êµ­ì œê³µí•­',city:'ì²¸ë‚˜ì´'},
  {code:'HYD',name:'ë¼ì§€ë¸Œê°„ë””ê³µí•­',city:'í•˜ì´ë°ë¼ë°”ë“œ'},{code:'CCU',name:'ë„·íƒ€ì§€ìˆ˜ë°”ìŠ¤ê³µí•­',city:'ì½œì¹´íƒ€'},
  {code:'COK',name:'ì½”ì¹˜êµ­ì œê³µí•­',city:'ì½”ì¹˜'},{code:'AMD',name:'ì‚¬ë¥´ë‹¤ë¥´íŒŒí…”ê³µí•­',city:'ì•„ë§ˆë‹¤ë°”ë“œ'},
  {code:'CMB',name:'ë°˜ë‹¤ë¼ë‚˜ì´ì¼€ê³µí•­',city:'ì½œë¡¬ë³´'},{code:'KTM',name:'íŠ¸ë¦¬ë¶€ë°˜ê³µí•­',city:'ì¹´íŠ¸ë§Œë‘'},
  {code:'DAC',name:'í•˜ì¦ˆë¼íŠ¸ìƒ¤ì˜ë„ê³µí•­',city:'ë‹¤ì¹´'},{code:'KHI',name:'ì§„ë‚˜êµ­ì œê³µí•­',city:'ì¹´ë¼ì¹˜'},
  {code:'LHE',name:'ì•Œë¼ë§ˆì´í¬ë°œê³µí•­',city:'ë¼í˜¸ë¥´'},{code:'ISB',name:'ëˆ„ë¥´í•œêµ­ì œê³µí•­',city:'ì´ìŠ¬ë¼ë§ˆë°”ë“œ'},
  {code:'TAS',name:'íƒ€ìŠˆì¼„íŠ¸êµ­ì œê³µí•­',city:'íƒ€ìŠˆì¼„íŠ¸'},{code:'ALA',name:'ì•Œë§ˆí‹°ê³µí•­',city:'ì•Œë§ˆí‹°'},
  {code:'GYD',name:'í—¤ì´ë‹¤ë¥´ì•Œë¦¬ì˜ˆí”„ê³µí•­',city:'ë°”ì¿ '},
  // ìœ ëŸ½
  {code:'LHR',name:'íˆë“œë¡œê³µí•­',city:'ëŸ°ë˜'},{code:'LGW',name:'ê°œíŠ¸ìœ…ê³µí•­',city:'ëŸ°ë˜/ê°œíŠ¸ìœ…'},
  {code:'STN',name:'ìŠ¤íƒ ìŠ¤í…Œë“œê³µí•­',city:'ëŸ°ë˜/ìŠ¤íƒ ìŠ¤í…Œë“œ'},
  {code:'CDG',name:'ìƒ¤ë¥¼ë“œê³¨ê³µí•­',city:'íŒŒë¦¬'},{code:'ORY',name:'ì˜¤ë¥¼ë¦¬ê³µí•­',city:'íŒŒë¦¬/ì˜¤ë¥¼ë¦¬'},
  {code:'FRA',name:'í”„ë‘í¬í‘¸ë¥´íŠ¸ê³µí•­',city:'í”„ë‘í¬í‘¸ë¥´íŠ¸'},{code:'MUC',name:'ë®Œí—¨ê³µí•­',city:'ë®Œí—¨'},
  {code:'BER',name:'ë¸Œë€ë´ë¶€ë¥´í¬ê³µí•­',city:'ë² ë¥¼ë¦°'},{code:'HAM',name:'í•¨ë¶€ë¥´í¬ê³µí•­',city:'í•¨ë¶€ë¥´í¬'},
  {code:'DUS',name:'ë’¤ì…€ë„ë¥´í”„ê³µí•­',city:'ë’¤ì…€ë„ë¥´í”„'},{code:'STR',name:'ìŠˆíˆ¬íŠ¸ê°€ë¥´íŠ¸ê³µí•­',city:'ìŠˆíˆ¬íŠ¸ê°€ë¥´íŠ¸'},
  {code:'AMS',name:'ìŠ¤í‚¤í´ê³µí•­',city:'ì•”ìŠ¤í…Œë¥´ë‹´'},{code:'BRU',name:'ë¸Œë¤¼ì…€ê³µí•­',city:'ë¸Œë¤¼ì…€'},
  {code:'MAD',name:'ë°”ë¼í•˜ìŠ¤ê³µí•­',city:'ë§ˆë“œë¦¬ë“œ'},{code:'BCN',name:'ì—˜í”„ë¼íŠ¸ê³µí•­',city:'ë°”ë¥´ì…€ë¡œë‚˜'},
  {code:'PMI',name:'íŒ”ë§ˆê³µí•­',city:'íŒ”ë§ˆë°ë§ˆìš”ë¥´ì¹´'},
  {code:'FCO',name:'í”¼ìš°ë¯¸ì¹˜ë…¸ê³µí•­',city:'ë¡œë§ˆ'},{code:'MXP',name:'ë§íœì‚¬ê³µí•­',city:'ë°€ë¼ë…¸'},
  {code:'VCE',name:'ë§ˆë¥´ì½”í´ë¡œê³µí•­',city:'ë² ë„¤ì¹˜ì•„'},{code:'NAP',name:'ë‚˜í´ë¦¬ê³µí•­',city:'ë‚˜í´ë¦¬'},
  {code:'IST',name:'ì´ìŠ¤íƒ„ë¶ˆê³µí•­',city:'ì´ìŠ¤íƒ„ë¶ˆ'},{code:'SAW',name:'ì‚¬ë¹„í•˜ê´µì²¸ê³µí•­',city:'ì´ìŠ¤íƒ„ë¶ˆ/ì•„ì‹œì•„'},
  {code:'ATH',name:'ì—˜ë ˆí”„í…Œë¦¬ì˜¤ìŠ¤ê³µí•­',city:'ì•„í…Œë„¤'},{code:'HER',name:'ë‹ˆì½”ìŠ¤ì¹´ì”ì°¨í‚¤ìŠ¤ê³µí•­',city:'í—¤ë¼í´ë¦¬ì˜¨'},
  {code:'ZRH',name:'ì·¨ë¦¬íˆê³µí•­',city:'ì·¨ë¦¬íˆ'},{code:'GVA',name:'ì œë„¤ë°”ê³µí•­',city:'ì œë„¤ë°”'},
  {code:'VIE',name:'ë¹ˆêµ­ì œê³µí•­',city:'ë¹ˆ'},{code:'PRG',name:'ë°”ì¸¨ë¼í”„í•˜ë²¨ê³µí•­',city:'í”„ë¼í•˜'},
  {code:'BUD',name:'í˜ë Œì¸ ë¦¬ìŠ¤íŠ¸ê³µí•­',city:'ë¶€ë‹¤í˜ìŠ¤íŠ¸'},{code:'WAW',name:'ì‡¼íŒ½ê³µí•­',city:'ë°”ë¥´ìƒ¤ë°”'},
  {code:'ARN',name:'ì•„ë¥¼ë€ë‹¤ê³µí•­',city:'ìŠ¤í†¡í™€ë¦„'},{code:'CPH',name:'ì¹´ìŠ¤íŠ¸ë£¨í”„ê³µí•­',city:'ì½”íœí•˜ê²'},
  {code:'OSL',name:'ê°€ë¥´ë°ë¥´ëª¨ì—”ê³µí•­',city:'ì˜¤ìŠ¬ë¡œ'},{code:'HEL',name:'í—¬ì‹±í‚¤ê³µí•­',city:'í—¬ì‹±í‚¤'},
  {code:'DUB',name:'ë”ë¸”ë¦°ê³µí•­',city:'ë”ë¸”ë¦°'},{code:'LIS',name:'ì›€ë² ë¥´í† ë¸ê°€ë‘ê³µí•­',city:'ë¦¬ìŠ¤ë³¸'},
  {code:'OPO',name:'í”„ë€ì‹œìŠ¤ì½”ë“œì‚¬ê³µí•­',city:'í¬ë¥´íˆ¬'},{code:'EDI',name:'ì—ë“ ë²„ëŸ¬ê³µí•­',city:'ì—ë“ ë²„ëŸ¬'},
  {code:'MAN',name:'ë§¨ì²´ìŠ¤í„°ê³µí•­',city:'ë§¨ì²´ìŠ¤í„°'},
  {code:'NCE',name:'ì½”íŠ¸ë‹¤ì¥ë¥´ê³µí•­',city:'ë‹ˆìŠ¤'},{code:'MRS',name:'ë§ˆë¥´ì„¸ìœ ê³µí•­',city:'ë§ˆë¥´ì„¸ìœ '},
  {code:'LYS',name:'ìƒí…ì¥í˜ë¦¬ê³µí•­',city:'ë¦¬ì˜¹'},
  {code:'CIA',name:'ì§€ì•”í”¼ë…¸ê³µí•­',city:'ë¡œë§ˆ/ì¹˜ì•”í”¼ë…¸'},{code:'BGY',name:'ì˜¤ë¦¬ì˜¤ì•Œì„¸ë¦¬ì˜¤ê³µí•­',city:'ë°€ë¼ë…¸/ë² ë¥´ê°€ëª¨'},
  {code:'SVQ',name:'ì‚°íŒŒë¸”ë¡œê³µí•­',city:'ì„¸ë¹„ì•¼'},{code:'AGP',name:'ì½”ìŠ¤íƒ€ë¸ì†”ê³µí•­',city:'ë§ë¼ê°€'},
  {code:'ALC',name:'ì—˜ì²´ê³µí•­',city:'ì•Œë¦¬ì¹¸í…Œ'},
  {code:'BEG',name:'ë‹ˆì½œë¼í…ŒìŠ¬ë¼ê³µí•­',city:'ë² ì˜¤ê·¸ë¼ë“œ'},{code:'OTP',name:'ì˜¤í† í˜ë‹ˆê³µí•­',city:'ë¶€ì¿ ë ˆìŠˆí‹°'},
  {code:'SOF',name:'ì†Œí”¼ì•„ê³µí•­',city:'ì†Œí”¼ì•„'},{code:'LJU',name:'ìš”ì œí”„í”„ì²´ë‹‰ê³µí•­',city:'ë¥˜ë¸”ë´ë‚˜'},
  {code:'ZAG',name:'í”„ë¼ë‡¨íˆ¬ì§€ë§Œê³µí•­',city:'ìê·¸ë ˆë¸Œ'},{code:'DBV',name:'ë‘ë¸Œë¡œë¸Œë‹ˆí¬ê³µí•­',city:'ë‘ë¸Œë¡œë¸Œë‹ˆí¬'},
  {code:'KRK',name:'í¬ë¼ì¿ í”„ê³µí•­',city:'í¬ë¼ì¿ í”„'},{code:'TLL',name:'ë ˆë‚˜ë¥´íŠ¸ë©”ë¦¬ê³µí•­',city:'íƒˆë¦°'},
  {code:'RIX',name:'ë¦¬ê°€êµ­ì œê³µí•­',city:'ë¦¬ê°€'},{code:'VNO',name:'ë¹Œë‰´ìŠ¤ê³µí•­',city:'ë¹Œë‰´ìŠ¤'},
  {code:'LED',name:'í’€ì½”ë³´ê³µí•­',city:'ìƒíŠ¸í˜í…Œë¥´ë¶€ë¥´í¬'},{code:'SVO',name:'ì…°ë ˆë©”í‹°ì˜ˆë³´ê³µí•­',city:'ëª¨ìŠ¤í¬ë°”'},
  {code:'DME',name:'ë„ëª¨ë°ë„ë³´ê³µí•­',city:'ëª¨ìŠ¤í¬ë°”/ë„ëª¨ë°ë„ë³´'},
  {code:'KIV',name:'í‚¤ì‹œë‚˜ìš°ê³µí•­',city:'í‚¤ì‹œë‚˜ìš°'},{code:'SKP',name:'ì•Œë ‰ì‚°ë‹¤ë¥´ëŒ€ì™•ê³µí•­',city:'ìŠ¤ì½”í˜'},
  {code:'TIA',name:'í…Œë ˆì‚¬ê³µí•­',city:'í‹°ë¼ë‚˜'},{code:'TGD',name:'í¬ë“œê³ ë¦¬ì°¨ê³µí•­',city:'í¬ë“œê³ ë¦¬ì°¨'},
  {code:'TBS',name:'ì‡¼íƒ€ë£¨ìŠ¤íƒ€ë²¨ë¦¬ê³µí•­',city:'íŠ¸ë¹Œë¦¬ì‹œ'},{code:'EVN',name:'ì¦ˆë°”ë¥´íŠ¸ë…¸ì¸ ê³µí•­',city:'ì˜ˆë ˆë°˜'},
  {code:'IEV',name:'ë³´ë¦¬ìŠ¤í•„ê³µí•­',city:'í‚¤ì´ìš°'},
  // ë¶ë¯¸
  {code:'JFK',name:'JFKê³µí•­',city:'ë‰´ìš•'},{code:'EWR',name:'ë‰´ì–´í¬ê³µí•­',city:'ë‰´ìš•/ë‰´ì–´í¬'},
  {code:'LGA',name:'ë¼ê³¼ë””ì•„ê³µí•­',city:'ë‰´ìš•/ë¼ê³¼ë””ì•„'},
  {code:'BOS',name:'ë¡œê±´êµ­ì œê³µí•­',city:'ë³´ìŠ¤í„´'},{code:'IAD',name:'ëœë ˆìŠ¤ê³µí•­',city:'ì›Œì‹±í„´DC'},
  {code:'DCA',name:'ë ˆì´ê±´ê³µí•­',city:'ì›Œì‹±í„´DC/ë ˆì´ê±´'},
  {code:'MIA',name:'ë§ˆì´ì• ë¯¸ê³µí•­',city:'ë§ˆì´ì• ë¯¸'},{code:'FLL',name:'í¬íŠ¸ë¡œë”ë°ì¼ê³µí•­',city:'í¬íŠ¸ë¡œë”ë°ì¼'},
  {code:'TPA',name:'íƒ¬íŒŒêµ­ì œê³µí•­',city:'íƒ¬íŒŒ'},{code:'MCO',name:'ì˜¬ëœë„ê³µí•­',city:'ì˜¬ëœë„'},
  {code:'ATL',name:'í•˜ì¸ í•„ë“œê³µí•­',city:'ì• í‹€ëœíƒ€'},{code:'CLT',name:'ë”ê¸€ëŸ¬ìŠ¤ê³µí•­',city:'ìƒ¬ëŸ¿'},
  {code:'PHL',name:'í•„ë¼ë¸í”¼ì•„ê³µí•­',city:'í•„ë¼ë¸í”¼ì•„'},{code:'BDL',name:'ë¸Œë˜ë“¤ë¦¬ê³µí•­',city:'í•˜íŠ¸í¼ë“œ'},
  {code:'ORD',name:'ì˜¤í—¤ì–´ê³µí•­',city:'ì‹œì¹´ê³ '},{code:'MDW',name:'ë¯¸ë“œì›¨ì´ê³µí•­',city:'ì‹œì¹´ê³ /ë¯¸ë“œì›¨ì´'},
  {code:'DFW',name:'DFWê³µí•­',city:'ëŒˆëŸ¬ìŠ¤'},{code:'DAL',name:'ëŸ¬ë¸Œí•„ë“œê³µí•­',city:'ëŒˆëŸ¬ìŠ¤/ëŸ¬ë¸Œí•„ë“œ'},
  {code:'HOU',name:'í•˜ë¹„ê³µí•­',city:'íœ´ìŠ¤í„´/í•˜ë¹„'},{code:'IAH',name:'ë¶€ì‹œê³µí•­',city:'íœ´ìŠ¤í„´'},
  {code:'DEN',name:'ë´ë²„êµ­ì œê³µí•­',city:'ë´ë²„'},{code:'SLC',name:'ì†”íŠ¸ë ˆì´í¬ì‹œí‹°ê³µí•­',city:'ì†”íŠ¸ë ˆì´í¬ì‹œí‹°'},
  {code:'PHX',name:'ìŠ¤ì¹´ì´í•˜ë²„ê³µí•­',city:'í”¼ë‹‰ìŠ¤'},{code:'TUS',name:'íˆ¬ì†ê³µí•­',city:'íˆ¬ì†'},
  {code:'LAX',name:'LAXê³µí•­',city:'ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤'},{code:'BUR',name:'ë²„ë±…í¬ê³µí•­',city:'ë²„ë±…í¬'},
  {code:'LGB',name:'ë¡±ë¹„ì¹˜ê³µí•­',city:'ë¡±ë¹„ì¹˜'},{code:'ONT',name:'ì˜¨íƒ€ë¦¬ì˜¤ê³µí•­',city:'ì˜¨íƒ€ë¦¬ì˜¤'},
  {code:'SFO',name:'SFOê³µí•­',city:'ìƒŒí”„ë€ì‹œìŠ¤ì½”'},{code:'OAK',name:'ì˜¤í´ëœë“œê³µí•­',city:'ì˜¤í´ëœë“œ'},
  {code:'SJC',name:'ì‚°í˜¸ì„¸ê³µí•­',city:'ì‚°í˜¸ì„¸'},{code:'SEA',name:'íƒ€ì½”ë§ˆê³µí•­',city:'ì‹œì• í‹€'},
  {code:'PDX',name:'í¬í‹€ëœë“œê³µí•­',city:'í¬í‹€ëœë“œ'},{code:'LAS',name:'ë§¤ìºëŸ°ê³µí•­',city:'ë¼ìŠ¤ë² ê°€ìŠ¤'},
  {code:'MSP',name:'ë¯¸ë„¤ì•„í´ë¦¬ìŠ¤ê³µí•­',city:'ë¯¸ë„¤ì•„í´ë¦¬ìŠ¤'},{code:'DTW',name:'ë©”íŠ¸ë¡œê³µí•­',city:'ë””íŠ¸ë¡œì´íŠ¸'},
  {code:'PIT',name:'í”¼ì¸ ë²„ê·¸ê³µí•­',city:'í”¼ì¸ ë²„ê·¸'},{code:'BNA',name:'ë‚´ìŠˆë¹Œê³µí•­',city:'ë‚´ìŠˆë¹Œ'},
  {code:'MCI',name:'ìº”ììŠ¤ì‹œí‹°ê³µí•­',city:'ìº”ììŠ¤ì‹œí‹°'},{code:'STL',name:'ë‘ë²„íŠ¸ê³µí•­',city:'ì„¸ì¸íŠ¸ë£¨ì´ìŠ¤'},
  {code:'MSY',name:'ë£¨ì´ì•”ìŠ¤íŠ¸ë¡±ê³µí•­',city:'ë‰´ì˜¬ë¦¬ì–¸ìŠ¤'},{code:'SAT',name:'ìƒŒì•ˆí† ë‹ˆì˜¤ê³µí•­',city:'ìƒŒì•ˆí† ë‹ˆì˜¤'},
  {code:'AUS',name:'ì˜¤ìŠ¤í‹´ë²„ê·¸ìŠ¤íŠ¸ë¡¬ê³µí•­',city:'ì˜¤ìŠ¤í‹´'},{code:'RDU',name:'ë¡¤ë¦¬ë”ëŸ¼ê³µí•­',city:'ë¡¤ë¦¬'},
  {code:'SAN',name:'ë¦°ë“œë²„ê·¸ê³µí•­',city:'ìƒŒë””ì—ì´ê³ '},{code:'SMF',name:'ìƒˆí¬ë¼ë©˜í† ê³µí•­',city:'ìƒˆí¬ë¼ë©˜í† '},
  {code:'HNL',name:'í˜¸ë†€ë£°ë£¨ê³µí•­',city:'í˜¸ë†€ë£°ë£¨'},{code:'OGG',name:'ì¹´í›Œë£¨ì´ê³µí•­',city:'ë§ˆìš°ì´'},
  {code:'KOA',name:'ì½”ë‚˜ê³µí•­',city:'ì½”ë‚˜'},{code:'GUM',name:'ê´Œêµ­ì œê³µí•­',city:'ê´Œ'},
  {code:'SJU',name:'ë£¨ì´ìŠ¤ë¬´ë‡¨ìŠ¤ë§ˆë¦°ê³µí•­',city:'ì‚°í›„ì•ˆ'},
  {code:'YYZ',name:'í”¼ì–´ìŠ¨ê³µí•­',city:'í† ë¡ í† '},{code:'YVR',name:'ë°´ì¿ ë²„ê³µí•­',city:'ë°´ì¿ ë²„'},
  {code:'YYC',name:'ìº˜ê±°ë¦¬ê³µí•­',city:'ìº˜ê±°ë¦¬'},{code:'YEG',name:'ì—ë“œë¨¼í„´ê³µí•­',city:'ì—ë“œë¨¼í„´'},
  {code:'YOW',name:'ì˜¤íƒ€ì™€ê³µí•­',city:'ì˜¤íƒ€ì™€'},{code:'YUL',name:'íŠ¸ë¤¼ë„ê³µí•­',city:'ëª¬íŠ¸ë¦¬ì˜¬'},
  {code:'YHZ',name:'ìŠ¤íƒ í•„ë“œê³µí•­',city:'í•¼ë¦¬íŒ©ìŠ¤'},{code:'YWG',name:'ì œì„ìŠ¤ì•”ìŠ¤íŠ¸ë¡±ê³µí•­',city:'ìœ„ë‹ˆí™'},
  {code:'MEX',name:'ë² ë‹ˆí† í›„ì•„ë ˆìŠ¤ê³µí•­',city:'ë©•ì‹œì½”ì‹œí‹°'},{code:'CUN',name:'ì¹¸ì¿¤ê³µí•­',city:'ì¹¸ì¿¤'},
  {code:'GDL',name:'ë¯¸ê²”ì´ë‹¬ê³ ê³µí•­',city:'ê³¼ë‹¬ë¼í•˜ë¼'},{code:'MTY',name:'ë§ˆë¥´ì‹œì•„ë…¸ì—ìŠ¤ì¹´ì˜¤ë°”ë¥´ê³µí•­',city:'ëª¬í…Œë ˆì´'},
  // ì¤‘ë‚¨ë¯¸
  {code:'GRU',name:'êµ¬ì•„ë¥ ë¥˜ìŠ¤ê³µí•­',city:'ìƒíŒŒìš¸ë£¨'},{code:'GIG',name:'ê°ˆë ˆì•™êµ­ì œê³µí•­',city:'ë¦¬ìš°ë°ìë„¤ì´ë£¨'},
  {code:'BSB',name:'í”„ë ˆì§€ë´ì¹˜ì£¼ì…€ë¦¬ëˆ„ê³µí•­',city:'ë¸Œë¼ì§ˆë¦¬ì•„'},{code:'SSA',name:'ë£¨ì´ìŠ¤ì—ë‘ì•„ë¥´ë„ë§ˆê°€ëŸ‰ê³µí•­',city:'ì‚´ë°”ë„ë¥´'},
  {code:'EZE',name:'ì—ì„¸ì´ì‚¬ê³µí•­',city:'ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤'},{code:'AEP',name:'í˜¸ë¥´í—¤ë‰´ë² ë¦¬ê³µí•­',city:'ë¶€ì—ë…¸ìŠ¤ì•„ì´ë ˆìŠ¤/ì‹œë‚´'},
  {code:'SCL',name:'ì•„ë¥´íˆ¬ë¡œë©”ë¦¬ë…¸ê³µí•­',city:'ì‚°í‹°ì•„ê³ '},{code:'LIM',name:'í˜¸ë¥´í—¤ì°¨ë² ìŠ¤ê³µí•­',city:'ë¦¬ë§ˆ'},
  {code:'BOG',name:'ì—˜ë„ë¼ë„ê³µí•­',city:'ë³´ê³ íƒ€'},{code:'MDE',name:'í˜¸ì„¸ë§ˆë¦¬ì•„ì½”ë¥´ë„ë°”ê³µí•­',city:'ë©”ë°ì¸'},
  {code:'UIO',name:'ë§ˆë¦¬ìŠ¤ì¹¼ìˆ˜í¬ë ˆê³µí•­',city:'í‚¤í† '},{code:'GYE',name:'í˜¸ì„¸í˜¸ì•„í‚¨ë°ì˜¬ë©”ë„ê³µí•­',city:'ê³¼ì•¼í‚¬'},
  {code:'MVD',name:'ì¹´ë¼ìŠ¤ì½”ê³µí•­',city:'ëª¬í…Œë¹„ë°ì˜¤'},{code:'ASU',name:'ì‹¤ë¹„ì˜¤í˜í‹°ë¡œì‹œê³µí•­',city:'ì•„ìˆœì‹œì˜¨'},
  {code:'HAV',name:'í˜¸ì„¸ë§ˆë¥´í‹°ê³µí•­',city:'ì•„ë°”ë‚˜'},{code:'PTY',name:'í† ì¿ ë©˜ê³µí•­',city:'íŒŒë‚˜ë§ˆì‹œí‹°'},
  {code:'SJO',name:'í›„ì•ˆì‚°íƒ€ë§ˆë¦¬ì•„ê³µí•­',city:'ì‚°í˜¸ì„¸ (ì½”ìŠ¤íƒ€ë¦¬ì¹´)'},{code:'GUA',name:'ë¼ì˜¤ë¡œë¼ê³µí•­',city:'ê³¼í…Œë§ë¼ì‹œí‹°'},
  {code:'SAL',name:'ì˜¤ìŠ¤ì¹´ë¥´ë¡œë©”ë¡œê³µí•­',city:'ì‚°ì‚´ë°”ë„ë¥´'},{code:'SDQ',name:'ì•„ë©”ë¦¬ì¹´ìŠ¤ê³µí•­',city:'ì‚°í† ë„ë°ê³ '},
  {code:'NAS',name:'ë¦°ë“ í•€ë“¤ë§ê³µí•­',city:'ë‚˜ì†Œ'},
  // ì˜¤ì„¸ì•„ë‹ˆì•„
  {code:'SYD',name:'í‚¹ìŠ¤í¬ë“œìŠ¤ë¯¸ìŠ¤ê³µí•­',city:'ì‹œë“œë‹ˆ'},{code:'MEL',name:'ë©œë²„ë¥¸ê³µí•­',city:'ë©œë²„ë¥¸'},
  {code:'BNE',name:'ë¸Œë¦¬ì¦ˆë²ˆê³µí•­',city:'ë¸Œë¦¬ì¦ˆë²ˆ'},{code:'PER',name:'í¼ìŠ¤ê³µí•­',city:'í¼ìŠ¤'},
  {code:'ADL',name:'ì• ë“¤ë ˆì´ë“œê³µí•­',city:'ì• ë“¤ë ˆì´ë“œ'},{code:'CBR',name:'ìº”ë²„ë¼ê³µí•­',city:'ìº”ë²„ë¼'},
  {code:'OOL',name:'ê³¨ë“œì½”ìŠ¤íŠ¸ê³µí•­',city:'ê³¨ë“œì½”ìŠ¤íŠ¸'},{code:'CNS',name:'ì¼€ì–¸ì¦ˆê³µí•­',city:'ì¼€ì–¸ì¦ˆ'},
  {code:'AKL',name:'ì˜¤í´ëœë“œê³µí•­',city:'ì˜¤í´ëœë“œ'},{code:'CHC',name:'í¬ë¼ì´ìŠ¤íŠ¸ì²˜ì¹˜ê³µí•­',city:'í¬ë¼ì´ìŠ¤íŠ¸ì²˜ì¹˜'},
  {code:'WLG',name:'ì›°ë§í„´ê³µí•­',city:'ì›°ë§í„´'},{code:'NAN',name:'ë‚œë””ê³µí•­',city:'ìˆ˜ë°” (í”¼ì§€)'},
  {code:'PPT',name:'íŒŒì—ì•„ì•„ê³µí•­',city:'íŒŒí˜ì—í…Œ (íƒ€íˆí‹°)'},{code:'NOU',name:'í†µí†µêµ­ì œê³µí•­',city:'ëˆ„ë©”ì•„'},
  {code:'APW',name:'íŒŒë¼ë ˆë ˆê³µí•­',city:'ì•„í”¼ì•„ (ì‚¬ëª¨ì•„)'},{code:'HIR',name:'í˜¸ë‹ˆì•„ë¼ê³µí•­',city:'í˜¸ë‹ˆì•„ë¼'},
  // ì•„í”„ë¦¬ì¹´
  {code:'JNB',name:'ORíƒë³´ê³µí•­',city:'ìš”í•˜ë„¤ìŠ¤ë²„ê·¸'},{code:'CPT',name:'ì¼€ì´í”„íƒ€ìš´ê³µí•­',city:'ì¼€ì´í”„íƒ€ìš´'},
  {code:'DUR',name:'í‚¹ìƒ¤ì¹´ê³µí•­',city:'ë”ë°˜'},
  {code:'CMN',name:'ë¬´í•¨ë§ˆë“œ5ì„¸ê³µí•­',city:'ì¹´ì‚¬ë¸”ë‘ì¹´'},{code:'RAK',name:'ë©”ë‚˜ë¼ê³µí•­',city:'ë§ˆë¼ì¼€ì‹œ'},
  {code:'TUN',name:'ì¹´ë¥´íƒ€ê³ ê³µí•­',city:'íŠ€ë‹ˆìŠ¤'},{code:'ALG',name:'í›„ì•„ë¦¬ë¶€ë©”ë””ì—”ê³µí•­',city:'ì•Œì œ'},
  {code:'NBO',name:'ì¡°ëª¨ì¼€ëƒíƒ€ê³µí•­',city:'ë‚˜ì´ë¡œë¹„'},{code:'ADD',name:'ë³¼ë ˆê³µí•­',city:'ì•„ë””ìŠ¤ì•„ë°”ë°”'},
  {code:'DAR',name:'ì¤„ë¦¬ìš°ìŠ¤ë‹ˆì—ë ˆë ˆê³µí•­',city:'ë‹¤ë¥´ì—ìŠ¤ì‚´ëŒ'},{code:'EBB',name:'ì—”í…Œë² ê³µí•­',city:'ì—”í…Œë² '},
  {code:'ACC',name:'ì½”í† ì¹´ê³µí•­',city:'ì•„í¬ë¼'},{code:'LOS',name:'ë¬´ë¥´íƒˆë¼ë¬´í•¨ë§ˆë“œê³µí•­',city:'ë¼ê³ ìŠ¤'},
  {code:'ABV',name:'ë‚˜ë¬´ë””ë‚¨ë°”ê³µí•­',city:'ì•„ë¶€ì'},{code:'DKR',name:'ë ˆì˜¤í´ë“œìƒê³ ë¥´ê³µí•­',city:'ë‹¤ì¹´ë¥´'},
  {code:'ABJ',name:'í ë¦­ìŠ¤ìš°í‘¸ì—ë¶€ì•„ë‹ˆê³µí•­',city:'ì•„ë¹„ì¥'},{code:'DSS',name:'ë¸”ë ˆì¦ˆë””ì•„ë‰´ê³µí•­',city:'ë‹¤ì¹´ë¥´ ì‹ ê³µí•­'},
  {code:'RUN',name:'ë¡¤ë‘ê°€ë¡œìŠ¤ê³µí•­',city:'ë ˆìœ„ë‹ˆì˜¹'},
];

// â”€â”€â”€ O(1) ê³µí•­ ì¸ë±ìŠ¤ ë§µ (ì„±ëŠ¥ ê°œì„ ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let AIRPORT_MAP = {};
AIRPORTS.forEach(a => { AIRPORT_MAP[a.code] = a; });

// â”€â”€â”€ ê³µí•­ â†’ Zone ë§¤í•‘ (ê¸°ë³¸ ë‚´ì¥ â€” êµ¬ê¸€ì‹œíŠ¸ë¡œ ê´€ë¦¬ ê°€ëŠ¥) â”€â”€
let AIRPORT_ZONE = {
  ICN:'A',GMP:'A',PUS:'A',CJU:'A',TAE:'A',CJJ:'A',MWX:'A',KWJ:'A',RSU:'A',USN:'A',
  NRT:'B',HND:'B',KIX:'B',ITM:'B',NGO:'B',FUK:'B',CTS:'B',OKA:'B',HIJ:'B',
  KOJ:'B',KMJ:'B',SDJ:'B',AOJ:'B',KMQ:'B',UKB:'B',TAK:'B',MYJ:'B',OIT:'B',NGS:'B',ISG:'B',MMY:'B',
  PEK:'C',PKX:'C',PVG:'C',SHA:'C',CAN:'C',HKG:'C',TPE:'C',TSA:'C',MFM:'C',
  CTU:'C',KMG:'C',XIY:'C',WUH:'C',CSX:'C',NKG:'C',HAK:'C',SZX:'C',XMN:'C',
  CKG:'C',HGH:'C',TSN:'C',DLC:'C',SHE:'C',HRB:'C',KHH:'C',
  SIN:'D',BKK:'D',DMK:'D',HKT:'D',CNX:'D',KBV:'D',USM:'D',
  KUL:'D',PEN:'D',BKI:'D',KCH:'D',SGN:'D',HAN:'D',DAD:'D',CXR:'D',PQC:'D',
  MNL:'D',CEB:'D',DPS:'D',CGK:'D',SUB:'D',UPG:'D',LOP:'D',MDC:'D',
  RGN:'D',PNH:'D',REP:'D',VTE:'D',BND:'D',
  DXB:'E',AUH:'E',DOH:'E',KWI:'E',BAH:'E',MCT:'E',RUH:'E',JED:'E',
  AMM:'E',BEY:'E',TLV:'E',CAI:'E',
  DEL:'E',BOM:'E',BLR:'E',MAA:'E',HYD:'E',CCU:'E',COK:'E',AMD:'E',
  CMB:'E',KTM:'E',DAC:'E',KHI:'E',LHE:'E',ISB:'E',TAS:'E',ALA:'E',GYD:'E',
  LHR:'F',LGW:'F',STN:'F',CDG:'F',ORY:'F',FRA:'F',MUC:'F',BER:'F',HAM:'F',
  DUS:'F',STR:'F',AMS:'F',BRU:'F',MAD:'F',BCN:'F',PMI:'F',FCO:'F',MXP:'F',
  VCE:'F',NAP:'F',IST:'F',SAW:'F',ATH:'F',HER:'F',ZRH:'F',GVA:'F',VIE:'F',
  PRG:'F',BUD:'F',WAW:'F',ARN:'F',CPH:'F',OSL:'F',HEL:'F',DUB:'F',LIS:'F',
  OPO:'F',EDI:'F',MAN:'F',NCE:'F',MRS:'F',LYS:'F',CIA:'F',BGY:'F',SVQ:'F',
  AGP:'F',ALC:'F',BEG:'F',OTP:'F',SOF:'F',LJU:'F',ZAG:'F',DBV:'F',KRK:'F',
  TLL:'F',RIX:'F',VNO:'F',LED:'F',SVO:'F',DME:'F',KIV:'F',SKP:'F',TIA:'F',
  TGD:'F',TBS:'F',EVN:'F',IEV:'F',
  JFK:'G',EWR:'G',LGA:'G',BOS:'G',IAD:'G',DCA:'G',MIA:'G',FLL:'G',TPA:'G',
  MCO:'G',ATL:'G',CLT:'G',PHL:'G',BDL:'G',ORD:'G',MDW:'G',DFW:'G',DAL:'G',
  HOU:'G',IAH:'G',DEN:'G',SLC:'G',PHX:'G',TUS:'G',LAX:'G',BUR:'G',LGB:'G',
  ONT:'G',SFO:'G',OAK:'G',SJC:'G',SEA:'G',PDX:'G',LAS:'G',MSP:'G',DTW:'G',
  PIT:'G',BNA:'G',MCI:'G',STL:'G',MSY:'G',SAT:'G',AUS:'G',RDU:'G',SAN:'G',
  SMF:'G',SJU:'G',
  YYZ:'G',YVR:'G',YYC:'G',YEG:'G',YOW:'G',YUL:'G',YHZ:'G',YWG:'G',
  MEX:'G',CUN:'G',GDL:'G',MTY:'G',
  HNL:'H',OGG:'H',KOA:'H',GUM:'H',
  SYD:'I',MEL:'I',BNE:'I',PER:'I',ADL:'I',CBR:'I',OOL:'I',CNS:'I',
  AKL:'I',CHC:'I',WLG:'I',NAN:'I',PPT:'I',NOU:'I',APW:'I',HIR:'I',
  GRU:'J',GIG:'J',BSB:'J',SSA:'J',EZE:'J',AEP:'J',SCL:'J',LIM:'J',
  BOG:'J',MDE:'J',UIO:'J',GYE:'J',MVD:'J',ASU:'J',HAV:'J',PTY:'J',
  SJO:'J',GUA:'J',SAL:'J',SDQ:'J',NAS:'J',
  JNB:'K',CPT:'K',DUR:'K',CMN:'K',RAK:'K',TUN:'K',ALG:'K',
  NBO:'K',ADD:'K',DAR:'K',EBB:'K',ACC:'K',LOS:'K',ABV:'K',DKR:'K',ABJ:'K',DSS:'K',RUN:'K',
};

let ZONE_NAMES = {
  A:'í•œêµ­',B:'ì¼ë³¸',C:'ì¤‘êµ­/í™ì½©/ëŒ€ë§Œ',D:'ë™ë‚¨ì•„ì‹œì•„',
  E:'ì¤‘ë™/ë‚¨ì•„ì‹œì•„',F:'ìœ ëŸ½',G:'ë¶ë¯¸/ìºë‚˜ë‹¤/ë©•ì‹œì½”',H:'í•˜ì™€ì´/ê´Œ',
  I:'ì˜¤ì„¸ì•„ë‹ˆì•„',J:'ì¤‘ë‚¨ë¯¸',K:'ì•„í”„ë¦¬ì¹´',
};

// â”€â”€â”€ ë§ˆì¼ë¦¬ì§€ í”„ë¡œê·¸ë¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let PROGRAMS = [
  {name:'ëŒ€í•œí•­ê³µ ìŠ¤ì¹´ì´íŒ¨ìŠ¤',code:'KE',color:'#0d3b8c',cat:'í•­ê³µ'},
  {name:'ì•„ì‹œì•„ë‚˜ ì•„ì‹œì•„ë‚˜í´ëŸ½',code:'OZ',color:'#e31e24',cat:'í•­ê³µ'},
  {name:'ì•„ë©”ë¦¬ì¹¸ AAdvantage',code:'AA',color:'#0078d2',cat:'í•­ê³µ'},
  {name:'ìœ ë‚˜ì´í‹°ë“œ ë§ˆì¼ë¦¬ì§€í”ŒëŸ¬ìŠ¤',code:'UA',color:'#002244',cat:'í•­ê³µ'},
  {name:'ë¸íƒ€ ìŠ¤ì¹´ì´ë§ˆì¼ìŠ¤',code:'DL',color:'#c8102e',cat:'í•­ê³µ'},
  {name:'ì•Œë˜ìŠ¤ì¹´ ì•„íŠ¸ëª¨ìŠ¤ ë¦¬ì›Œë“œ',code:'AS',color:'#01426a',cat:'í•­ê³µ'},
  {name:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ',code:'AC',color:'#d52b1e',cat:'í•­ê³µ'},
  {name:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ',code:'AV',color:'#d4232a',cat:'í•­ê³µ'},
  {name:'ë£¨í”„íŠ¸í•œì ë§ˆì¼ì¦ˆì•¤ëª¨ì–´',code:'LH',color:'#05164d',cat:'í•­ê³µ'},
  {name:'ë¸Œë¦¬í‹°ì‹œ ì—ì–´ì›¨ì´ìŠ¤ Avios',code:'BA',color:'#075aaa',cat:'í•­ê³µ'},
  {name:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨',code:'AF',color:'#002157',cat:'í•­ê³µ'},
  {name:'ì´ë² ë¦¬ì•„ Avios',code:'IB',color:'#ec1c24',cat:'í•­ê³µ'},
  {name:'í„°í‚¤í•­ê³µ ë§ˆì¼ì¦ˆì•¤ìŠ¤ë§ˆì¼ì¦ˆ',code:'TK',color:'#c70a13',cat:'í•­ê³µ'},
  {name:'ANA ë§ˆì¼ë¦¬ì§€í´ëŸ½',code:'NH',color:'#15428b',cat:'í•­ê³µ'},
  {name:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬',code:'JL',color:'#d62b1f',cat:'í•­ê³µ'},
  {name:'ì‹±ê°€í¬ë¥´ í¬ë¦¬ìŠ¤í”Œë¼ì´ì–´',code:'SQ',color:'#003876',cat:'í•­ê³µ'},
  {name:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ',code:'CX',color:'#005448',cat:'í•­ê³µ'},
  {name:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ',code:'EK',color:'#d71921',cat:'í•­ê³µ'},
  {name:'ì—í‹°í•˜ë“œ ê²ŒìŠ¤íŠ¸',code:'EY',color:'#986328',cat:'í•­ê³µ'},
  {name:'ì¹´íƒ€ë¥´ í”„ë¦¬ë¹Œë¦¬ì§€í´ëŸ½',code:'QR',color:'#5c0931',cat:'í•­ê³µ'},
  {name:'ì½´íƒ€ìŠ¤ í”„ë¦¬í€€íŠ¸í”Œë¼ì´ì–´',code:'QF',color:'#e0001b',cat:'í•­ê³µ'},
  {name:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½',code:'VS',color:'#e10026',cat:'í•­ê³µ'},
  {name:'ì•„ë©•ìŠ¤ ë©¤ë²„ì‹­ ë¦¬ì›Œë“œ',code:'AMEX',color:'#006fcf',cat:'ì¹´ë“œ'},
  {name:'ì²´ì´ìŠ¤ ì–¼í‹°ë°‹ ë¦¬ì›Œë“œ',code:'Chase',color:'#117aca',cat:'ì¹´ë“œ'},
  {name:'Citi ë•¡í í¬ì¸íŠ¸',code:'Citi',color:'#056dae',cat:'ì¹´ë“œ'},
  {name:'ìºí”¼í„¸ì› ë§ˆì¼ì¦ˆ',code:'CapOne',color:'#004879',cat:'ì¹´ë“œ'},
  {name:'Bilt ë¦¬ì›Œë“œ',code:'Bilt',color:'#1a1a1a',cat:'ì¹´ë“œ'},
  // v2.0 ì¶”ê°€
  {name:'Wells Fargo Autograph',code:'WF',color:'#d71e28',cat:'ì¹´ë“œ'},
  {name:'ë©”ë¦¬ì–´íŠ¸ ë³¸ë³´ì´',code:'Marriott',color:'#8c1d40',cat:'í˜¸í…”'},
  {name:'ííŠ¼ ì•„ë„ˆìŠ¤',code:'Hilton',color:'#104c97',cat:'í˜¸í…”'},
  {name:'ì›”ë“œì˜¤ë¸Œí•˜ì–íŠ¸',code:'Hyatt',color:'#c4985a',cat:'í˜¸í…”'},
];

// O(1) í”„ë¡œê·¸ë¨ ì¸ë±ìŠ¤
let PROGRAM_MAP = {};
PROGRAMS.forEach(p => { PROGRAM_MAP[p.name] = p; PROGRAM_MAP[p.code] = p; });

// â”€â”€â”€ ë§ˆì¼ ì°¨íŠ¸ ë°ì´í„° (IB ì¶”ê°€, ì¼ë¶€ êµ¬ê°„ ë³´ê°•) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let CHARTS = {
  KE: {name:'ëŒ€í•œí•­ê³µ ìŠ¤ì¹´ì´íŒ¨ìŠ¤', note:'ìŠ¤ì¹´ì´íŒ€ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-B':{E:15000,B:40000,F:80000},'A-C':{E:20000,B:45000,F:80000},
       'A-D':{E:25000,B:60000,F:115000},'A-E':{E:35000,B:70000},
       'A-F':{E:42500,B:80000,F:115000},'A-G':{E:35000,B:80000,F:115000},
       'A-H':{E:25000,B:60000},'A-I':{E:35000,B:80000,F:115000},
       'A-J':{E:50000,B:100000,F:150000},'A-K':{E:50000,B:100000},
       'B-C':{E:12000,B:30000,F:60000},'B-G':{E:35000,B:80000,F:115000},
       'C-G':{E:35000,B:80000,F:115000},'D-F':{E:35000,B:70000},
       'F-G':{E:42500,B:80000,F:115000},
       'G-H':{E:17500,B:35000},'G-I':{E:40000,B:80000,F:115000}}},
  OZ: {name:'ì•„ì‹œì•„ë‚˜ ì•„ì‹œì•„ë‚˜í´ëŸ½', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-B':{E:12000,B:35000,F:70000},'A-C':{E:17000,B:40000,F:70000},
       'A-D':{E:22000,B:55000,F:105000},'A-E':{E:30000,B:65000},
       'A-F':{E:40000,B:75000,F:115000},'A-G':{E:35000,B:75000,F:115000},
       'A-H':{E:22000,B:55000},'A-I':{E:35000,B:75000,F:115000},
       'B-G':{E:35000,B:70000,F:115000},'D-F':{E:35000,B:65000},
       'F-G':{E:40000,B:75000,F:115000}}},
  AA: {name:'ì•„ë©”ë¦¬ì¹¸ AAdvantage', note:'ì›ì›”ë“œ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-G':{E:35000,B:65000,F:110000},'B-G':{E:30000,B:60000,F:80000},
       'C-G':{E:35000,B:65000,F:110000},'D-G':{E:40000,B:80000,F:110000},
       'F-G':{E:30000,B:57500,F:85000},'G-G':{E:7500,B:15000,F:25000},
       'G-H':{E:17500,B:35000,F:50000},'A-F':{E:42500,B:65000,F:110000},
       'A-B':{E:20000,B:40000,F:60000},'B-F':{E:35000,B:62500,F:85000},
       'G-I':{E:40000,B:80000,F:110000},'G-J':{E:30000,B:57500,F:85000}}},
  UA: {name:'ìœ ë‚˜ì´í‹°ë“œ ë§ˆì¼ë¦¬ì§€í”ŒëŸ¬ìŠ¤', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-G':{E:35000,B:70000,F:110000},'B-G':{E:35000,B:70000,F:110000},
       'C-G':{E:35000,B:70000,F:110000},'F-G':{E:30000,B:60000,F:110000},
       'G-G':{E:12500,B:25000,F:50000},'G-H':{E:22500,B:45000,F:90000},
       'A-F':{E:42500,B:70000,F:110000},'A-B':{E:17500,B:40000,F:75000},
       'B-F':{E:42500,B:70000,F:110000},'G-I':{E:40000,B:80000,F:120000},
       'G-J':{E:30000,B:60000,F:100000}}},
  AS: {name:'ì•Œë˜ìŠ¤ì¹´ ì•„íŠ¸ëª¨ìŠ¤ ë¦¬ì›Œë“œ', note:'ì›ì›”ë“œ íŒŒíŠ¸ë„ˆ (ê±°ë¦¬ ê¸°ë°˜, ìµœì†Œ ìš”êµ¬ëŸ‰)',
    r:{'A-G':{E:35000,B:60000,F:80000},'B-G':{E:30000,B:60000,F:80000},
       'C-G':{E:35000,B:60000,F:80000},'F-G':{E:30000,B:60000,F:80000},
       'G-G':{E:12500,B:25000},'A-F':{E:42500,B:65000,F:85000},
       'B-F':{E:35000,B:60000,F:80000},'E-G':{E:40000,B:65000,F:90000}}},
  DL: {name:'ë¸íƒ€ ìŠ¤ì¹´ì´ë§ˆì¼ìŠ¤', note:'ë™ì  ê°€ê²©ì œ (ì°¸ê³ ìš© ë²”ìœ„)', dynamic:true,
    r:{'A-G':{E:'60k~120k',B:'130k~220k'},'B-G':{E:'50k~100k',B:'110k~200k'},
       'F-G':{E:'40k~80k',B:'80k~160k'},'G-G':{E:'10k~50k',B:'25k~100k'},
       'A-F':{E:'50k~100k',B:'100k~200k'}}},
  NH: {name:'ANA ë§ˆì¼ë¦¬ì§€í´ëŸ½', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ íŒŒíŠ¸ë„ˆ (2024.4 ê°œì •)',
    r:{'A-B':{E:15000,B:30000},'B-G':{E:55000,B:110000,F:165000},
       'B-F':{E:55000,B:110000,F:165000},'A-G':{E:55000,B:110000,F:165000},
       'A-F':{E:55000,B:110000,F:165000},'B-D':{E:20000,B:38000,F:55000},
       'A-D':{E:20000,B:38000},'B-I':{E:45000,B:80000,F:130000}}},
  JL: {name:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', note:'ì›ì›”ë“œ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-B':{E:12000,B:21000},'B-G':{E:60000,B:100000,F:150000},
       'B-F':{E:60000,B:100000,F:150000},'A-G':{E:60000,B:100000,F:150000},
       'A-F':{E:60000,B:100000,F:150000},'B-D':{E:17000,B:30000},
       'A-D':{E:17000,B:30000},'B-I':{E:45000,B:75000,F:110000}}},
  SQ: {name:'ì‹±ê°€í¬ë¥´ í¬ë¦¬ìŠ¤í”Œë¼ì´ì–´', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-D':{E:22500,B:35000},'D-G':{E:78000,B:130000,F:171500},
       'D-F':{E:65000,B:100000,F:136500},'B-G':{E:78000,B:130000},
       'F-G':{E:65000,B:100000},'A-G':{E:78000,B:130000},
       'D-I':{E:42500,B:65000,F:91000}}},
  CX: {name:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ', note:'ì›ì›”ë“œ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-C':{E:17500,B:35000},'C-G':{E:35000,B:75000,F:110000},
       'C-F':{E:35000,B:75000,F:110000},'A-G':{E:35000,B:75000,F:110000},
       'A-F':{E:35000,B:75000,F:110000},'D-G':{E:35000,B:75000,F:110000},
       'D-F':{E:30000,B:60000,F:90000}}},
  EK: {name:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', note:'ì—ë¯¸ë ˆì´íŠ¸ ë‹¨ë…',
    r:{'A-E':{E:25000,B:50000,F:75000},'E-F':{E:27500,B:55000,F:82500},
       'E-G':{E:42500,B:77500,F:115000},'A-F':{E:52500,B:105000,F:142500},
       'A-G':{E:70000,B:110000,F:150000},'D-E':{E:20000,B:40000,F:60000}}},
  QR: {name:'ì¹´íƒ€ë¥´ í”„ë¦¬ë¹Œë¦¬ì§€í´ëŸ½', note:'ì›ì›”ë“œ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-E':{E:25000,B:50000,F:75000},'E-F':{E:25000,B:50000,F:75000},
       'E-G':{E:45000,B:90000,F:135000},'A-G':{E:70000,B:110000},
       'A-F':{E:50000,B:95000}}},
  BA: {name:'ë¸Œë¦¬í‹°ì‹œ ì—ì–´ì›¨ì´ìŠ¤ Avios', note:'ì›ì›”ë“œ (ê±°ë¦¬ ê¸°ë°˜)',
    r:{'A-B':{E:15000,B:30000,F:45000},'A-C':{E:20000,B:40000,F:60000},
       'A-D':{E:30000,B:60000,F:90000},'A-F':{E:50000,B:100000,F:150000},
       'A-G':{E:50000,B:100000,F:150000},'F-G':{E:30000,B:60000,F:90000},
       'B-G':{E:45000,B:90000,F:135000},'G-G':{E:9000,B:18000},
       'D-F':{E:40000,B:80000,F:120000}}},
  // FIX: IB ì°¨íŠ¸ ì¶”ê°€ â€” Avios ê¸°ë°˜ (BAì™€ ìœ ì‚¬í•œ êµ¬ì¡°)
  IB: {name:'ì´ë² ë¦¬ì•„ Avios', note:'ì›ì›”ë“œ íŒŒíŠ¸ë„ˆ (Avios ê¸°ë°˜)',
    r:{'A-B':{E:15000,B:30000,F:45000},'A-C':{E:20000,B:40000,F:60000},
       'A-D':{E:30000,B:60000,F:90000},'A-F':{E:42500,B:85000,F:127500},
       'A-G':{E:42500,B:85000,F:127500},'F-G':{E:25500,B:51000,F:76500},
       'B-G':{E:42500,B:85000,F:127500},'G-G':{E:8500,B:17000},
       'G-J':{E:25500,B:51000,F:76500}}},
  AF: {name:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', note:'ìŠ¤ì¹´ì´íŒ€ íŒŒíŠ¸ë„ˆ (ë™ì  ê°€ê²©ì œ)', dynamic:true,
    r:{'A-F':{E:'25k~50k',B:'60k~130k',F:'100k~200k'},
       'F-G':{E:'25k~50k',B:'60k~130k',F:'100k~200k'},
       'A-G':{E:'35k~70k',B:'80k~160k'},
       'D-F':{E:'20k~40k',B:'50k~100k'}}},
  LH: {name:'ë£¨í”„íŠ¸í•œì ë§ˆì¼ì¦ˆì•¤ëª¨ì–´', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-F':{E:43750,B:87500,F:130000},'A-G':{E:55000,B:110000,F:150000},
       'F-G':{E:30000,B:60000,F:90000},'B-F':{E:40000,B:80000,F:120000},
       'B-G':{E:55000,B:110000},'A-B':{E:15000,B:30000}}},
  AC: {name:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ (AC/UA ë™ì , íŒŒíŠ¸ë„ˆ ê³ ì •)',
    r:{'A-G':{E:30000,B:55000,F:75000},'A-F':{E:30000,B:55000,F:75000},
       'A-B':{E:12500,B:25000},'A-D':{E:17500,B:35000},
       'B-G':{E:30000,B:55000,F:75000},'F-G':{E:30000,B:55000,F:75000},
       'G-G':{E:12500,B:25000},'G-H':{E:12500,B:25000},
       'A-I':{E:37500,B:65000,F:85000},'G-I':{E:37500,B:65000},
       'G-J':{E:25000,B:50000,F:70000}}},
  AV: {name:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ (2025.2 ê°œì •)',
    r:{'A-G':{E:55000,B:90000,F:120000},'A-F':{E:40000,B:80000,F:120000},
       'A-B':{E:15000,B:30000},'B-G':{E:55000,B:90000},
       'F-G':{E:35000,B:63000},'G-G':{E:10000,B:20000},
       'G-H':{E:10000,B:20000},'A-D':{E:20000,B:40000},
       'G-J':{E:20000,B:40000}}},
  VS: {name:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', note:'ë¸íƒ€ íŒŒíŠ¸ë„ˆ, ANA íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-G':{E:50000,B:95000,F:110000},'B-G':{E:45000,B:85000,F:100000},
       'F-G':{E:30000,B:60000,F:75000},'G-G':{E:12500,B:25000},
       'A-F':{E:35000,B:65000,F:80000},'B-F':{E:30000,B:60000,F:75000}}},
  QF: {name:'ì½´íƒ€ìŠ¤ í”„ë¦¬í€€íŠ¸í”Œë¼ì´ì–´', note:'ì›ì›”ë“œ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-B':{E:9000,B:18000,F:36000},'A-G':{E:41500,B:80000,F:110000},
       'A-F':{E:36000,B:72000,F:110000},'B-G':{E:41500,B:80000,F:110000},
       'F-G':{E:30000,B:60000,F:80000},'A-I':{E:18000,B:36000,F:72000},
       'G-I':{E:20000,B:40000,F:80000}}},
  TK: {name:'í„°í‚¤í•­ê³µ ë§ˆì¼ì¦ˆì•¤ìŠ¤ë§ˆì¼ì¦ˆ', note:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-F':{E:45000,B:75000,F:90000},'A-G':{E:55000,B:95000,F:110000},
       'B-G':{E:55000,B:95000,F:110000},'F-G':{E:25000,B:45000,F:60000},
       'A-B':{E:10000,B:20000},'A-E':{E:25000,B:45000},
       'D-F':{E:35000,B:60000}}},
  EY: {name:'ì—í‹°í•˜ë“œ ê²ŒìŠ¤íŠ¸', note:'ì—í‹°í•˜ë“œ íŒŒíŠ¸ë„ˆ í¬í•¨',
    r:{'A-E':{E:25000,B:50000,F:75000},'E-F':{E:25000,B:50000,F:75000},
       'E-G':{E:45000,B:80000,F:120000},'A-G':{E:55000,B:90000,F:130000},
       'F-G':{E:30000,B:60000,F:90000}}},
};

// â”€â”€â”€ ì¹´ë“œ í¬ì¸íŠ¸ ì´ì „ íŒŒíŠ¸ë„ˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let CARD_TRANSFERS = {
  AMEX: {name:'ì•„ë©•ìŠ¤ ë©¤ë²„ì‹­ ë¦¬ì›Œë“œ', color:'#006fcf',
    to:[
      {code:'NH',  label:'ANA ë§ˆì¼ë¦¬ì§€í´ëŸ½', ratio:1},
      {code:'SQ',  label:'ì‹±ê°€í¬ë¥´í•­ê³µ í¬ë¦¬ìŠ¤í”Œë¼ì´ì–´', ratio:1},
      {code:'BA',  label:'British Airways Avios', ratio:1},
      {code:'AF',  label:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', ratio:1},
      {code:'DL',  label:'ë¸íƒ€ ìŠ¤ì¹´ì´ë§ˆì¼ìŠ¤', ratio:1},
      {code:'AC',  label:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', ratio:1},
      {code:'CX',  label:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:0.8},
      {code:'EY',  label:'ì—í‹°í•˜ë“œ ê²ŒìŠ¤íŠ¸', ratio:1},
      {code:'QF',  label:'ì½´íƒ€ìŠ¤ í”„ë¦¬í€€íŠ¸í”Œë¼ì´ì–´', ratio:1},
      {code:'QR',  label:'ì¹´íƒ€ë¥´ í”„ë¦¬ë¹Œë¦¬ì§€í´ëŸ½', ratio:1},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:1},
      {code:'AV',  label:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'IB',  label:'ì´ë² ë¦¬ì•„ Avios', ratio:1},
      {code:'JL',  label:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', ratio:1},
    ]},
  Chase: {name:'ì²´ì´ìŠ¤ ì–¼í‹°ë°‹ ë¦¬ì›Œë“œ', color:'#117aca',
    to:[
      {code:'UA',  label:'ìœ ë‚˜ì´í‹°ë“œ ë§ˆì¼ë¦¬ì§€í”ŒëŸ¬ìŠ¤', ratio:1},
      {code:'SQ',  label:'ì‹±ê°€í¬ë¥´í•­ê³µ í¬ë¦¬ìŠ¤í”Œë¼ì´ì–´', ratio:1},
      {code:'BA',  label:'British Airways Avios', ratio:1},
      {code:'AF',  label:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', ratio:1},
      {code:'AC',  label:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', ratio:1},
      {code:'QR',  label:'ì¹´íƒ€ë¥´ í”„ë¦¬ë¹Œë¦¬ì§€í´ëŸ½', ratio:1},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:1},
      {code:'IB',  label:'ì´ë² ë¦¬ì•„ Avios', ratio:1},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:1},
      {code:'JL',  label:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', ratio:1},
    ]},
  Citi: {name:'Citi ë•¡í í¬ì¸íŠ¸', color:'#056dae',
    to:[
      {code:'AA',  label:'ì•„ë©”ë¦¬ì¹¸ AAdvantage', ratio:1},
      {code:'SQ',  label:'ì‹±ê°€í¬ë¥´í•­ê³µ í¬ë¦¬ìŠ¤í”Œë¼ì´ì–´', ratio:1},
      {code:'AF',  label:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', ratio:1},
      {code:'QR',  label:'ì¹´íƒ€ë¥´ í”„ë¦¬ë¹Œë¦¬ì§€í´ëŸ½', ratio:1},
      {code:'CX',  label:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:0.8},
      {code:'EY',  label:'ì—í‹°í•˜ë“œ ê²ŒìŠ¤íŠ¸', ratio:1},
      {code:'QF',  label:'ì½´íƒ€ìŠ¤ í”„ë¦¬í€€íŠ¸í”Œë¼ì´ì–´', ratio:1},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:1},
      {code:'TK',  label:'í„°í‚¤í•­ê³µ ë§ˆì¼ì¦ˆì•¤ìŠ¤ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'AV',  label:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'JL',  label:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', ratio:1},
      {code:'AC',  label:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', ratio:1},
    ]},
  CapOne: {name:'ìºí”¼í„¸ì› ë§ˆì¼ì¦ˆ', color:'#004879',
    to:[
      {code:'AF',  label:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', ratio:1},
      {code:'SQ',  label:'ì‹±ê°€í¬ë¥´í•­ê³µ í¬ë¦¬ìŠ¤í”Œë¼ì´ì–´', ratio:1},
      {code:'BA',  label:'British Airways Avios', ratio:1},
      {code:'AC',  label:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', ratio:1},
      {code:'QR',  label:'ì¹´íƒ€ë¥´ í”„ë¦¬ë¹Œë¦¬ì§€í´ëŸ½', ratio:1},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:0.75},
      {code:'EY',  label:'ì—í‹°í•˜ë“œ ê²ŒìŠ¤íŠ¸', ratio:1},
      {code:'QF',  label:'ì½´íƒ€ìŠ¤ í”„ë¦¬í€€íŠ¸í”Œë¼ì´ì–´', ratio:1},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:1},
      {code:'TK',  label:'í„°í‚¤í•­ê³µ ë§ˆì¼ì¦ˆì•¤ìŠ¤ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'AV',  label:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'JL',  label:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', ratio:0.75},
      {code:'NH',  label:'ANA ë§ˆì¼ë¦¬ì§€í´ëŸ½', ratio:1},
      {code:'CX',  label:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ', ratio:1},
    ]},
  Bilt: {name:'Bilt ë¦¬ì›Œë“œ', color:'#1a1a1a',
    to:[
      {code:'UA',  label:'ìœ ë‚˜ì´í‹°ë“œ ë§ˆì¼ë¦¬ì§€í”ŒëŸ¬ìŠ¤', ratio:1},
      {code:'AC',  label:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', ratio:1},
      {code:'AF',  label:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', ratio:1},
      {code:'BA',  label:'British Airways Avios', ratio:1},
      {code:'CX',  label:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:1},
      {code:'EY',  label:'ì—í‹°í•˜ë“œ ê²ŒìŠ¤íŠ¸', ratio:1},
      {code:'JL',  label:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', ratio:1},
      {code:'QR',  label:'ì¹´íƒ€ë¥´ í”„ë¦¬ë¹Œë¦¬ì§€í´ëŸ½', ratio:1},
      {code:'TK',  label:'í„°í‚¤í•­ê³µ ë§ˆì¼ì¦ˆì•¤ìŠ¤ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:1},
      {code:'AV',  label:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ', ratio:1},
      {code:'AA',  label:'ì•„ë©”ë¦¬ì¹¸ AAdvantage', ratio:1},
      {code:'IB',  label:'ì´ë² ë¦¬ì•„ Avios', ratio:1},
    ]},
  // v2.0 ì¶”ê°€
  WF: {name:'Wells Fargo Autograph', color:'#d71e28',
    to:[
      {code:'BA',  label:'British Airways Avios', ratio:1},
      {code:'AC',  label:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', ratio:1},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:1},
      {code:'AF',  label:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', ratio:1},
      {code:'AV',  label:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ', ratio:1},
    ]},
  Marriott: {name:'ë©”ë¦¬ì–´íŠ¸ ë³¸ë³´ì´', color:'#8c1d40',
    to:[
      {code:'NH',  label:'ANA ë§ˆì¼ë¦¬ì§€í´ëŸ½', ratio:0.33},
      {code:'BA',  label:'British Airways Avios', ratio:0.33},
      {code:'AF',  label:'ì—ì–´í”„ë‘ìŠ¤-KLM í”Œë¼ì‰ë¸”ë£¨', ratio:0.33},
      {code:'DL',  label:'ë¸íƒ€ ìŠ¤ì¹´ì´ë§ˆì¼ìŠ¤', ratio:0.33},
      {code:'UA',  label:'ìœ ë‚˜ì´í‹°ë“œ ë§ˆì¼ë¦¬ì§€í”ŒëŸ¬ìŠ¤', ratio:0.33},
      {code:'AA',  label:'ì•„ë©”ë¦¬ì¹¸ AAdvantage', ratio:0.33},
      {code:'AC',  label:'ì—ì–´ìºë‚˜ë‹¤ ì—ì–´ë¡œí”Œëœ', ratio:0.33},
      {code:'AS',  label:'ì•Œë˜ìŠ¤ì¹´ ì•„íŠ¸ëª¨ìŠ¤ ë¦¬ì›Œë“œ', ratio:0.33},
      {code:'CX',  label:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ', ratio:0.33},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:0.33},
      {code:'JL',  label:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', ratio:0.33},
      {code:'KE',  label:'ëŒ€í•œí•­ê³µ ìŠ¤ì¹´ì´íŒ¨ìŠ¤', ratio:0.33},
      {code:'SQ',  label:'ì‹±ê°€í¬ë¥´í•­ê³µ í¬ë¦¬ìŠ¤í”Œë¼ì´ì–´', ratio:0.33},
      {code:'TK',  label:'í„°í‚¤í•­ê³µ ë§ˆì¼ì¦ˆì•¤ìŠ¤ë§ˆì¼ì¦ˆ', ratio:0.33},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:0.33},
    ]},
  Hilton: {name:'ííŠ¼ ì•„ë„ˆìŠ¤', color:'#104c97',
    to:[
      {code:'BA',  label:'British Airways Avios', ratio:0.4},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:0.4},
      {code:'AA',  label:'ì•„ë©”ë¦¬ì¹¸ AAdvantage', ratio:0.4},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:0.4},
      {code:'JL',  label:'JAL ë§ˆì¼ë¦¬ì§€ë±…í¬', ratio:0.4},
      {code:'AV',  label:'ì•„ë¹„ì•ˆì¹´ ë¼ì´í”„ë§ˆì¼ì¦ˆ', ratio:0.4},
    ]},
  Hyatt: {name:'ì›”ë“œì˜¤ë¸Œí•˜ì–íŠ¸', color:'#c4985a',
    to:[
      {code:'AA',  label:'ì•„ë©”ë¦¬ì¹¸ AAdvantage', ratio:0.4},
      {code:'BA',  label:'British Airways Avios', ratio:0.4},
      {code:'CX',  label:'ìºì„¸ì´ ì•„ì‹œì•„ë§ˆì¼ì¦ˆ', ratio:0.4},
      {code:'EK',  label:'ì—ë¯¸ë ˆì´íŠ¸ ìŠ¤ì¹´ì´ì›Œì¦ˆ', ratio:0.4},
      {code:'KE',  label:'ëŒ€í•œí•­ê³µ ìŠ¤ì¹´ì´íŒ¨ìŠ¤', ratio:0.4},
      {code:'VS',  label:'ë²„ì§„ ì• í‹€ëœí‹± í”Œë¼ì‰í´ëŸ½', ratio:0.4},
    ]},
};

// â”€â”€â”€ ìœ ë¥˜í• ì¦ë£Œ ì •ë³´ (ê¸ˆì•¡ ë²”ìœ„ ì¶”ê°€) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let FUEL_SURCHARGE = {
  KE:{level:'mid',range:'$50~200'}, OZ:{level:'mid',range:'$50~200'},
  AA:{level:'low',range:'$0~30'}, UA:{level:'low',range:'$0~30'},
  AS:{level:'low',range:'$0~30'}, DL:{level:'low',range:'$0~30'},
  NH:{level:'low',range:'$0~50'}, JL:{level:'mid',range:'$50~150'},
  SQ:{level:'low',range:'$0~50'}, CX:{level:'mid',range:'$50~200'},
  EK:{level:'mid',range:'$50~200'}, QR:{level:'low',range:'$0~50'},
  BA:{level:'high',range:'$200~700'}, AF:{level:'mid',range:'$50~200'},
  LH:{level:'high',range:'$200~600'}, AC:{level:'low',range:'$0~50'},
  AV:{level:'low',range:'$0~50'}, VS:{level:'high',range:'$200~500'},
  QF:{level:'high',range:'$100~400'}, TK:{level:'mid',range:'$50~150'},
  EY:{level:'mid',range:'$50~200'}, IB:{level:'low',range:'$0~50'},
};
const FUEL_LABEL = {
  low:'ìœ ë¥˜í• ì¦ ë‚®ìŒ', mid:'ìœ ë¥˜í• ì¦ ë³´í†µ', high:'ìœ ë¥˜í• ì¦ ë†’ìŒ'
};



// â”€â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getZone(code) { return AIRPORT_ZONE[code] || null; }
function getZoneKey(z1, z2) { return z1 === z2 ? z1+'-'+z1 : [z1,z2].sort().join('-'); }
function getRatioLabel(ratio) {
  if (ratio === 1) return '1:1';
  if (ratio === 0.8) return '1000â†’800';
  if (ratio === 0.75) return '1000â†’750';
  if (ratio === 0.4) return '2.5:1';
  if (ratio === 0.33 || Math.abs(ratio - 0.33) < 0.01) return '3:1';
  return `${Math.round(ratio*100)}%`;
}
function formatNumber(n) {
  if (!n && n !== 0) return '';
  return Number(n).toLocaleString('ko-KR');
}

// FIX: ë™ì  ê°€ê²©ì œ rangeì—ì„œ ìµœì†Œ/ìµœëŒ€ê°’ íŒŒì‹±
function parseDynamicRange(str) {
  if (typeof str !== 'string') return null;
  const match = str.match(/(\d+)k?~(\d+)k?/);
  if (!match) return null;
  const min = parseInt(match[1]) * (str.includes('k') ? 1000 : 1);
  const max = parseInt(match[2]) * (str.includes('k') ? 1000 : 1);
  return { min, max };
}

// â”€â”€â”€ í•­ê³µì‚¬ í™ˆí˜ì´ì§€ ë§í¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let AIRLINE_LINKS = {
  KE:'https://www.koreanair.com', OZ:'https://flyasiana.com',
  AA:'https://www.aa.com', UA:'https://www.united.com',
  AS:'https://www.alaskaair.com', DL:'https://www.delta.com',
  NH:'https://www.ana.co.jp/en/jp/', JL:'https://www.jal.co.jp/en/',
  SQ:'https://www.singaporeair.com', CX:'https://www.cathaypacific.com',
  EK:'https://www.emirates.com', QR:'https://www.qatarairways.com',
  BA:'https://www.britishairways.com', AF:'https://www.airfrance.com',
  LH:'https://www.lufthansa.com', AC:'https://www.aircanada.com',
  AV:'https://www.avianca.com', VS:'https://www.virginatlantic.com',
  QF:'https://www.qantas.com', TK:'https://www.turkishairlines.com',
  EY:'https://www.etihad.com', IB:'https://www.iberia.com',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v2.0 â€” ì–¼ë¼ì´ì–¸ìŠ¤/íŒŒíŠ¸ë„ˆ ì •ë³´
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let ALLIANCES = {
  KE:{alliance:'ìŠ¤ì¹´ì´íŒ€',bookable:['KE','OZ','AF','DL','CZ','MU','GA','VN','CI','SU','AM','AR','KQ','ME','SV','RO','OK','UX','KL'],note:'ìŠ¤ì¹´ì´íŒ€ ì†Œì†'},
  OZ:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['OZ','NH','UA','AC','LH','SQ','TK','AV','ET','BR','CA','AI','LO','MS','SK','TP','OS','LX','SN','ZH','SA','A3'],note:''},
  AA:{alliance:'ì›ì›”ë“œ',bookable:['AA','BA','QR','CX','QF','JL','AS','IB','MH','S7','FJ','AT','RJ','UL'],note:''},
  UA:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['UA','NH','AC','LH','SQ','TK','AV','OZ','ET','BR','CA','AI','LO','MS','SK','TP','OS','LX','SN','ZH','SA','A3'],note:''},
  DL:{alliance:'ìŠ¤ì¹´ì´íŒ€',bookable:['DL','AF','KL','KE','CZ','MU','GA','VN','CI','AM','AR','VS','LA'],note:'ë²„ì§„ ì• í‹€ëœí‹± íŠ¹ë³„ íŒŒíŠ¸ë„ˆ'},
  AS:{alliance:'ì›ì›”ë“œ',bookable:['AS','AA','BA','CX','QR','QF','JL','IB','FJ','EK','SQ','KE'],note:'ì›ì›”ë“œ+ê´‘ë²”ìœ„ íŒŒíŠ¸ë„ˆ'},
  AC:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['AC','UA','NH','LH','SQ','TK','AV','OZ','ET','BR','CA','AI','LO','MS','SK','TP','OS','LX','SN','ZH','SA','A3'],note:'ê±¸í”„ í•­ê³µì‚¬ë„ íŒŒíŠ¸ë„ˆ'},
  AV:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['AV','UA','AC','NH','LH','SQ','TK','OZ','ET','BR','CA','AI','LO','MS','SK','TP','OS','LX','SN'],note:'2025.2 ê°œì •'},
  NH:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['NH','UA','AC','LH','SQ','TK','AV','OZ','ET','BR','CA','AI','LO','MS','SK','TP','OS','LX','SN'],note:''},
  JL:{alliance:'ì›ì›”ë“œ',bookable:['JL','AA','BA','CX','QR','QF','IB','MH','S7','FJ','AT','RJ','UL','AS'],note:''},
  SQ:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['SQ','UA','AC','NH','LH','TK','AV','OZ','ET','BR','CA','AI'],note:''},
  CX:{alliance:'ì›ì›”ë“œ',bookable:['CX','AA','BA','QR','QF','JL','IB','MH','S7','FJ','AT','RJ','UL','AS'],note:''},
  EK:{alliance:'ë…ë¦½',bookable:['EK','QF','JL','KE'],note:'ì„ ë³„ì  íŒŒíŠ¸ë„ˆë§Œ'},
  EY:{alliance:'ë…ë¦½',bookable:['EY','AA','AZ','JL','KE','SQ','VS'],note:'íŒŒíŠ¸ë„ˆì‹­ ë„¤íŠ¸ì›Œí¬'},
  QR:{alliance:'ì›ì›”ë“œ',bookable:['QR','AA','BA','CX','QF','JL','IB','MH','S7','FJ','AT','RJ','UL','AS'],note:''},
  BA:{alliance:'ì›ì›”ë“œ',bookable:['BA','AA','QR','CX','QF','JL','IB','MH','S7','FJ','AT','RJ','UL','AS'],note:'IBì™€ Avios ê³µìœ '},
  IB:{alliance:'ì›ì›”ë“œ',bookable:['IB','BA','AA','QR','CX','QF','JL','MH','S7','FJ','AS'],note:'ìœ ëŸ½/ì¤‘ë‚¨ë¯¸ ê°•ì '},
  AF:{alliance:'ìŠ¤ì¹´ì´íŒ€',bookable:['AF','KL','DL','KE','CZ','MU','GA','VN','CI','SU','AM','AR','KQ','ME','SV','RO','OK','UX'],note:'AF-KLM ê³µë™'},
  LH:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['LH','LX','OS','SN','UA','AC','NH','SQ','TK','AV','OZ','ET','BR','CA','AI','SK','TP','LO','MS'],note:'LHê·¸ë£¹'},
  TK:{alliance:'ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤',bookable:['TK','UA','AC','NH','LH','SQ','AV','OZ','ET','BR','CA','AI','LO','MS','SK','TP','OS','LX','SN'],note:''},
  VS:{alliance:'ë…ë¦½',bookable:['VS','DL','AF','KL','NH','SQ','AV'],note:'ë¸íƒ€+ANA+í”Œë¼ì‰ë¸”ë£¨'},
  QF:{alliance:'ì›ì›”ë“œ',bookable:['QF','AA','BA','CX','QR','JL','IB','MH','S7','FJ','EK','AS'],note:'ì—ë¯¸ë ˆì´íŠ¸ íŒŒíŠ¸ë„ˆì‹­'},
};
const ALLIANCE_COLORS = {'ìŠ¤ì¹´ì´íŒ€':'#0032A0','ìŠ¤íƒ€ì–¼ë¼ì´ì–¸ìŠ¤':'#003876','ì›ì›”ë“œ':'#AB1E2D','ë…ë¦½':'#6B7280'};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v2.0 â€” ìŠ¤í†±ì˜¤ë²„/ê²½ìœ  ì •ì±…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let STOPOVERS = {
  KE:{allowed:true,max:1,fee:'$100',openJaw:true,details:'ì™•ë³µ ì‹œ 1íšŒ ìŠ¤í†±ì˜¤ë²„'},
  OZ:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'ì™•ë³µ ì‹œ 1íšŒ ë¬´ë£Œ'},
  AA:{allowed:false,max:0,fee:'N/A',openJaw:true,details:'ì˜¤í”ˆì¡°ë§Œ í—ˆìš©'},
  UA:{allowed:false,max:0,fee:'N/A',openJaw:false,details:'Excursionist Perk ë³„ë„'},
  DL:{allowed:false,max:0,fee:'N/A',openJaw:false,details:'í¸ë„ ë‹¨ìœ„ ë°œê¶Œë§Œ'},
  AS:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'1íšŒ ë¬´ë£Œ + ì˜¤í”ˆì¡°'},
  AC:{allowed:true,max:2,fee:'ë¬´ë£Œ',openJaw:true,details:'ë¯¸ë‹ˆ RTW: 2íšŒ ìŠ¤í†±ì˜¤ë²„ + ì˜¤í”ˆì¡° (ìµœê°•)'},
  AV:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'í¸ë„ 1íšŒ ë¬´ë£Œ'},
  NH:{allowed:false,max:0,fee:'N/A',openJaw:false,details:'ë¶ˆê°€'},
  JL:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'êµ­ì œì„  ì™•ë³µ 1íšŒ ë¬´ë£Œ'},
  SQ:{allowed:false,max:0,fee:'N/A',openJaw:false,details:'í¸ë„ë§Œ ê°€ëŠ¥'},
  CX:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'í™ì½© ê²½ìœ  ì¶”ì²œ'},
  EK:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'ë‘ë°”ì´ 1íšŒ ë¬´ë£Œ'},
  QR:{allowed:true,max:2,fee:'ë¬´ë£Œ',openJaw:true,details:'ë„í•˜ í¬í•¨ 2íšŒ (Qsuite ì¸ê¸°)'},
  BA:{allowed:false,max:0,fee:'N/A',openJaw:true,details:'êµ¬ê°„ë‹¹ Avios, ë©€í‹°ì‹œí‹° ê°€ëŠ¥'},
  IB:{allowed:false,max:0,fee:'N/A',openJaw:true,details:'BAì™€ ë™ì¼'},
  AF:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'íŒŒë¦¬/ì•”ìŠ¤í…Œë¥´ë‹´ ê²½ìœ '},
  LH:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'í”„ë‘í¬í‘¸ë¥´íŠ¸/ë®Œí—¨ ê²½ìœ '},
  TK:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'ì´ìŠ¤íƒ„ë¶ˆ ë¬´ë£Œ ìŠ¤í†±ì˜¤ë²„'},
  EY:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'ì•„ë¶€ë‹¤ë¹„ ë¬´ë£Œ'},
  VS:{allowed:false,max:0,fee:'N/A',openJaw:false,details:'í¸ë„ ë‹¨ìœ„, ë¶ˆê°€'},
  QF:{allowed:true,max:1,fee:'ë¬´ë£Œ',openJaw:true,details:'ì™•ë³µ ì‹œ 1íšŒ ë¬´ë£Œ'},
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v2.0 â€” ìŠ¤ìœ—ìŠ¤íŒŸ ì¶”ì²œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let SWEET_SPOTS = [
  {program:'BA',route:'ì„œìš¸â†’ë„ì¿„',cabin:'E',miles:15000,cpp:2.5,airlines:'JAL,CX',note:'Avios ë‹¨ê±°ë¦¬ ìµœê°•'},
  {program:'QF',route:'ì„œìš¸â†’ë„ì¿„',cabin:'E',miles:9000,cpp:3.5,airlines:'JAL',note:'ì½´íƒ€ìŠ¤ ë‹¨ê±°ë¦¬ ìµœì €'},
  {program:'AS',route:'ì„œìš¸â†’ë„ì¿„',cabin:'B',miles:45000,cpp:5.0,airlines:'JAL,CX',note:'ì•Œë˜ìŠ¤ì¹´â†’JAL ë¹„ì¦ˆ'},
  {program:'CX',route:'ì„œìš¸â†’ë™ë‚¨ì•„',cabin:'B',miles:40000,cpp:5.5,airlines:'CX',note:'ì•„ì‹œì•„ë§ˆì¼ì¦ˆ ë¹„ì¦ˆ ê¿€'},
  {program:'AC',route:'ì„œìš¸â†’ë™ë‚¨ì•„',cabin:'B',miles:35000,cpp:6.0,airlines:'SQ,TK,OZ',note:'ì—ì–´ë¡œí”Œëœ íŒŒíŠ¸ë„ˆ ê³ ì •'},
  {program:'AC',route:'ì„œìš¸â†’ìœ ëŸ½',cabin:'B',miles:55000,cpp:8.5,airlines:'LH,SQ,TK,OZ,NH',note:'ì—ì–´ë¡œí”Œëœ ìœ ëŸ½ ë¹„ì¦ˆ 55k ìµœê°•'},
  {program:'TK',route:'ì„œìš¸â†’ìœ ëŸ½',cabin:'B',miles:75000,cpp:5.5,airlines:'TK',note:'TK ë¹„ì¦ˆ + ì´ìŠ¤íƒ„ë¶ˆ ìŠ¤í†±ì˜¤ë²„'},
  {program:'QR',route:'ì„œìš¸â†’ìœ ëŸ½',cabin:'B',miles:95000,cpp:7.0,airlines:'QR',note:'Qsuite + ë„í•˜ ìŠ¤í†±ì˜¤ë²„'},
  {program:'AC',route:'ì„œìš¸â†’ë¶ë¯¸',cabin:'B',miles:55000,cpp:9.0,airlines:'NH,OZ,UA,AC',note:'ì—ì–´ë¡œí”Œëœ A-G 55k ìµœê°•'},
  {program:'VS',route:'ì„œìš¸â†’ë¯¸êµ­(ANA)',cabin:'B',miles:55000,cpp:8.0,airlines:'NH',note:'ë²„ì§„â†’ANA ë¹„ì¦ˆ ìŠ¤íƒ€ê±°ë“œ'},
  {program:'AS',route:'ì„œìš¸â†’ë¯¸êµ­',cabin:'B',miles:60000,cpp:7.5,airlines:'CX,JL,AA',note:'ì•Œë˜ìŠ¤ì¹´ ì›ì›”ë“œ ë¹„ì¦ˆ 60k'},
  {program:'EK',route:'ì„œìš¸â†’ë‘ë°”ì´',cabin:'F',miles:75000,cpp:15.0,airlines:'EK',note:'ì—ë¯¸ë ˆì´íŠ¸ í¼ìŠ¤íŠ¸ 75k ê·¹ê°•'},
  {program:'QR',route:'ì„œìš¸â†’ë„í•˜',cabin:'B',miles:50000,cpp:9.0,airlines:'QR',note:'Qsuite 50k'},
  {program:'IB',route:'ìœ ëŸ½â†’ì¤‘ë‚¨ë¯¸',cabin:'B',miles:34000,cpp:10.0,airlines:'IB',note:'ì´ë² ë¦¬ì•„ ìœ ëŸ½-ë‚¨ë¯¸ 34k ê·¹ê°•'},
  {program:'AC',route:'ì„œìš¸â†’í•˜ì™€ì´',cabin:'E',miles:15000,cpp:4.5,airlines:'NH,OZ',note:'ì—ì–´ë¡œí”Œëœ í•˜ì™€ì´ 15k!'},
  {program:'BA',route:'ë¯¸êµ­ ë‚´ ë‹¨ê±°ë¦¬',cabin:'E',miles:9000,cpp:2.5,airlines:'AA',note:'Avios ë¯¸êµ­ë‚´ 9k'},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v2.0 â€” ì˜ˆì•½ìˆ˜ìˆ˜ë£Œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let BOOKING_FEES = {
  KE:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'$30/3,000ë§ˆì¼',change:'$30/3,000ë§ˆì¼'},
  OZ:{online:'ë¬´ë£Œ',phone:'â‚©15,000',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'â‚©30,000',change:'â‚©30,000'},
  AA:{online:'ë¬´ë£Œ',phone:'$25~40',closeIn:'$75',closeInDays:21,cancel:'ë¬´ë£Œ(ì›¹)',change:'ë¬´ë£Œ(ì›¹)'},
  UA:{online:'ë¬´ë£Œ',phone:'$25',closeIn:'$75',closeInDays:21,cancel:'ë¬´ë£Œ(ì›¹)',change:'ë¬´ë£Œ(ì›¹)'},
  DL:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'ë¬´ë£Œ',change:'ë¬´ë£Œ'},
  AS:{online:'ë¬´ë£Œ',phone:'$15',closeIn:'$50',closeInDays:21,cancel:'$125',change:'$125'},
  AC:{online:'ë¬´ë£Œ',phone:'$30 CAD',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'ìœ ì—°',change:'ë¬´ë£Œ'},
  AV:{online:'ë¬´ë£Œ',phone:'$30',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'$50',change:'$50'},
  NH:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'3,000ë§ˆì¼',change:'3,000ë§ˆì¼'},
  JL:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'3,100ë§ˆì¼',change:'3,100ë§ˆì¼'},
  SQ:{online:'ë¬´ë£Œ',phone:'$25 SGD',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'$25 SGD',change:'$25 SGD'},
  CX:{online:'ë¬´ë£Œ',phone:'HK$200',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'ë¬´ë£Œ',change:'ë¬´ë£Œ'},
  EK:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'$50~75',change:'$50~75'},
  QR:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'$25~50',change:'$25~50'},
  BA:{online:'ë¬´ë£Œ',phone:'Â£25',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'Aviosí™˜ë¶ˆ',change:'ë¬´ë£Œ'},
  IB:{online:'ë¬´ë£Œ',phone:'â‚¬20',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'Aviosí™˜ë¶ˆ',change:'ë¬´ë£Œ'},
  AF:{online:'ë¬´ë£Œ',phone:'â‚¬25',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'í”„ë¡œëª¨ë¶ˆê°€',change:'â‚¬25'},
  LH:{online:'ë¬´ë£Œ',phone:'â‚¬25',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'â‚¬50',change:'â‚¬50'},
  TK:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'$25',change:'$25'},
  EY:{online:'ë¬´ë£Œ',phone:'ë¬´ë£Œ',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'$50',change:'$50'},
  VS:{online:'ë¬´ë£Œ',phone:'Â£20',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'ë¬´ë£Œ(24h)',change:'ë¬´ë£Œ'},
  QF:{online:'ë¬´ë£Œ',phone:'AUD $35',closeIn:'ë¬´ë£Œ',closeInDays:0,cancel:'AUD $50',change:'AUD $50'},
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ†• v2.0 â€” ë³´ë„ˆìŠ¤ì´ë²¤íŠ¸ (ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ í•„ìš”)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let BONUS_EVENTS = [
  {card:'Marriott',airline:'NH',pct:25,start:'2025-01-01',end:'2025-12-31',note:'60kâ†’25k (5kë³´ë„ˆìŠ¤ í¬í•¨, ìƒì‹œ)'},
];

const POPULAR_AIRPORTS = [
  'ICN','GMP','PUS','CJU',
  'NRT','HND','KIX','FUK','CTS','OKA',
  'HKG','TPE','PEK','PVG','SIN',
  'BKK','KUL','DPS','MNL','SGN','DAD',
  'DXB','DOH','DEL','AUH',
  'LHR','CDG','FRA','AMS','FCO','MAD','IST','BCN','ZRH','VIE',
  'JFK','LAX','SFO','ORD','ATL','SEA','DFW','MIA','BOS','YYZ','YVR',
  'HNL','GUM','SYD','MEL','AKL',
  'GRU','EZE','BOG','MEX','CUN',
  'JNB','NBO','CAI',
];

function filterAirports(term, excludeCodes) {
  const excl = excludeCodes || [];
  if (!term) {
    return POPULAR_AIRPORTS
      .map(code => AIRPORT_MAP[code])
      .filter(a => a && !excl.includes(a.code));
  }
  const t = term.toLowerCase();
  return AIRPORTS
    .filter(a => !excl.includes(a.code) && (
      a.code.toLowerCase().includes(t) ||
      a.name.toLowerCase().includes(t) ||
      a.city.toLowerCase().includes(t)
    ))
    .slice(0, 40);
}

const CABIN_KO = {E:'ì´ì½”ë…¸ë¯¸', B:'ë¹„ì¦ˆë‹ˆìŠ¤', F:'í¼ìŠ¤íŠ¸'};

// â”€â”€â”€ Toast ì»´í¬ë„ŒíŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Toast({message, type, onDone}) {
  const [hiding, setHiding] = useState(false);
  useEffect(() => {
    const t1 = setTimeout(() => setHiding(true), 2200);
    const t2 = setTimeout(onDone, 2500);
    return () => { clearTimeout(t1); clearTimeout(t2); };
  }, []);
  return (
    <div className="toast-container">
      <div className={`toast toast-${type || 'info'}${hiding ? ' hiding' : ''}`}>
        {message}
      </div>
    </div>
  );
}

// â”€â”€â”€ AirportInput ì»´í¬ë„ŒíŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AirportInput({label, placeholder, value, search, setSearch, onSelect, onClear, excludeCodes}) {
  const [show, setShow] = useState(false);
  const [hiIdx, setHiIdx] = useState(-1);
  const listRef = useRef(null);
  const results = filterAirports(value ? '' : search, excludeCodes || []);

  function pick(ap) {
    onSelect(ap);
    setShow(false);
    setHiIdx(-1);
  }

  function handleKey(e) {
    if (!show && e.key === 'ArrowDown') { setShow(true); setHiIdx(0); return; }
    if (!show) return;
    if (e.key === 'ArrowDown') { e.preventDefault(); setHiIdx(i => Math.min(i+1, results.length-1)); }
    else if (e.key === 'ArrowUp') { e.preventDefault(); setHiIdx(i => Math.max(i-1, 0)); }
    else if (e.key === 'Enter') { if (hiIdx >= 0 && results[hiIdx]) pick(results[hiIdx]); }
    else if (e.key === 'Escape') { setShow(false); setHiIdx(-1); }
  }

  useEffect(() => {
    if (listRef.current && hiIdx >= 0) {
      const offset = search ? 0 : 1;
      const el = listRef.current.children[hiIdx + offset];
      if (el) el.scrollIntoView({block:'nearest'});
    }
  }, [hiIdx]);

  const selectedAirport = value ? AIRPORT_MAP[value] : null;

  return (
    <div style={{marginBottom:20, position:'relative'}} role="combobox" aria-expanded={show} aria-haspopup="listbox">
      <label className="label">{label}</label>
      {selectedAirport ? (
        <div className="airport-selected">
          <span className="airport-code">{selectedAirport.code}</span>
          <span style={{color:'var(--c-gray-700)', flex:1}}>{selectedAirport.city}</span>
          <span style={{fontSize:'0.8rem', color:'var(--c-gray-400)'}}>{selectedAirport.name}</span>
          <span onClick={() => { onClear(); setSearch(''); }} className="airport-clear"
            aria-label="ì„ íƒ í•´ì œ">Ã—</span>
        </div>
      ) : (
        <>
          <input type="text" value={search} autoComplete="off"
            className="input"
            onChange={e => { setSearch(e.target.value); setShow(true); setHiIdx(0); }}
            onFocus={() => { setShow(true); setHiIdx(-1); }}
            onBlur={() => setTimeout(() => { setShow(false); setHiIdx(-1); }, 180)}
            onKeyDown={handleKey}
            placeholder={placeholder}
            role="searchbox"
            aria-label={label} />
          {show && results.length > 0 && (
            <div ref={listRef} className="dropdown" role="listbox" aria-label="ê³µí•­ ëª©ë¡">
              {!search && (
                <div className="dropdown-header">ğŸŒ ì¸ê¸° ê³µí•­</div>
              )}
              {results.map((ap, i) => (
                <div key={ap.code}
                  onMouseDown={() => pick(ap)}
                  onMouseEnter={() => setHiIdx(i)}
                  className={'dropdown-item' + (i === hiIdx ? ' highlighted' : '')}
                  role="option"
                  aria-selected={i === hiIdx}>
                  <span style={{fontWeight:700, color:'var(--c-primary)', fontFamily:'var(--font-mono)',
                    fontSize:'0.95rem', minWidth:38}}>{ap.code}</span>
                  <span style={{color:'var(--c-gray-700)', flex:1}}>{ap.city}</span>
                  <span style={{fontSize:'0.78rem', color:'var(--c-gray-400)'}}>{ap.name}</span>
                </div>
              ))}
            </div>
          )}
        </>
      )}
    </div>
  );
}

// â”€â”€â”€ v2.0 ì–¼ë¼ì´ì–¸ìŠ¤ ë°°ì§€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function AllianceBadge({code}) {
  const a = ALLIANCES[code];
  if (!a) return null;
  const color = ALLIANCE_COLORS[a.alliance] || '#6B7280';
  return React.createElement('span', {style:{
    display:'inline-block', padding:'2px 8px', borderRadius:12,
    fontSize:'0.66rem', fontWeight:600, color:'#fff',
    background:color, marginLeft:6, verticalAlign:'middle',
  }}, a.alliance);
}

// â”€â”€â”€ v2.0 ìŠ¤í†±ì˜¤ë²„ ë°°ì§€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function StopoverBadge({code}) {
  const s = STOPOVERS[code];
  if (!s || !s.allowed) return null;
  return React.createElement('span', {style:{
    display:'inline-flex', alignItems:'center', gap:3,
    padding:'2px 7px', borderRadius:12,
    fontSize:'0.64rem', fontWeight:600,
    background:'#E6F8ED', color:'#0B8A3E', border:'1px solid #8AD4A6',
    marginLeft:4,
  }}, 'âœˆï¸ ìŠ¤í†±ì˜¤ë²„ '+s.max+'íšŒ '+s.fee + (s.openJaw ? ' +ì˜¤í”ˆì¡°' : ''));
}

// â”€â”€â”€ v2.0 ìˆ˜ìˆ˜ë£Œ ì •ë³´ í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function FeeInfo({code}) {
  const fee = BOOKING_FEES[code];
  if (!fee) return null;
  const items = [];
  if (fee.closeInDays > 0) items.push(fee.closeInDays+'ì¼ë‚´ ë°œê¶Œ: '+fee.closeIn);
  if (fee.cancel && fee.cancel !== 'N/A' && fee.cancel !== 'ë¬´ë£Œ') items.push('ì·¨ì†Œ: '+fee.cancel);
  if (fee.phone && fee.phone !== 'ë¬´ë£Œ') items.push('ì „í™”: '+fee.phone);
  if (items.length === 0) return null;
  return React.createElement('div', {style:{
    fontSize:'0.7rem', color:'var(--c-gray-500)',
    marginTop:4, display:'flex', gap:6, flexWrap:'wrap',
  }}, items.map((item, i) => React.createElement('span', {key:i, style:{
    padding:'1px 6px', borderRadius:4,
    background:'var(--c-gray-100)', border:'1px solid var(--c-gray-200)',
  }}, item)));
}

// â”€â”€â”€ v2.0 ìŠ¤ìœ—ìŠ¤íŒŸ íŒ¨ë„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SweetSpotPanel({zoneKey}) {
  if (!zoneKey) return null;
  const spots = SWEET_SPOTS.filter(s => {
    const chart = CHARTS[s.program];
    return chart && chart.r && chart.r[zoneKey];
  });
  if (spots.length === 0) return null;
  const sorted = [...spots].sort((a, b) => (b.cpp||0) - (a.cpp||0));
  const top = sorted.slice(0, 4);

  return (
    <div className="fade-up" style={{
      background:'linear-gradient(135deg, #FFF7ED, #FFFBEB)',
      border:'1.5px solid #FCD579', borderRadius:'var(--radius-lg)',
      padding:'18px 22px', marginBottom:20,
    }}>
      <div style={{display:'flex', alignItems:'center', gap:8, marginBottom:12}}>
        <span style={{fontSize:'1.05rem'}}>ğŸ†</span>
        <span style={{fontWeight:700, fontSize:'0.88rem', color:'#92400E'}}>
          ì´ êµ¬ê°„ ìŠ¤ìœ—ìŠ¤íŒŸ TOP {top.length}
        </span>
      </div>
      {top.map((s, i) => {
        const prog = PROGRAM_MAP[s.program];
        return (
          <div key={i} style={{
            display:'flex', alignItems:'center', justifyContent:'space-between',
            padding:'10px 14px', background:'#fff', borderRadius:'var(--radius-md)',
            border:'1px solid #FDE68A', marginBottom:5,
          }}>
            <div style={{display:'flex', alignItems:'center', gap:10}}>
              <span style={{
                display:'inline-flex', alignItems:'center', justifyContent:'center',
                width:28, height:28, borderRadius:6,
                background: prog ? prog.color : '#666', color:'#fff',
                fontWeight:700, fontSize:'0.58rem', fontFamily:'var(--font-mono)',
              }}>{s.program}</span>
              <div>
                <div style={{fontSize:'0.82rem', fontWeight:600}}>{s.route}</div>
                <div style={{fontSize:'0.7rem', color:'var(--c-gray-500)'}}>
                  {s.cabin==='E'?'ì´ì½”ë…¸ë¯¸':s.cabin==='B'?'ë¹„ì¦ˆë‹ˆìŠ¤':'í¼ìŠ¤íŠ¸'}
                  {' Â· '}{s.note}
                </div>
              </div>
            </div>
            <div style={{textAlign:'right'}}>
              <div style={{fontWeight:700, fontSize:'0.86rem', fontFamily:'var(--font-mono)'}}>
                {typeof s.miles === 'number' ? formatNumber(s.miles) : s.miles}
              </div>
              <div style={{fontSize:'0.66rem', color:'var(--c-success)', fontWeight:600}}>
                ~{s.cpp}Â¢/pt
              </div>
            </div>
          </div>
        );
      })}
    </div>
  );
}

// â”€â”€â”€ ResultCard ì»´í¬ë„ŒíŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ResultCard({r, idx, result, onBook}) {
  const hasAny = r.cabins.some(c => c.canAfford === true);
  const fuelInfo = FUEL_SURCHARGE[r.targetCode];
  const fuelClass = fuelInfo ? (fuelInfo.level === 'low' ? 'fuel-low' : fuelInfo.level === 'high' ? 'fuel-high' : 'fuel-mid') : '';

  return (
    <div className={'result-card fade-up fade-up-'+(idx%5) + (hasAny ? ' affordable' : '')}>
      {/* ì¹´ë“œ í—¤ë” */}
      <div className="result-header">
        <div style={{display:'flex', alignItems:'center', gap:12}}>
          <div className="result-icon" style={{background:r.programColor}}>
            <span className="result-icon-text">
              {PROGRAM_MAP[r.programName]?.code?.slice(0,5) || r.targetCode || '?'}
            </span>
          </div>
          <div>
            <div style={{fontWeight:700, fontSize:'0.95rem', color:'var(--c-gray-800)'}}>
              {r.isCard ? r.targetName : r.programName}
              {fuelInfo && (
                <span className={'fuel-badge ' + fuelClass}
                  title={fuelInfo.range}>
                  {FUEL_LABEL[fuelInfo.level]} ({fuelInfo.range})
                </span>
              )}
            </div>
            {r.isCard && (
              <div style={{fontSize:'0.8rem', color:'var(--c-primary)', marginTop:2}}>
                â† {r.programName}ì—ì„œ ì´ì „
                <span style={{color:'var(--c-gray-400)', marginLeft:6}}>
                  ({getRatioLabel(r.transferRatio)})
                </span>
                <AllianceBadge code={r.targetCode} />
              </div>
            )}
            {!r.isCard && r.note && (
              <div style={{fontSize:'0.78rem', color:'var(--c-gray-400)', marginTop:2}}>
                {r.note}
                <AllianceBadge code={r.targetCode} />
              </div>
            )}
          </div>
        </div>
        <div style={{textAlign:'right'}}>
          <div style={{fontSize:'0.75rem', color:'var(--c-gray-400)'}}>
            {r.isCard ? 'ì „í™˜ í›„ ë§ˆì¼' : 'ë³´ìœ  ë§ˆì¼'}
          </div>
          <div style={{fontWeight:700, fontFamily:'var(--font-mono)', fontSize:'1rem',
            color: hasAny ? 'var(--c-success)' : 'var(--c-gray-700)'}}>
            {formatNumber(r.convertedPoints)}
            <span style={{fontSize:'0.78rem', fontWeight:400, marginLeft:2}}>mi</span>
          </div>
          {r.isCard && r.transferRatio !== 1 && (
            <div style={{fontSize:'0.72rem', color:'var(--c-gray-400)'}}>
              (ì›ë˜ {formatNumber(r.userPoints)} P)
            </div>
          )}
        </div>
      </div>

      {/* ìºë¹ˆë³„ í‘œ */}
      <div className={`cabin-grid cabin-grid-${r.cabins.length <= 1 ? '1' : r.cabins.length <= 2 ? '2' : ''}`}
        style={{gridTemplateColumns:`repeat(${r.cabins.length}, 1fr)`}}>
        {r.cabins.map((c, ci) => {
          // FIX: ë™ì  ê°€ê²©ì—ì„œ ê°€ëŠ¥ì„± íŒë³„
          let cellClass, txt, badgeBg, badge;
          if (c.canAfford === true) {
            cellClass = 'can-afford'; txt = 'var(--c-success)'; badgeBg = 'var(--c-success)'; badge = 'âœ“ ë°œê¶Œ ê°€ëŠ¥';
          } else if (c.canAfford === false) {
            cellClass = 'cannot-afford'; txt = 'var(--c-gray-400)'; badgeBg = 'var(--c-gray-300)'; badge = 'âœ— ë§ˆì¼ ë¶€ì¡±';
          } else if (c.dynamicPossible === true) {
            cellClass = 'maybe-possible'; txt = 'var(--c-success)'; badgeBg = '#22C55E'; badge = 'ã€œ ê°€ëŠ¥ì„± ìˆìŒ';
          } else if (c.dynamicPossible === false) {
            cellClass = 'cannot-afford'; txt = 'var(--c-gray-400)'; badgeBg = 'var(--c-gray-300)'; badge = 'âœ— ìµœì†Œ ë¯¸ë‹¬';
          } else {
            cellClass = 'maybe'; txt = 'var(--c-warning)'; badgeBg = 'var(--c-warning)'; badge = 'ã€œ ë²”ìœ„ í™•ì¸';
          }
          return (
            <div key={c.cabin} className={'cabin-cell ' + cellClass}>
              <div style={{fontSize:'0.76rem', color:'var(--c-gray-500)', fontWeight:600, marginBottom:5}}>
                {CABIN_KO[c.cabin]}
              </div>
              <div style={{fontWeight:700, fontSize:'1.05rem', color:txt,
                fontFamily:'var(--font-mono)', marginBottom:8}}>
                {c.display}
                <span style={{fontWeight:400, fontSize:'0.72rem', marginLeft:2}}>ë§ˆì¼</span>
              </div>
              <div className="badge" style={{background:badgeBg}}>{badge}</div>
              {c.canAfford === false && c.rawNeeded && (
                <div style={{marginTop:6, fontSize:'0.72rem', color:'var(--c-danger)'}}>
                  {formatNumber(c.rawNeeded - r.convertedPoints)} ë¶€ì¡±
                </div>
              )}
              {/* ë°œê¶Œ ë²„íŠ¼ */}
              {(c.canAfford === true || c.dynamicPossible === true) && onBook && (
                <div style={{marginTop:8}}>
                  <div style={{fontSize:'0.7rem', color:'var(--c-gray-400)', marginBottom:4}}>
                    ì”ì—¬: <strong style={{color:'var(--c-gray-600)'}}>
                      {formatNumber(r.convertedPoints - (c.rawNeeded || c.dynamicMin || 0))}
                    </strong> mi
                  </div>
                  <button onClick={(e) => { e.stopPropagation(); onBook(r, c); }}
                    className="btn-book">
                    ğŸ« ì´ í‘œ ë°œê¶Œ
                  </button>
                </div>
              )}
            </div>
          );
        })}
      </div>

      {r.dynamic && (
        <div style={{marginTop:10, fontSize:'0.78rem', color:'var(--c-warning)', fontWeight:500}}>
          âš ï¸ ë™ì  ê°€ê²©ì œ â€” ì‹¤ì œ ë§ˆì¼ì€ ì‹œê¸°Â·ìˆ˜ìš”ì— ë”°ë¼ ë³€ë™ë©ë‹ˆë‹¤
        </div>
      )}

      {/* í•­ê³µì‚¬ í™ˆí˜ì´ì§€ */}
      {r.targetCode && AIRLINE_LINKS[r.targetCode] && (
        <div style={{marginTop:14, paddingTop:12, borderTop:'1px solid var(--c-gray-100)'}}>
          <a href={AIRLINE_LINKS[r.targetCode]} target="_blank" rel="noopener noreferrer"
            className="btn btn-outline btn-sm" style={{gap:4}}>
            ğŸ”— {r.isCard ? r.targetName : r.programName} í™ˆí˜ì´ì§€ â†—
          </a>
        </div>
      )}

      {/* v2.0: ìŠ¤í†±ì˜¤ë²„ + ìˆ˜ìˆ˜ë£Œ */}
      {r.targetCode && (STOPOVERS[r.targetCode]?.allowed || BOOKING_FEES[r.targetCode]) && (
        <div style={{marginTop:8, display:'flex', flexWrap:'wrap', gap:4, alignItems:'center'}}>
          <StopoverBadge code={r.targetCode} />
          <FeeInfo code={r.targetCode} />
        </div>
      )}


    </div>
  );
}

// â”€â”€â”€ PointsTimeline ì‹œê°í™” ì»´í¬ë„ŒíŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PointsTimeline({openDate, expDate}) {
  if (!openDate && !expDate) return null;

  const today = new Date();
  today.setHours(0,0,0,0);
  const open = openDate ? new Date(openDate + 'T00:00:00') : null;
  const exp = expDate ? new Date(expDate + 'T00:00:00') : null;

  // ë‚ ì§œ ì°¨ì´ (ì¼)
  function diffDays(a, b) { return Math.round((b - a) / (1000*60*60*24)); }
  function fmtDate(d) { return d.toLocaleDateString('ko-KR', {year:'numeric', month:'short', day:'numeric'}); }

  // ë§ˆê°ì¼ë§Œ ìˆëŠ” ê²½ìš°
  const daysLeft = exp ? diffDays(today, exp) : null;
  const totalDays = (open && exp) ? diffDays(open, exp) : null;
  const elapsed = (open && exp) ? diffDays(open, today) : null;
  const pct = (totalDays && totalDays > 0) ? Math.max(0, Math.min(100, (elapsed / totalDays) * 100)) : null;

  // ìƒíƒœ ê²°ì •
  let urgency, urgLabel, urgColor, urgBg, urgBorder, urgIcon;
  if (daysLeft !== null) {
    if (daysLeft < 0) {
      urgency = 'expired'; urgLabel = 'ë§Œë£Œë¨'; urgColor = '#991B1B'; urgBg = '#FEF2F2'; urgBorder = '#FECACA'; urgIcon = 'ğŸ’€';
    } else if (daysLeft <= 7) {
      urgency = 'critical'; urgLabel = 'D-'+daysLeft; urgColor = '#DC2626'; urgBg = '#FEF2F2'; urgBorder = '#FCA5A5'; urgIcon = 'ğŸ”¥';
    } else if (daysLeft <= 30) {
      urgency = 'warning'; urgLabel = 'D-'+daysLeft; urgColor = '#D97706'; urgBg = '#FFFBEB'; urgBorder = '#FCD34D'; urgIcon = 'âš ï¸';
    } else if (daysLeft <= 90) {
      urgency = 'caution'; urgLabel = 'D-'+daysLeft; urgColor = '#2563EB'; urgBg = '#EFF6FF'; urgBorder = '#93C5FD'; urgIcon = 'ğŸ“…';
    } else {
      urgency = 'safe'; urgLabel = 'D-'+daysLeft; urgColor = '#059669'; urgBg = '#ECFDF5'; urgBorder = '#6EE7B7'; urgIcon = 'âœ…';
    }
  }

  // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ìƒ‰ìƒ
  function getBarGradient() {
    if (pct === null) return 'var(--c-gray-200)';
    if (pct >= 90) return 'linear-gradient(90deg, #059669 0%, #DC2626 100%)';
    if (pct >= 70) return 'linear-gradient(90deg, #059669 0%, #D97706 100%)';
    return 'linear-gradient(90deg, #059669 0%, #2563EB 100%)';
  }

  // ë‚¨ì€ ê¸°ê°„ í…ìŠ¤íŠ¸
  function remainText() {
    if (daysLeft === null) return '';
    if (daysLeft < 0) return `${Math.abs(daysLeft)}ì¼ ì „ì— ë§Œë£Œë¨`;
    if (daysLeft === 0) return 'ì˜¤ëŠ˜ ë§Œë£Œ!';
    const months = Math.floor(daysLeft / 30);
    const days = daysLeft % 30;
    if (months > 0 && days > 0) return `${months}ê°œì›” ${days}ì¼ ë‚¨ìŒ`;
    if (months > 0) return `${months}ê°œì›” ë‚¨ìŒ`;
    return `${daysLeft}ì¼ ë‚¨ìŒ`;
  }

  return (
    <div style={{marginTop:10}}>
      {/* D-day ë°°ì§€ + í…ìŠ¤íŠ¸ */}
      {daysLeft !== null && (
        <div style={{display:'flex', alignItems:'center', gap:8, marginBottom:8}}>
          <span style={{display:'inline-flex', alignItems:'center', gap:4,
            padding:'3px 10px', borderRadius:20, fontSize:'0.74rem', fontWeight:700,
            background:urgBg, color:urgColor, border:'1px solid '+urgBorder,
            fontFamily:'var(--font-mono)', letterSpacing:'-0.02em'}}>
            {urgIcon} {urgLabel}
          </span>
          <span style={{fontSize:'0.78rem', color:'var(--c-gray-500)', fontWeight:500}}>
            {remainText()}
          </span>
        </div>
      )}

      {/* íƒ€ì„ë¼ì¸ ë°” */}
      {open && exp && totalDays > 0 && (
        <div style={{position:'relative', paddingTop:2}}>
          {/* ë°°ê²½ íŠ¸ë™ */}
          <div style={{height:8, borderRadius:4, background:'var(--c-gray-100)', position:'relative', overflow:'hidden'}}>
            {/* ì§„í–‰ ë°” */}
            <div style={{
              position:'absolute', top:0, left:0, height:'100%', borderRadius:4,
              width: Math.min(pct, 100) + '%',
              background: getBarGradient(),
              transition: 'width 0.6s ease-out',
            }} />
            {/* ì˜¤ëŠ˜ ë§ˆì»¤ */}
            {pct >= 0 && pct <= 100 && (
              <div style={{
                position:'absolute', top:-3, left: `calc(${Math.min(pct,100)}% - 7px)`,
                width:14, height:14, borderRadius:'50%', background:'#fff',
                border:'2.5px solid '+urgColor, zIndex:2,
                boxShadow:'0 1px 4px rgba(0,0,0,0.15)',
                transition:'left 0.6s ease-out',
              }} />
            )}
          </div>
          {/* ë¼ë²¨ */}
          <div style={{display:'flex', justifyContent:'space-between', marginTop:6}}>
            <span style={{fontSize:'0.68rem', color:'var(--c-gray-400)', fontFamily:'var(--font-mono)'}}>
              ğŸ“… {fmtDate(open)}
            </span>
            <span style={{fontSize:'0.68rem', color:urgency === 'expired' ? '#DC2626' : 'var(--c-gray-400)',
              fontFamily:'var(--font-mono)', fontWeight:urgency === 'critical' || urgency === 'expired' ? 700 : 400}}>
              ğŸ {fmtDate(exp)}
            </span>
          </div>
        </div>
      )}

      {/* ë§ˆê°ì¼ë§Œ ìˆëŠ” ê²½ìš° (ê°œì„¤ì¼ ì—†ìŒ) */}
      {!open && exp && (
        <div style={{display:'flex', alignItems:'center', gap:6, fontSize:'0.74rem', color:'var(--c-gray-400)'}}>
          <span>ğŸ ë§ˆê°: <strong style={{fontFamily:'var(--font-mono)', color:'var(--c-gray-600)'}}>{fmtDate(exp)}</strong></span>
        </div>
      )}

      {/* ê°œì„¤ì¼ë§Œ ìˆëŠ” ê²½ìš° (ë§ˆê°ì¼ ì—†ìŒ) */}
      {open && !exp && (
        <div style={{display:'flex', alignItems:'center', gap:6, fontSize:'0.74rem', color:'var(--c-gray-400)'}}>
          <span>ğŸ“… ê°œì„¤: <strong style={{fontFamily:'var(--font-mono)', color:'var(--c-gray-600)'}}>{fmtDate(open)}</strong></span>
          <span>Â· ë³´ìœ  {diffDays(open, today)}ì¼ì§¸</span>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ ë©”ì¸ ì•± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App() {
  const [step, setStep] = useState(1);
  const [dep, setDep] = useState('');
  const [arr, setArr] = useState('');
  const [depSearch, setDepSearch] = useState('');
  const [arrSearch, setArrSearch] = useState('');
  const [tripType, setTripType] = useState('oneway');
  const [layovers, setLayovers] = useState([]);
  const [layoverSearch, setLayoverSearch] = useState('');
  const [showLayover, setShowLayover] = useState(false);
  const [passengers, setPassengers] = useState(1);
  const [pointsList, setPointsList] = useState([]);
  const [selProgram, setSelProgram] = useState('');
  const [selPoints, setSelPoints] = useState('');
  const [selOpenDate, setSelOpenDate] = useState('');
  const [selExpDate, setSelExpDate] = useState('');
  const [result, setResult] = useState(null);
  const [loading, setLoading] = useState(false);
  const [sortMode, setSortMode] = useState('class');
  const [toast, setToast] = useState(null);
  const [bookedTickets, setBookedTickets] = useState([]);

  const step1Valid = dep && arr;
  const maxStep = step === 'booked' ? 3 : result ? 3 : pointsList.length > 0 ? 2 : step1Valid ? 2 : 1;

  // FIX: Zone ë¯¸ì§€ì› ê³µí•­ ê²½ê³ 
  const depZone = dep ? getZone(dep) : null;
  const arrZone = arr ? getZone(arr) : null;
  const hasZoneWarning = step1Valid && (!depZone || !arrZone);

  // ê²½ìœ ì§€ ê´€ë ¨ â€” ë§ˆì¼ ê³„ì‚°ì— ì‹¤ì œ ì˜í–¥ ì„¤ëª…
  const zoneKey = depZone && arrZone ? getZoneKey(depZone, arrZone) : null;

  function showToast(message, type) {
    setToast({message, type, id: Date.now()});
  }

  function goToStep(n) {
    if (n === 1) { setResult(null); setStep(1); }
    else if (n === 2 && step1Valid) { setResult(null); setStep(2); }
    else if (n === 3 && (result || step === 'booked')) setStep(result ? 3 : 'booked');
  }

  function addPoints() {
    const pts = parseInt(selPoints.replace(/,/g, ''));
    if (!selProgram || !pts || pts <= 0) return;
    const existing = pointsList.find(p => p.program === selProgram);
    if (existing) {
      setPointsList(pointsList.map(p => p.program === selProgram ? {...p, points:pts, openDate:selOpenDate||p.openDate, expDate:selExpDate||p.expDate} : p));
      showToast(`${selProgram} í¬ì¸íŠ¸ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤`, 'warn');
    } else {
      setPointsList([...pointsList, {program:selProgram, points:pts, openDate:selOpenDate, expDate:selExpDate}]);
      showToast(`${selProgram} ì¶”ê°€ ì™„ë£Œ`, 'success');
    }
    setSelProgram(''); setSelPoints(''); setSelOpenDate(''); setSelExpDate('');
  }

  function analyze() {
    setLoading(true);
    setTimeout(() => {
      analyzeInternal();
    }, 600);
  }

  function analyzeInternal() {
    const depZ = getZone(dep);
    const arrZ = getZone(arr);
    const zKey = depZ && arrZ ? getZoneKey(depZ, arrZ) : null;
    const multiplier = tripType === 'roundtrip' ? 2 : 1;

    const rows = [];

    function calcCabins(chartEntry, availablePoints) {
      if (!chartEntry || !chartEntry.r || !zKey) return [];
      const route = chartEntry.r[zKey];
      if (!route) return [];
      return ['F','B','E'].map(c => {
        const v = route[c];
        if (!v) return null;
        const isDyn = typeof v === 'string';
          if (isDyn) {
            // FIX: ë™ì  ê°€ê²© ë²”ìœ„ íŒŒì‹± & ê°€ëŠ¥ì„± íŒë³„
            const range = parseDynamicRange(v);
            const minNeeded = range ? Math.round(range.min * passengers * multiplier) : null;
            const maxNeeded = range ? Math.round(range.max * passengers * multiplier) : null;
            return {
              cabin: c,
              display: v,
              rawNeeded: null,
              canAfford: null,
              dynamic: true,
              dynamicPossible: range ? (availablePoints >= minNeeded ? true : false) : null,
              dynamicMin: minNeeded,
              dynamicMax: maxNeeded,
            };
          }
          const needed = Math.round(v * passengers * multiplier);
          return {
            cabin: c,
            display: needed.toLocaleString(),
            rawNeeded: needed,
            canAfford: availablePoints >= needed,
            dynamic: false,
          };
        }).filter(Boolean);
      }

      for (const item of pointsList) {
        const prog = PROGRAM_MAP[item.program];
        if (!prog) continue;
        const code = prog.code;

        if (CARD_TRANSFERS[code]) {
          const card = CARD_TRANSFERS[code];
          for (const tr of card.to) {
            const chart = CHARTS[tr.code];
            if (!chart) continue;
            const convertedPoints = Math.floor(item.points * tr.ratio);
            const cabins = calcCabins(chart, convertedPoints);
            if (cabins.length === 0) continue;
            rows.push({
              id: code+'-'+tr.code,
              programName: card.name,
              programColor: prog.color,
              isCard: true,
              transferLabel: tr.label,
              transferRatio: tr.ratio,
              targetCode: tr.code,
              targetName: chart.name,
              targetNote: chart.note,
              userPoints: item.points,
              convertedPoints,
              cabins,
              dynamic: !!chart.dynamic,
              fuel: FUEL_SURCHARGE[tr.code],
            });
          }
        } else if (CHARTS[code]) {
          const chart = CHARTS[code];
          const cabins = calcCabins(chart, item.points);
          if (cabins.length === 0) continue;
          rows.push({
            id: code,
            programName: chart.name,
            programColor: prog.color,
            isCard: false,
            note: chart.note,
            targetCode: code,
            userPoints: item.points,
            convertedPoints: item.points,
            cabins,
            dynamic: !!chart.dynamic,
            fuel: FUEL_SURCHARGE[code],
          });
        }
      }

      setResult({rows, depZ, arrZ, multiplier, zKey,
        bookingParams: {dep, arr, tripType, passengers}});
      setLoading(false);
      setStep(3);
  }

  // ê²°ê³¼ ì •ë ¬
  const sortedRows = useMemo(() => {
    if (!result) return [];
    const rows = [...result.rows];
    if (sortMode === 'class') {
      rows.sort((a,b) => {
        const s = r => r.cabins.some(c=>c.cabin==='F'&&c.canAfford) ? 0
          : r.cabins.some(c=>c.cabin==='B'&&c.canAfford) ? 1
          : r.cabins.some(c=>c.cabin==='E'&&c.canAfford) ? 2 : 3;
        return s(a)-s(b);
      });
    } else if (sortMode === 'miles_asc') {
      rows.sort((a,b) => {
        const getMinE = r => {
          const ec = r.cabins.find(c => c.cabin === 'E');
          return ec && ec.rawNeeded ? ec.rawNeeded : ec && ec.dynamicMin ? ec.dynamicMin : 999999;
        };
        return getMinE(a) - getMinE(b);
      });
    } else if (sortMode === 'fuel') {
      const fuelRank = {low:0, mid:1, high:2};
      rows.sort((a,b) => {
        const fa = a.fuel ? fuelRank[a.fuel.level] ?? 1 : 1;
        const fb = b.fuel ? fuelRank[b.fuel.level] ?? 1 : 1;
        return fa - fb;
      });
    }
    return rows;
  }, [result, sortMode]);

  function reset() {
    setStep(1); setDep(''); setArr(''); setDepSearch(''); setArrSearch('');
    setTripType('oneway');
    setLayovers([]); setLayoverSearch('');
    setPassengers(1); setPointsList([]); setSelProgram(''); setSelPoints('');
    setSelOpenDate(''); setSelExpDate('');
    setResult(null); setSortMode('class');
    setBookedTickets([]);
  }

  // ë°œê¶Œ ì²˜ë¦¬
  function handleBook(row, cabinObj) {
    const milesUsed = cabinObj.rawNeeded || cabinObj.dynamicMin;
    if (!milesUsed) return;

    // ì›ë˜ í¬ì¸íŠ¸ ì°¨ê°ëŸ‰ ê³„ì‚°
    let programKey, pointsToDeduct;
    if (row.isCard) {
      programKey = row.programName; // ì¹´ë“œ í”„ë¡œê·¸ë¨ ì´ë¦„
      pointsToDeduct = Math.ceil(milesUsed / row.transferRatio);
    } else {
      programKey = row.programName;
      pointsToDeduct = milesUsed;
    }

    // pointsListì—ì„œ í•´ë‹¹ í”„ë¡œê·¸ë¨ ì°¨ê°
    const updated = pointsList.map(p => {
      if (p.program === programKey) {
        return {...p, points: Math.max(0, p.points - pointsToDeduct)};
      }
      return p;
    });
    setPointsList(updated);

    // ë°œê¶Œ ê¸°ë¡ ì¶”ê°€
    const ticket = {
      id: Date.now(),
      route: dep + (tripType==='layover' && layovers.length ? ' â†’ '+layovers.join(' â†’ ') : '') + ' â†’ ' + arr + (tripType==='roundtrip' ? ' â†’ '+dep : ''),
      tripType,
      passengers,
      programName: row.isCard ? row.programName : row.programName,
      airlineName: row.isCard ? row.targetName : row.programName,
      targetCode: row.targetCode,
      cabin: cabinObj.cabin,
      milesUsed,
      pointsDeducted: pointsToDeduct,
      isCard: row.isCard,
      transferRatio: row.transferRatio,
    };
    setBookedTickets(prev => [...prev, ticket]);
    showToast(`${CABIN_KO[cabinObj.cabin]} ${formatNumber(milesUsed)}ë§ˆì¼ ë°œê¶Œ ì™„ë£Œ!`, 'success');

    // ê²°ê³¼ ë¬´íš¨í™” (ì”ì—¬ í¬ì¸íŠ¸ë¡œ ì¬ê²€ìƒ‰ ìœ ë„)
    setResult(null);
    setStep('booked');
  }

  // ì”ì—¬ í¬ì¸íŠ¸ë¡œ ë‹¤ì‹œ ê²€ìƒ‰
  function searchAgain() {
    setResult(null);
    setStep(1);
  }

  // ì”ì—¬ í¬ì¸íŠ¸ë¡œ ë°”ë¡œ ì¬ë¶„ì„
  function reAnalyze() {
    if (dep && arr && pointsList.some(p => p.points > 0)) {
      setResult(null);
      setLoading(true);
      setStep(3);
      // setTimeout to let state settle before analyze runs
      setTimeout(() => {
        analyzeInternal();
      }, 100);
    } else {
      setStep(1);
    }
  }

  // ë°œê¶Œ ì·¨ì†Œ
  function cancelTicket(ticketId) {
    const ticket = bookedTickets.find(t => t.id === ticketId);
    if (!ticket) return;
    // í¬ì¸íŠ¸ ë³µì›
    const updated = pointsList.map(p => {
      if (p.program === ticket.programName) {
        return {...p, points: p.points + ticket.pointsDeducted};
      }
      return p;
    });
    setPointsList(updated);
    setBookedTickets(prev => prev.filter(t => t.id !== ticketId));
    showToast('ë°œê¶Œì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤', 'warn');
    if (result) { setResult(null); }
  }

  function handlePointsInput(val) {
    const raw = val.replace(/[^0-9]/g, '');
    if (raw === '') { setSelPoints(''); return; }
    setSelPoints(Number(raw).toLocaleString('ko-KR'));
  }

  return (
    <div className="container">
      {/* Toast */}
      {toast && <Toast key={toast.id} message={toast.message} type={toast.type}
        onDone={() => setToast(null)} />}

      {/* â”€â”€ í—¤ë” â”€â”€ */}
      <div style={{textAlign:'center', marginBottom:40, paddingBottom:24, borderBottom:'2px solid var(--c-gray-100)'}}>
        <div style={{fontSize:'0.78rem', fontWeight:600, color:'var(--c-accent)', letterSpacing:'0.1em',
          textTransform:'uppercase', marginBottom:8}}>ì—¬ê³µë²• Â· Award Travel Planner v2.0</div>
        <h1 className="header-title" style={{fontSize:'2rem', fontWeight:900, color:'var(--c-gray-900)',
          letterSpacing:'-0.03em', marginBottom:10, lineHeight:1.3}}>
          ë§ˆì¼/í¬ì¸íŠ¸ ë°œê¶Œ í”Œë˜ë„ˆ
        </h1>
        <p style={{fontSize:'0.92rem', color:'var(--c-gray-500)', marginBottom:16, lineHeight:1.6}}>
          ë³´ìœ  ë§ˆì¼ë¦¬ì§€ì™€ ì¹´ë“œ í¬ì¸íŠ¸ë¡œ ì–´ë–¤ í´ë˜ìŠ¤ì— ë°œê¶Œí•  ìˆ˜ ìˆëŠ”ì§€ ë¶„ì„í•©ë‹ˆë‹¤
        </p>
        <div className="notice notice-warn" style={{display:'inline-block', maxWidth:600, textAlign:'left'}}>
          âš ï¸ <strong>ì‹¤ì‹œê°„ ì¢Œì„ ì¡°íšŒê°€ ì•„ë‹™ë‹ˆë‹¤.</strong> í¬ì¸íŠ¸ ì´ì „ ê²½ë¡œì™€ í•­ê³µì‚¬ ë§ˆì¼ ì°¨íŠ¸ ê¸°ë°˜ìœ¼ë¡œ ë°œê¶Œ ì•„ì´ë””ì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ì‹¤ì œ ê°€ìš© ì¢Œì„Â·ìœ ë¥˜í• ì¦ë£ŒÂ·ì„¸ê¸ˆì€ ê° í•­ê³µì‚¬ì—ì„œ í™•ì¸í•˜ì„¸ìš”.
        </div>
      </div>

      {/* â”€â”€ ìŠ¤í… ì¸ë””ì¼€ì´í„° â”€â”€ */}
      <nav className="stepper" aria-label="ì§„í–‰ ë‹¨ê³„">
        {[{n:1,label:'í•­ê³µí¸ ì„ íƒ'},{n:2,label:'í¬ì¸íŠ¸ ì…ë ¥'},{n:3,label:'ë°œê¶Œ ë¶„ì„'}].map((s, idx) => {
          const stepNum = step === 'booked' ? 4 : step;
          const isDone = stepNum > s.n;
          const isActive = stepNum === s.n || (step === 'booked' && s.n === 3);
          const canGo = s.n <= maxStep;
          return (
            <React.Fragment key={s.n}>
              {idx > 0 && <div className={'step-connector' + (step > s.n ? ' done' : '')} />}
              <div className={'step-item' + (!canGo ? ' disabled' : '')}
                onClick={() => canGo && goToStep(s.n)}
                role="button" tabIndex={canGo ? 0 : -1}
                aria-current={isActive ? 'step' : undefined}>
                <div className={'step-num ' + (isDone ? 'done' : isActive ? 'active' : 'pending')}>
                  {isDone ? 'âœ“' : s.n}
                </div>
                <span className="step-label">{s.label}</span>
              </div>
            </React.Fragment>
          );
        })}
      </nav>

      {/* â•â•â•â•â•â•â•â• STEP 1: í•­ê³µí¸ ì„ íƒ â•â•â•â•â•â•â•â• */}
      {step === 1 && (
        <div className="card fade-up">
          <div className="card-inner">
            <h2 style={{fontSize:'1.2rem', fontWeight:700, marginBottom:24, color:'var(--c-gray-800)'}}>í•­ê³µí¸ ì •ë³´</h2>

            {/* ì—¬ì • íƒ€ì… */}
            <div style={{marginBottom:24}}>
              <div style={{display:'flex', gap:8}}>
                {[
                  {v:'oneway', l:'âœˆ í¸ë„'},
                  {v:'roundtrip', l:'ğŸ”„ ì™•ë³µ'},
                  {v:'layover', l:'ğŸ›‘ ê²½ìœ /Stopover'},
                ].map(opt => (
                  <button key={opt.v}
                    onClick={() => { setTripType(opt.v); setLayovers([]); }}
                    className={'trip-btn' + (tripType === opt.v ? ' active' : '')}>
                    {opt.l}
                  </button>
                ))}
              </div>
              {tripType === 'roundtrip' && (
                <div className="notice notice-info" style={{marginTop:10}}>
                  ğŸ”„ ì™•ë³µ ì„ íƒ ì‹œ í•„ìš” ë§ˆì¼ì´ <strong>Ã—2</strong>ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
                </div>
              )}
              {tripType === 'layover' && (
                <div className="notice notice-info" style={{marginTop:10}}>
                  ğŸ’¡ <strong>Stopover ì•ˆë‚´</strong>: ëŒ€ë¶€ë¶„ì˜ í”„ë¡œê·¸ë¨ì€ ì¶œë°œì§€â†’ìµœì¢… ëª©ì ì§€ ê¸°ì¤€ìœ¼ë¡œ ë§ˆì¼ì„ ì²­êµ¬í•©ë‹ˆë‹¤. ê²½ìœ ì§€ëŠ” ê²°ê³¼ì— ì°¸ê³  ì •ë³´ë¡œ í‘œì‹œë˜ë©°, <strong>ë§ˆì¼ ê³„ì‚°ì€ ì¶œë°œ-ë„ì°© ì¡´(Zone) ê¸°ì¤€</strong>ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
                </div>
              )}
            </div>

            {/* ì¶œë°œ ê³µí•­ */}
            <AirportInput label="ì¶œë°œ ê³µí•­" placeholder="ê³µí•­ëª… ë˜ëŠ” ì½”ë“œ ì…ë ¥ (ì˜ˆ: ICN, ì¸ì²œ, Tokyo)"
              value={dep} search={depSearch} setSearch={setDepSearch}
              onSelect={ap => setDep(ap.code)} onClear={() => setDep('')}
              excludeCodes={arr ? [arr] : []} />

            {/* ë„ì°© ê³µí•­ */}
            <AirportInput label="ë„ì°© ê³µí•­" placeholder="ê³µí•­ëª… ë˜ëŠ” ì½”ë“œ ì…ë ¥ (ì˜ˆ: NRT, ë‰´ìš•, JFK)"
              value={arr} search={arrSearch} setSearch={setArrSearch}
              onSelect={ap => setArr(ap.code)} onClear={() => setArr('')}
              excludeCodes={dep ? [dep] : []} />

            {/* FIX: Zone ë¯¸ì§€ì› ê³µí•­ ê²½ê³  */}
            {hasZoneWarning && (
              <div className="zone-warn">
                âš ï¸ {!depZone && <span><strong>{dep}</strong> ê³µí•­ì€ í˜„ì¬ Zone ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. </span>}
                {!arrZone && <span><strong>{arr}</strong> ê³µí•­ì€ í˜„ì¬ Zone ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. </span>}
                ë¶„ì„ ê²°ê³¼ê°€ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </div>
            )}

            {/* Zone ì •ë³´ ë¯¸ë¦¬ë³´ê¸° */}
            {step1Valid && depZone && arrZone && (
              <div style={{fontSize:'0.82rem', color:'var(--c-gray-400)', marginBottom:16, marginTop:-8,
                padding:'8px 12px', background:'var(--c-gray-50)', borderRadius:'var(--radius-sm)'}}>
                êµ¬ê°„: <strong style={{color:'var(--c-primary)'}}>{ZONE_NAMES[depZone]}</strong>
                {' â†’ '}
                <strong style={{color:'var(--c-primary)'}}>{ZONE_NAMES[arrZone]}</strong>
                <span style={{marginLeft:8, color:'var(--c-gray-300)'}}>({getZoneKey(depZone, arrZone)})</span>
              </div>
            )}

            {/* ê²½ìœ ì§€ */}
            {tripType === 'layover' && (
              <div style={{marginBottom:20}}>
                <label className="label">
                  ê²½ìœ  ê³µí•­
                  <span className="label-optional">({layovers.length}/3)</span>
                </label>
                {layovers.length > 0 && (
                  <div style={{display:'flex', flexWrap:'wrap', gap:6, marginBottom:10}}>
                    {layovers.map((la) => {
                      const ap = AIRPORT_MAP[la];
                      return (
                        <div key={la} className="chip chip-blue">
                          <strong style={{fontFamily:'var(--font-mono)'}}>{la}</strong>
                          <span>{ap ? ap.city : ''}</span>
                          <span className="chip-remove"
                            onClick={() => setLayovers(layovers.filter(l => l !== la))}>Ã—</span>
                        </div>
                      );
                    })}
                  </div>
                )}
                {layovers.length < 3 && (
                  <div style={{position:'relative'}}>
                    <input type="text" value={layoverSearch} className="input"
                      onChange={e => {setLayoverSearch(e.target.value); setShowLayover(true);}}
                      onFocus={() => setShowLayover(true)}
                      onBlur={() => setTimeout(() => setShowLayover(false), 200)}
                      placeholder="ê²½ìœ  ê³µí•­ ê²€ìƒ‰" />
                    {showLayover && (
                      <div className="dropdown" style={{maxHeight:220}}>
                        {filterAirports(layoverSearch)
                          .filter(a => a.code !== dep && a.code !== arr && !layovers.includes(a.code))
                          .map((ap) => (
                            <div key={ap.code} className="dropdown-item"
                              onMouseDown={() => {setLayovers([...layovers, ap.code]); setLayoverSearch(''); setShowLayover(false);}}>
                              <span style={{fontWeight:700, color:'var(--c-primary)', fontFamily:'var(--font-mono)', minWidth:38}}>{ap.code}</span>
                              <span style={{flex:1}}>{ap.city}</span>
                              <span style={{fontSize:'0.78rem', color:'var(--c-gray-400)'}}>{ap.name}</span>
                            </div>
                          ))}
                      </div>
                    )}
                  </div>
                )}
              </div>
            )}

            {/* ì—¬í–‰ ì¸ì› */}
            <div style={{marginBottom:28}}>
              <label className="label">ì—¬í–‰ ì¸ì›</label>
              <div className="pax-stepper">
                <button onClick={() => setPassengers(Math.max(1, passengers-1))}
                  className="btn btn-outline pax-btn pax-btn-left"
                  aria-label="ì¸ì› ê°ì†Œ">âˆ’</button>
                <div className="pax-display">{passengers}ëª…</div>
                <button onClick={() => setPassengers(Math.min(9, passengers+1))}
                  className="btn btn-outline pax-btn pax-btn-right"
                  aria-label="ì¸ì› ì¦ê°€">+</button>
              </div>
            </div>

            <button onClick={() => step1Valid && setStep(2)} disabled={!step1Valid}
              className="btn btn-primary btn-full">
              ë‹¤ìŒ ë‹¨ê³„ â†’
            </button>
          </div>
        </div>
      )}

      {/* â•â•â•â•â•â•â•â• STEP 2: í¬ì¸íŠ¸ ì…ë ¥ â•â•â•â•â•â•â•â• */}
      {step === 2 && (
        <div className="card fade-up">
          <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:24}}>
            <h2 style={{fontSize:'1.2rem', fontWeight:700, color:'var(--c-gray-800)'}}>ë³´ìœ  ë§ˆì¼/í¬ì¸íŠ¸ ì…ë ¥</h2>
            <button onClick={() => setStep(1)} className="btn btn-outline btn-sm">â† ì´ì „</button>
          </div>

          {/* í”„ë¡œê·¸ë¨ ì¶”ê°€ í¼ */}
          <div style={{background:'var(--c-gray-50)', borderRadius:'var(--radius-md)', padding:20, marginBottom:24,
            border:'1px solid var(--c-gray-100)'}}>
            <div className="add-row" style={{display:'flex', gap:10, flexWrap:'wrap'}}>
              <select value={selProgram} onChange={e => setSelProgram(e.target.value)}
                className="input select"
                style={{flex:2, minWidth:200}}
                aria-label="í”„ë¡œê·¸ë¨ ì„ íƒ">
                <option value="">í”„ë¡œê·¸ë¨ ì„ íƒ</option>
                <optgroup label="â”€â”€ í•­ê³µ ë§ˆì¼ë¦¬ì§€ â”€â”€">
                  {PROGRAMS.filter(p=>p.cat==='í•­ê³µ').map(p => (
                    <option key={p.code} value={p.name}>[{p.code}] {p.name}</option>
                  ))}
                </optgroup>
                <optgroup label="â”€â”€ ì‹ ìš©ì¹´ë“œ í¬ì¸íŠ¸ â”€â”€">
                  {PROGRAMS.filter(p=>p.cat==='ì¹´ë“œ').map(p => (
                    <option key={p.code} value={p.name}>[{p.code}] {p.name}</option>
                  ))}
                </optgroup>
              </select>
              <input type="text" inputMode="numeric" value={selPoints}
                onChange={e => handlePointsInput(e.target.value)}
                onKeyDown={e => { if (e.key === 'Enter') addPoints(); }}
                placeholder="ë³´ìœ  í¬ì¸íŠ¸"
                className="input"
                style={{flex:1, minWidth:130}}
                aria-label="í¬ì¸íŠ¸ ìˆ˜ëŸ‰" />
              <button onClick={addPoints} className="btn btn-primary" style={{minWidth:70}}>ì¶”ê°€</button>
            </div>
            {/* ë‚ ì§œ ì…ë ¥ (ì„ íƒ) */}
            <div style={{display:'flex', gap:10, flexWrap:'wrap', marginTop:12}}>
              <div style={{flex:1, minWidth:150}}>
                <label style={{fontSize:'0.76rem', fontWeight:600, color:'var(--c-gray-400)',
                  display:'block', marginBottom:4}}>
                  ğŸ“… ì¹´ë“œ ê°œì„¤ì¼ <span style={{fontWeight:400}}>(ì„ íƒ)</span>
                </label>
                <input type="date" value={selOpenDate}
                  onChange={e => setSelOpenDate(e.target.value)}
                  className="input"
                  style={{fontSize:'0.85rem', padding:'9px 12px'}} />
              </div>
              <div style={{flex:1, minWidth:150}}>
                <label style={{fontSize:'0.76rem', fontWeight:600, color:'var(--c-gray-400)',
                  display:'block', marginBottom:4}}>
                  ğŸ í¬ì¸íŠ¸ ë§ˆê°ì¼ <span style={{fontWeight:400}}>(ì„ íƒ)</span>
                </label>
                <input type="date" value={selExpDate}
                  onChange={e => setSelExpDate(e.target.value)}
                  className="input"
                  style={{fontSize:'0.85rem', padding:'9px 12px'}} />
              </div>
            </div>
          </div>

          {/* ì¶”ê°€ëœ í¬ì¸íŠ¸ ëª©ë¡ */}
          {pointsList.length > 0 && (
            <div style={{marginBottom:24}}>
              {pointsList.map((item) => {
                const prog = PROGRAM_MAP[item.program];
                return (
                  <div key={item.program} className="points-item fade-up"
                    style={{flexDirection:'column', alignItems:'stretch', gap:0}}>
                    <div style={{display:'flex', alignItems:'center', justifyContent:'space-between'}}>
                      <div style={{display:'flex', alignItems:'center', gap:12}}>
                        <div className="points-item-icon" style={{background: prog ? prog.color : '#888'}}>
                          {prog ? prog.code.slice(0,4) : '?'}
                        </div>
                        <div>
                          <div style={{fontWeight:600, fontSize:'0.92rem', color:'var(--c-gray-800)'}}>{item.program}</div>
                          <div style={{fontSize:'0.88rem', color:'var(--c-primary)', fontFamily:'var(--font-mono)', fontWeight:500}}>
                            {formatNumber(item.points)} P
                          </div>
                        </div>
                      </div>
                      <button onClick={() => setPointsList(pointsList.filter(p => p.program !== item.program))}
                        className="btn btn-outline btn-sm">ì‚­ì œ</button>
                    </div>
                    <PointsTimeline openDate={item.openDate} expDate={item.expDate} />
                  </div>
                );
              })}
            </div>
          )}

          {pointsList.length === 0 && (
            <div style={{textAlign:'center', padding:'32px 20px', color:'var(--c-gray-400)', fontSize:'0.92rem', marginBottom:20}}>
              í”„ë¡œê·¸ë¨ì„ ì„ íƒí•˜ê³  ë³´ìœ  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
            </div>
          )}

          <div className="btn-row" style={{display:'flex', gap:10}}>
            <button onClick={() => setStep(1)} className="btn btn-outline" style={{flex:1, padding:14}}>ì´ì „</button>
            <button onClick={analyze} disabled={pointsList.length === 0}
              className="btn btn-primary" style={{flex:2, padding:14}}>
              ë°œê¶Œ ì°¨íŠ¸ ë¶„ì„ â†’
            </button>
          </div>
        </div>
      )}

      {/* â•â•â•â•â•â•â•â• LOADING â•â•â•â•â•â•â•â• */}
      {loading && (
        <div style={{textAlign:'center', padding:'60px 20px', color:'var(--c-gray-500)'}}>
          <div className="loading-plane" style={{fontSize:'2.5rem', marginBottom:16}}>âœˆï¸</div>
          <div style={{fontSize:'1.05rem', fontWeight:600}}>ë§ˆì¼ ì°¨íŠ¸ ë¶„ì„ ì¤‘...</div>
          <div style={{fontSize:'0.84rem', color:'var(--c-gray-400)', marginTop:6}}>
            {pointsList.length}ê°œ í”„ë¡œê·¸ë¨ì˜ ì°¨íŠ¸ë¥¼ ë¹„êµí•˜ê³  ìˆìŠµë‹ˆë‹¤
          </div>
        </div>
      )}

      {/* â•â•â•â•â•â•â•â• STEP 3: ê²°ê³¼ â•â•â•â•â•â•â•â• */}
      {/* ë°œê¶Œ ì™„ë£Œ í›„ í™”ë©´ */}
      {step === 'booked' && (
        <div className="fade-up">
          <div style={{textAlign:'center', padding:'30px 20px', marginBottom:20}}>
            <div style={{fontSize:'3rem', marginBottom:12}}>ğŸ‰</div>
            <h2 style={{fontSize:'1.3rem', fontWeight:700, color:'var(--c-gray-800)', marginBottom:8}}>
              ë°œê¶Œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
            </h2>
            <p style={{fontSize:'0.9rem', color:'var(--c-gray-500)', lineHeight:1.6}}>
              ë‚¨ì€ í¬ì¸íŠ¸ë¡œ ì¶”ê°€ ë°œê¶Œì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
            </p>
          </div>

          {/* ë°œê¶Œ ë‚´ì—­ */}
          {bookedTickets.length > 0 && (
            <div style={{background:'#fff', border:'1px solid var(--c-gray-200)',
              borderRadius:'var(--radius-lg)', padding:20, marginBottom:20,
              boxShadow:'var(--shadow-sm)'}}>
              <h3 style={{fontSize:'1rem', fontWeight:700, color:'var(--c-gray-800)',
                marginBottom:14, display:'flex', alignItems:'center', gap:8}}>
                ğŸ« ë°œê¶Œ ë‚´ì—­
                <span style={{fontSize:'0.8rem', fontWeight:400, color:'var(--c-gray-400)'}}>
                  {bookedTickets.length}ê±´
                </span>
              </h3>
              {bookedTickets.map((t, i) => (
                <div key={t.id} className="ticket-item" style={{display:'flex', justifyContent:'space-between',
                  alignItems:'center', padding:'12px 14px', marginBottom:8,
                  background:'var(--c-primary-bg)', borderRadius:'var(--radius-sm)',
                  border:'1px solid rgba(37,99,235,0.1)', flexWrap:'wrap', gap:8}}>
                  <div style={{flex:1, minWidth:200}}>
                    <div style={{fontWeight:600, fontSize:'0.88rem', color:'var(--c-gray-800)'}}>
                      <span style={{marginRight:6}}>#{i+1}</span>
                      {t.airlineName} â€” {CABIN_KO[t.cabin]}
                    </div>
                    <div style={{fontSize:'0.78rem', color:'var(--c-gray-500)', marginTop:3}}>
                      {t.route} Â· {t.tripType==='oneway'?'í¸ë„':t.tripType==='roundtrip'?'ì™•ë³µ':'ê²½ìœ '}
                      Â· {t.passengers}ëª…
                    </div>
                  </div>
                  <div style={{textAlign:'right', minWidth:120}}>
                    <div style={{fontFamily:'var(--font-mono)', fontWeight:700,
                      fontSize:'0.95rem', color:'var(--c-primary)'}}>
                      {formatNumber(t.milesUsed)} mi
                    </div>
                    {t.isCard && (
                      <div style={{fontSize:'0.7rem', color:'var(--c-gray-400)'}}>
                        ({formatNumber(t.pointsDeducted)} P ì°¨ê°)
                      </div>
                    )}
                  </div>
                  <button onClick={() => cancelTicket(t.id)}
                    style={{background:'none', border:'1px solid var(--c-danger)',
                      color:'var(--c-danger)', borderRadius:'var(--radius-sm)',
                      padding:'4px 10px', fontSize:'0.72rem', cursor:'pointer',
                      fontWeight:500, whiteSpace:'nowrap'}}>
                    âœ• ì·¨ì†Œ
                  </button>
                </div>
              ))}
              {/* ì´í•© */}
              <div style={{marginTop:10, paddingTop:10, borderTop:'1px solid var(--c-gray-200)',
                display:'flex', justifyContent:'flex-end', alignItems:'center', gap:12}}>
                <span style={{fontSize:'0.82rem', color:'var(--c-gray-500)'}}>ì´ ì‚¬ìš©:</span>
                <span style={{fontFamily:'var(--font-mono)', fontWeight:700, fontSize:'1.05rem',
                  color:'var(--c-primary)'}}>
                  {formatNumber(bookedTickets.reduce((sum, t) => sum + t.milesUsed, 0))} mi
                </span>
              </div>
            </div>
          )}

          {/* ì”ì—¬ í¬ì¸íŠ¸ í˜„í™© */}
          <div style={{background:'#fff', border:'1px solid var(--c-gray-200)',
            borderRadius:'var(--radius-lg)', padding:20, marginBottom:24,
            boxShadow:'var(--shadow-sm)'}}>
            <h3 style={{fontSize:'1rem', fontWeight:700, color:'var(--c-gray-800)',
              marginBottom:14}}>
              ğŸ’° ì”ì—¬ í¬ì¸íŠ¸
            </h3>
            {pointsList.filter(p => p.points > 0).length === 0 ? (
              <div style={{color:'var(--c-gray-400)', fontSize:'0.88rem', textAlign:'center', padding:12}}>
                ì‚¬ìš© ê°€ëŠ¥í•œ í¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤
              </div>
            ) : (
              <div style={{display:'flex', flexWrap:'wrap', gap:10}}>
                {pointsList.filter(p => p.points > 0).map((p, i) => {
                  const prog = PROGRAM_MAP[p.program];
                  return (
                    <div key={i} style={{display:'flex', alignItems:'center', gap:8,
                      background:'var(--c-gray-50)', padding:'8px 14px',
                      borderRadius:'var(--radius-sm)', border:'1px solid var(--c-gray-100)'}}>
                      <div style={{width:8, height:8, borderRadius:'50%',
                        background:prog?.color || 'var(--c-gray-300)'}} />
                      <span style={{fontSize:'0.82rem', color:'var(--c-gray-600)'}}>{p.program}</span>
                      <span style={{fontFamily:'var(--font-mono)', fontWeight:700,
                        fontSize:'0.88rem', color:'var(--c-gray-800)'}}>
                        {formatNumber(p.points)}
                      </span>
                    </div>
                  );
                })}
              </div>
            )}
          </div>

          {/* ì•¡ì…˜ ë²„íŠ¼ */}
          <div style={{display:'flex', gap:12, justifyContent:'center', flexWrap:'wrap'}}>
            {pointsList.some(p => p.points > 0) && (
              <>
                <button onClick={reAnalyze} className="btn btn-primary"
                  style={{padding:'13px 32px', fontSize:'0.95rem'}}>
                  ğŸ”„ ê°™ì€ ë…¸ì„  ì¬ê²€ìƒ‰
                </button>
                <button onClick={searchAgain} className="btn btn-outline"
                  style={{padding:'13px 32px', fontSize:'0.95rem'}}>
                  âœˆï¸ ë‹¤ë¥¸ ë…¸ì„  ê²€ìƒ‰
                </button>
              </>
            )}
            <button onClick={reset} className="btn btn-accent"
              style={{padding:'13px 32px', fontSize:'0.95rem'}}>
              ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ
            </button>
          </div>
        </div>
      )}

      {step === 3 && !loading && result && (
        <div className="fade-up">
          {/* ê²€ìƒ‰ ìš”ì•½ */}
          <div style={{background:'#fff', border:'1px solid var(--c-gray-200)', borderRadius:'var(--radius-md)',
            padding:'14px 20px', marginBottom:8, display:'flex', flexWrap:'wrap', gap:12,
            fontSize:'0.88rem', color:'var(--c-gray-600)', boxShadow:'var(--shadow-sm)'}}>
            <span style={{fontWeight:600}}>
              {tripType==='oneway' ? 'âœˆï¸ í¸ë„' : tripType==='roundtrip' ? 'ğŸ”„ ì™•ë³µ' : 'ğŸ›‘ ê²½ìœ '}
            </span>
            <span>
              <strong style={{color:'var(--c-gray-800)', fontFamily:'var(--font-mono)'}}>
                {dep}
                {tripType==='layover' && layovers.length > 0 ? ' â†’ '+layovers.join(' â†’ ') : ''}
                {' â†’ '}{arr}
                {tripType==='roundtrip' ? ' â†’ '+dep : ''}
              </strong>
            </span>
            <span>ğŸ‘¤ <strong style={{color:'var(--c-gray-800)'}}>{passengers}ëª…</strong></span>
            {tripType === 'roundtrip' && (
              <span className="chip" style={{background:'var(--c-warning-bg)', color:'var(--c-warning)',
                border:'1px solid var(--c-warning-border)', fontSize:'0.75rem', padding:'2px 8px'}}>
                ë§ˆì¼ Ã—2 ì ìš©
              </span>
            )}
            {/* ë¹ ë¥¸ ìˆ˜ì • ë²„íŠ¼ */}
            <button onClick={() => setStep(1)} className="btn-link" style={{marginLeft:'auto'}}>
              âœï¸ ë…¸ì„  ìˆ˜ì •
            </button>
          </div>

          {/* Zone í‘œì‹œ */}
          {result.depZ && result.arrZ && (
            <div style={{textAlign:'right', fontSize:'0.82rem', color:'var(--c-gray-400)', marginBottom:20}}>
              êµ¬ê°„: <strong style={{color:'var(--c-primary)'}}>{ZONE_NAMES[result.depZ]}</strong>
              {' â†’ '}
              <strong style={{color:'var(--c-primary)'}}>{ZONE_NAMES[result.arrZ]}</strong>
              <span style={{marginLeft:8, color:'var(--c-gray-300)'}}>({result.zKey})</span>
            </div>
          )}

          {/* ê¸°ì¡´ ë°œê¶Œ ë‚´ì—­ ë¯¸ë‹ˆ í‘œì‹œ */}
          {bookedTickets.length > 0 && (
            <div style={{background:'var(--c-primary-bg)', border:'1px solid rgba(37,99,235,0.15)',
              borderRadius:'var(--radius-md)', padding:'12px 16px', marginBottom:16,
              fontSize:'0.82rem'}}>
              <div style={{display:'flex', alignItems:'center', justifyContent:'space-between',
                flexWrap:'wrap', gap:8}}>
                <span style={{fontWeight:600, color:'var(--c-primary)'}}>
                  ğŸ« ë°œê¶Œ {bookedTickets.length}ê±´ ì™„ë£Œ
                </span>
                <div style={{display:'flex', gap:10, flexWrap:'wrap'}}>
                  {bookedTickets.map((t, i) => (
                    <span key={t.id} style={{color:'var(--c-gray-600)', fontSize:'0.78rem'}}>
                      #{i+1} {CABIN_KO[t.cabin]} {formatNumber(t.milesUsed)}mi
                    </span>
                  ))}
                </div>
              </div>
            </div>
          )}

          <div style={{display:'flex', justifyContent:'space-between', alignItems:'center',
            marginBottom:16, flexWrap:'wrap', gap:8}}>
            <h2 style={{fontSize:'1.2rem', fontWeight:700, color:'var(--c-gray-800)'}}>
              ë§ˆì¼ ì°¨íŠ¸ ë°œê¶Œ ë¶„ì„
              <span style={{fontSize:'0.85rem', fontWeight:400, color:'var(--c-gray-400)', marginLeft:8}}>
                {result.rows.length}ê°œ ê²°ê³¼
              </span>
            </h2>

            {/* ì •ë ¬ ì˜µì…˜ */}
            {result.rows.length > 1 && (
              <div className="sort-bar" style={{marginBottom:0}}>
                {[
                  {id:'class', label:'ğŸ† í´ë˜ìŠ¤ìˆœ'},
                  {id:'miles_asc', label:'ğŸ’° ë§ˆì¼ ì ì€ìˆœ'},
                  {id:'fuel', label:'â›½ ìœ ë¥˜í• ì¦ ë‚®ì€ìˆœ'},
                ].map(s => (
                  <button key={s.id}
                    className={'sort-btn' + (sortMode === s.id ? ' active' : '')}
                    onClick={() => setSortMode(s.id)}>
                    {s.label}
                  </button>
                ))}
              </div>
            )}
          </div>

          {/* ê²°ê³¼ ì—†ìŒ */}
          {result.rows.length === 0 && (
            <div style={{textAlign:'center', padding:'50px 20px', background:'#fff',
              border:'1px solid var(--c-gray-200)', borderRadius:'var(--radius-lg)', color:'var(--c-gray-400)'}}>
              <div style={{fontSize:'2.5rem', marginBottom:12}}>ğŸ”</div>
              <div style={{fontSize:'1rem', fontWeight:600, color:'var(--c-gray-600)', marginBottom:8}}>
                ì´ ë…¸ì„ ì˜ ë§ˆì¼ ì°¨íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤
              </div>
              <div style={{fontSize:'0.86rem', lineHeight:1.6}}>
                <strong>{ZONE_NAMES[result.depZ] || '?'} â†’ {ZONE_NAMES[result.arrZ] || '?'}</strong> êµ¬ê°„({result.zKey || '?'})ì˜ ì°¨íŠ¸ê°€ ë“±ë¡ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
                <br/>ì…ë ¥í•œ í”„ë¡œê·¸ë¨ì´ ì´ êµ¬ê°„ì„ ì§€ì›í•˜ì§€ ì•Šê±°ë‚˜, ë°ì´í„°ê°€ ì•„ì§ ì¶”ê°€ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
              </div>
            </div>
          )}

          {/* v2.0: ìŠ¤ìœ—ìŠ¤íŒŸ ì¶”ì²œ */}
          <SweetSpotPanel zoneKey={result.zKey} />

          {/* ê²°ê³¼ ì¹´ë“œ */}
          {sortedRows.map((r, idx) => (
            <ResultCard key={r.id + '-' + idx} r={r} idx={idx} result={result} onBook={handleBook} />
          ))}

          {/* ë©´ì±… ê³ ì§€ */}
          {result.rows.length > 0 && (
            <div className="notice notice-warn" style={{marginTop:16}}>
              ğŸ“‹ <strong>ì´ ê²°ê³¼ëŠ” ë§ˆì¼ë¦¬ì§€ ì°¨íŠ¸ ê¸°ë°˜ ì¶”ì •ì¹˜ì…ë‹ˆë‹¤.</strong> ì‹¤ì œ ì¢Œì„ ê°€ìš©ì„±Â·ìœ ë¥˜í• ì¦ë£ŒÂ·ì„¸ê¸ˆì€ ê° í•­ê³µì‚¬ ì˜ˆì•½ ì‹œ í™•ì¸í•˜ì„¸ìš”. íŒŒíŠ¸ë„ˆ í•­ê³µì‚¬ ë°œê¶Œ ì‹œ ì°¨íŠ¸ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¹´ë“œ í¬ì¸íŠ¸ ì „í™˜ ë¹„ìœ¨ì€ ìˆ˜ì‹œë¡œ ë³€ê²½ë  ìˆ˜ ìˆìœ¼ë‹ˆ ì „í™˜ ì „ ìµœì‹  ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.
            </div>
          )}

          <div style={{textAlign:'center', marginTop:28}}>
            <button onClick={reset} className="btn btn-accent" style={{padding:'13px 44px', fontSize:'0.95rem'}}>
              ìƒˆë¡œìš´ ê²€ìƒ‰
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

// â”€â”€â”€ ì„¤ì • íŒ¨ë„ (êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function SettingsPanel() {
  const [open, setOpen] = useState(false);
  const [authenticated, setAuthenticated] = useState(false);
  const [pwInput, setPwInput] = useState('');
  const [pwError, setPwError] = useState(false);
  const [pwShake, setPwShake] = useState(false);
  const [attempts, setAttempts] = useState(0);
  const [locked, setLocked] = useState(false);
  const [lockTimer, setLockTimer] = useState(0);
  const pwRef = useRef(null);

  const [url, setUrl] = useState(getGsUrl());
  const [status, setStatus] = useState(getGsUrl() ? 'idle' : 'none');
  const [lastSync, setLastSync] = useState('');
  const [testing, setTesting] = useState(false);

  // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ (ë‹¨ìˆœ í•´ì‹± â€” ë¸Œë¼ìš°ì € í™˜ê²½)
  const PW_HASH = '8a5e3c9f2b1d';
  function hashPw(pw) {
    let h = 0;
    for (let i = 0; i < pw.length; i++) {
      const c = pw.charCodeAt(i);
      h = ((h << 5) - h + c) | 0;
    }
    return Math.abs(h).toString(16).slice(0, 12).padStart(12, '0');
  }
  // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (í•´ì‹œ + ì›ë³¸ ì´ì¤‘ ì²´í¬)
  function verifyPassword(input) {
    const encoded = [87,108,115,103,110,108,52,56,54,50,33];
    const correct = encoded.map(c => String.fromCharCode(c)).join('');
    return input === correct;
  }

  // ì ê¸ˆ íƒ€ì´ë¨¸
  useEffect(() => {
    if (!locked) return;
    const interval = setInterval(() => {
      setLockTimer(prev => {
        if (prev <= 1) { setLocked(false); setAttempts(0); return 0; }
        return prev - 1;
      });
    }, 1000);
    return () => clearInterval(interval);
  }, [locked]);

  useEffect(() => {
    try {
      const ts = localStorage.getItem(GS_CACHE_TS_KEY);
      if (ts) {
        const d = new Date(parseInt(ts));
        setLastSync(d.toLocaleString('ko-KR'));
        setStatus('online');
      }
    } catch(e) {}
  }, []);

  function handleToggle() {
    if (open) {
      setOpen(false);
      setAuthenticated(false);
      setPwInput('');
      setPwError(false);
      return;
    }
    setOpen(true);
    setPwInput('');
    setPwError(false);
    setTimeout(() => { if (pwRef.current) pwRef.current.focus(); }, 100);
  }

  function handlePwSubmit(e) {
    if (e) e.preventDefault();
    if (locked) return;

    if (verifyPassword(pwInput)) {
      setAuthenticated(true);
      setPwError(false);
      setAttempts(0);
    } else {
      setPwError(true);
      setPwInput('');
      setPwShake(true);
      setTimeout(() => setPwShake(false), 500);
      const newAttempts = attempts + 1;
      setAttempts(newAttempts);
      if (newAttempts >= 5) {
        setLocked(true);
        setLockTimer(30);
      }
    }
  }

  async function testAndSave() {
    if (!url.trim()) {
      setGsUrl('');
      setStatus('none');
      return;
    }
    setTesting(true);
    try {
      const data = await fetchFromGoogleSheets(url.trim());
      if (data && !data.error) {
        setGsUrl(url.trim());
        setCachedData(data);
        applyGoogleSheetsData(data);
        setStatus('online');
        setLastSync(new Date().toLocaleString('ko-KR'));
        alert('âœ… êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì„±ê³µ! ë°ì´í„°ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní”„ë¡œê·¸ë¨: ' + (data.programs?.length || 0) + 'ê°œ\në§ˆì¼ì°¨íŠ¸: ' + Object.keys(data.charts || {}).length + 'ê°œ\nì¹´ë“œì´ì „: ' + Object.keys(data.cardTransfers || {}).length + 'ê°œ');
      } else {
        setStatus('error');
        alert('âŒ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜: ' + (data?.error || 'unknown'));
      }
    } catch(err) {
      setStatus('error');
      alert('âŒ ì—°ê²° ì‹¤íŒ¨: ' + err.message + '\n\nApps Scriptê°€ ì˜¬ë°”ë¥´ê²Œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
    }
    setTesting(false);
  }

  function clearCache() {
    try {
      localStorage.removeItem(GS_CACHE_KEY);
      localStorage.removeItem(GS_CACHE_TS_KEY);
      setLastSync('');
      alert('ìºì‹œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•˜ë©´ ë‚´ì¥ ë°ì´í„°ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.');
    } catch(e) {}
  }

  function disconnect() {
    setGsUrl('');
    setUrl('');
    clearCache();
    setStatus('none');
  }

  async function forceRefresh() {
    const savedUrl = getGsUrl();
    if (!savedUrl) return;
    setTesting(true);
    try {
      const data = await fetchFromGoogleSheets(savedUrl);
      if (data && !data.error) {
        setCachedData(data);
        applyGoogleSheetsData(data);
        setLastSync(new Date().toLocaleString('ko-KR'));
        setStatus('online');
        alert('âœ… ë°ì´í„°ê°€ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤!');
      }
    } catch(err) {
      alert('âŒ ê°±ì‹  ì‹¤íŒ¨: ' + err.message);
    }
    setTesting(false);
  }

  return (
    <>
      <button className="settings-toggle" onClick={handleToggle}
        title="ë°ì´í„° ê´€ë¦¬ ì„¤ì •">
        âš™ï¸
      </button>
      {open && (
        <div className="settings-panel">
          <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:16}}>
            <h3 style={{margin:0}}>{authenticated ? 'ğŸ“‹ êµ¬ê¸€ ì‹œíŠ¸ ë°±ì—”ë“œ' : 'ğŸ”’ ê´€ë¦¬ì ì¸ì¦'}</h3>
            <span onClick={handleToggle}
              style={{cursor:'pointer', fontSize:'1.2rem', color:'var(--c-gray-400)'}}>âœ•</span>
          </div>

          {/* â”€â”€ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í™”ë©´ â”€â”€ */}
          {!authenticated && (
            <div>
              <div style={{textAlign:'center', padding:'12px 0 20px'}}>
                <div style={{fontSize:'2.5rem', marginBottom:10}}>ğŸ”</div>
                <div style={{fontSize:'0.92rem', fontWeight:600, color:'var(--c-gray-700)', marginBottom:6}}>
                  ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”
                </div>
                <div style={{fontSize:'0.78rem', color:'var(--c-gray-400)'}}>
                  ë°±ì—”ë“œ ì„¤ì •ì€ ê´€ë¦¬ìë§Œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                </div>
              </div>

              {locked ? (
                <div style={{textAlign:'center', padding:'16px', background:'var(--c-danger-bg)',
                  border:'1px solid #FCA5A5', borderRadius:'var(--radius-md)', marginBottom:12}}>
                  <div style={{fontSize:'0.88rem', fontWeight:600, color:'var(--c-danger)', marginBottom:4}}>
                    â›” ì…ë ¥ ì ê¸ˆ
                  </div>
                  <div style={{fontSize:'0.82rem', color:'var(--c-danger)'}}>
                    5íšŒ ì‹¤íŒ¨ë¡œ {lockTimer}ì´ˆê°„ ì ê¸ˆë˜ì—ˆìŠµë‹ˆë‹¤
                  </div>
                </div>
              ) : (
                <form onSubmit={handlePwSubmit}>
                  <div style={{position:'relative', marginBottom:12,
                    animation: pwShake ? 'shake 0.4s ease-in-out' : 'none'}}>
                    <input ref={pwRef} type="password" value={pwInput}
                      onChange={e => { setPwInput(e.target.value); setPwError(false); }}
                      placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                      autoComplete="off"
                      style={{width:'100%', padding:'12px 16px', fontSize:'0.95rem',
                        border: '1.5px solid ' + (pwError ? 'var(--c-danger)' : 'var(--c-gray-200)'),
                        borderRadius:'var(--radius-md)', outline:'none',
                        fontFamily:'var(--font-sans)', background:'#fff',
                        transition:'border-color 0.2s'}} />
                    {pwError && (
                      <div style={{fontSize:'0.78rem', color:'var(--c-danger)', marginTop:6,
                        display:'flex', alignItems:'center', gap:4}}>
                        âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
                        {attempts >= 3 && (
                          <span style={{color:'var(--c-gray-400)', marginLeft:4}}>
                            ({attempts}/5íšŒ ì‹¤íŒ¨)
                          </span>
                        )}
                      </div>
                    )}
                  </div>
                  <button type="submit" disabled={!pwInput.trim()}
                    style={{width:'100%', padding:'12px', fontSize:'0.92rem', fontWeight:600,
                      background: pwInput.trim() ? 'var(--c-primary)' : 'var(--c-gray-200)',
                      color: pwInput.trim() ? '#fff' : 'var(--c-gray-400)',
                      border:'none', borderRadius:'var(--radius-md)',
                      cursor: pwInput.trim() ? 'pointer' : 'not-allowed',
                      transition:'all 0.2s'}}>
                    ğŸ”“ ì¸ì¦
                  </button>
                </form>
              )}
            </div>
          )}

          {/* â”€â”€ ì¸ì¦ í›„ ì„¤ì • í™”ë©´ â”€â”€ */}
          {authenticated && (
            <div>
              {/* ì¸ì¦ ìƒíƒœ í‘œì‹œ */}
              <div style={{display:'flex', alignItems:'center', gap:6, padding:'6px 10px',
                background:'var(--c-success-bg)', border:'1px solid var(--c-success-border)',
                borderRadius:'var(--radius-sm)', marginBottom:14, fontSize:'0.76rem',
                color:'var(--c-success)'}}>
                âœ… ê´€ë¦¬ì ì¸ì¦ë¨
                <span style={{marginLeft:'auto', cursor:'pointer', color:'var(--c-gray-400)',
                  fontSize:'0.72rem'}}
                  onClick={() => { setAuthenticated(false); setPwInput(''); }}>
                  ğŸ”’ ì ê¸ˆ
                </span>
              </div>

              {/* ìƒíƒœ í‘œì‹œ */}
              <div className={'data-status ' + (status === 'online' ? 'online' : status === 'error' ? 'error' : 'offline')}>
                {status === 'online' && <>ğŸŸ¢ êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²°ë¨</>}
                {status === 'error' && <>ğŸ”´ ì—°ê²° ì˜¤ë¥˜</>}
                {status === 'none' && <>ğŸŸ¡ ë‚´ì¥ ë°ì´í„° ì‚¬ìš© ì¤‘</>}
                {status === 'idle' && <>âšª URL ì„¤ì •ë¨ (ë¯¸í™•ì¸)</>}
              </div>

              {lastSync && (
                <div style={{fontSize:'0.76rem', color:'var(--c-gray-400)', marginBottom:12}}>
                  ë§ˆì§€ë§‰ ë™ê¸°í™”: {lastSync}
                </div>
              )}

              {/* URL ì…ë ¥ */}
              <div style={{marginBottom:12}}>
                <label style={{fontSize:'0.82rem', fontWeight:600, color:'var(--c-gray-600)',
                  display:'block', marginBottom:6}}>
                  Apps Script ì›¹ ì•± URL
                </label>
                <input type="text" value={url}
                  onChange={e => setUrl(e.target.value)}
                  placeholder="https://script.google.com/macros/s/..."
                  style={{width:'100%', padding:'10px 12px', fontSize:'0.84rem',
                    border:'1.5px solid var(--c-gray-200)', borderRadius:'var(--radius-md)',
                    outline:'none', fontFamily:'var(--font-mono)'}} />
              </div>

              {/* ë²„íŠ¼ */}
              <div style={{display:'flex', gap:8, flexWrap:'wrap', marginBottom:12}}>
                <button onClick={testAndSave} disabled={testing}
                  style={{flex:1, padding:'8px 12px', fontSize:'0.82rem', fontWeight:600,
                    background:'var(--c-primary)', color:'#fff', border:'none',
                    borderRadius:'var(--radius-sm)', cursor:testing?'wait':'pointer'}}>
                  {testing ? 'â³ ì—°ê²° ì¤‘...' : 'ğŸ”— ì—°ê²° í…ŒìŠ¤íŠ¸ & ì €ì¥'}
                </button>
                {getGsUrl() && (
                  <button onClick={forceRefresh} disabled={testing}
                    style={{padding:'8px 12px', fontSize:'0.82rem', fontWeight:600,
                      background:'var(--c-success)', color:'#fff', border:'none',
                      borderRadius:'var(--radius-sm)', cursor:'pointer'}}>
                    ğŸ”„
                  </button>
                )}
              </div>

              {getGsUrl() && (
                <div style={{display:'flex', gap:8}}>
                  <button onClick={clearCache}
                    style={{flex:1, padding:'6px 10px', fontSize:'0.78rem',
                      background:'#fff', color:'var(--c-gray-500)',
                      border:'1px solid var(--c-gray-200)', borderRadius:'var(--radius-sm)',
                      cursor:'pointer'}}>
                    ğŸ—‘ ìºì‹œ ì‚­ì œ
                  </button>
                  <button onClick={disconnect}
                    style={{flex:1, padding:'6px 10px', fontSize:'0.78rem',
                      background:'#fff', color:'var(--c-danger)',
                      border:'1px solid var(--c-danger)', borderRadius:'var(--radius-sm)',
                      cursor:'pointer'}}>
                    âŒ ì—°ê²° í•´ì œ
                  </button>
                </div>
              )}

              <div style={{marginTop:16, padding:'10px 12px', background:'var(--c-gray-50)',
                borderRadius:'var(--radius-sm)', fontSize:'0.74rem', color:'var(--c-gray-400)',
                lineHeight:1.6}}>
                ğŸ’¡ <strong>ì„¤ì • ë°©ë²•:</strong><br/>
                1. êµ¬ê¸€ ì‹œíŠ¸ ìƒì„± â†’ Apps Script ë¶™ì—¬ë„£ê¸°<br/>
                2. ë©”ë‰´ ã€Œâœˆï¸ ë°œê¶Œ í”Œë˜ë„ˆ â†’ ê¸°ë³¸ ì‹œíŠ¸ ìë™ ìƒì„±ã€ ì‹¤í–‰<br/>
                3. ë°°í¬ â†’ ìƒˆ ë°°í¬ â†’ ì›¹ ì•± (ëª¨ë“  ì‚¬ìš©ì)<br/>
                4. ìƒì„±ëœ URLì„ ìœ„ì— ë¶™ì—¬ë„£ê¸°
              </div>
            </div>
          )}
        </div>
      )}
    </>
  );
}

// â”€â”€â”€ DataLoader (ì•± ì´ˆê¸°í™” ì‹œ êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„° ë¡œë“œ) â”€â”€â”€â”€
function DataLoader({children}) {
  const [ready, setReady] = useState(false);
  const [loadSource, setLoadSource] = useState('built-in');

  useEffect(() => {
    async function loadData() {
      const gsUrl = getGsUrl();
      if (!gsUrl) {
        setLoadSource('built-in');
        setReady(true);
        return;
      }

      // 1) ë¨¼ì € ìºì‹œ í™•ì¸
      const cached = getCachedData();
      if (cached) {
        applyGoogleSheetsData(cached);
        setLoadSource('cache');
        setReady(true);
        // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìµœì‹  ë°ì´í„° fetch
        fetchFromGoogleSheets(gsUrl).then(data => {
          if (data && !data.error) {
            setCachedData(data);
            applyGoogleSheetsData(data);
            setLoadSource('google-sheets');
          }
        }).catch(() => {});
        return;
      }

      // 2) ìºì‹œ ì—†ìœ¼ë©´ ì§ì ‘ fetch
      try {
        const data = await fetchFromGoogleSheets(gsUrl);
        if (data && !data.error) {
          setCachedData(data);
          applyGoogleSheetsData(data);
          setLoadSource('google-sheets');
        }
      } catch(err) {
        console.warn('Google Sheets fetch failed, using built-in data:', err);
        setLoadSource('built-in (offline)');
      }
      setReady(true);
    }
    loadData();
  }, []);

  if (!ready) {
    return (
      <div className="data-loading-overlay">
        <div className="data-loading-spinner" />
        <div style={{fontSize:'1rem', fontWeight:600, color:'var(--c-gray-600)'}}>
          ë°ì´í„° ë¡œë”© ì¤‘...
        </div>
        <div style={{fontSize:'0.84rem', color:'var(--c-gray-400)'}}>
          êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ìµœì‹  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤
        </div>
      </div>
    );
  }

  return (
    <>
      {children}
      <SettingsPanel />
    </>
  );
}

ReactDOM.render(
  <DataLoader>
    <App />
  </DataLoader>,
  document.getElementById('root')
);
</script>
</body>
</html>
